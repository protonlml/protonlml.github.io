---
title: 58.反射
date: 2019-09-29 22:38:00
author: 𝚲𝚳𝚲
tags:   # 添加博文标签
	- java基础
categories:   # 添加博文分类
	- java

---

<h1><center>反射</center></h1>

## 一、反射

![image-20240717232338015](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407172323015.png)

![image-20240717232612040](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407172326086.png)

## 二、获取class对象的三种方式

```java
package com.atlml.reflex;

import java.lang.reflect.InvocationTargetException;

/**
 * 获取反射的 class对象的三种方式
 */
public class ReflexDemo {
    public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {

        /**
         * 获取class字节码对象的三种方式
         *
         *  1.Class.forName(全限定类名);
         *  2.类名.class
         *  3.对象.getclass
         */

        //1.Class.forName();
        // 最为常用
        Class clazz = Class.forName("com.atlml.reflex.Student");
        System.out.println(clazz);

        //2.类名.class
        //当作参数传递
        /*
        synchronized (Student.class){
        }
        */

        Class<Student> studentClass = Student.class;
        System.out.println(studentClass);

        //3. 对象.getClass
        //有局限性，当只有 对象 才能使用
        Student student = new Student();
        Class<? extends Student> aClass = student.getClass();
        System.out.println(aClass);

        //class com.atlml.reflex.Student
        //class com.atlml.reflex.Student
        //class com.atlml.reflex.Student
    }
}

```



![image-20240717232724110](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407172327128.png)

![image-20240717234049023](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407172340964.png)





---



---

```java
package com.atlml.reflex;

import java.io.IOException;

public class Student extends Teacher {


    //年级 这个成员变量是 公共的
    public String grade;
    //性别 公共的
    public String gender;
    private Integer age;
    private String name;
    
    public Student() {
    }

    public Student(Integer age) {
        this.age = age;
    }

    public Student(String name) {
        this.name = name;
    }

    /**
     * 私有的全参构造器
     *
     * @param age
     * @param name
     */
    Student(Integer age, String name) {
        this.age = age;
        this.name = name;
    }

    /**
     * 公有的静态方法，
     */
    public static void lookbook(String book) {
        System.out.println("公有的静态方法，学生看" + book + "书");
    }

    /**
     * 私有的静态方法
     */
    private static void shopping() {
        System.out.println("私有的静态方法，学生购物");
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override
    public String toString() {
        return "Student{" +
                "age=" + age +
                ", name='" + name + '\'' +
                '}';
    }

    /**
     * 学生学习方法
     */
    public void study() {
        System.out.println("这是公有的方法，学生学习");
    }

    /**
     * 私有的  吃饭方法
     */
    private String eat(String fan, Integer price) throws IOException, NullPointerException, RuntimeException {
        return "这是私有的方法，学生吃" + fan + "饭,花了" + price + "元";
    }


}

```





## 三、利用反射获取构造方法

![image-20240718000745857](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407180008499.png)



----



```java
package com.atlml.reflex;

import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Parameter;
import java.util.Arrays;
import java.util.List;

/**
 * 利用反射获取构造方法
 */
public class ReflexDemo1 {
    public static void main(String[] args) throws ClassNotFoundException {


        //通过反射 获取Student 的字节码class对象
        Class clazz = Class.forName("com.atlml.reflex.Student");
        //获取 student类中的 构造器
        try {

            Constructor[] declaredConstructors = clazz.getDeclaredConstructors();

            //1.获取所有公有的构造器方法
            Constructor[] constructors1 = clazz.getConstructors();
            System.out.println(Arrays.asList(constructors1));
            //[public com.atlml.reflex.Student(), public com.atlml.reflex.Student(java.lang.Integer), public com.atlml.reflex.Student(java.lang.String)]

            // 2.获取所有构造器，包括私有的
            List<Constructor> constructors = Arrays.asList(declaredConstructors);
            System.out.println(constructors);
            //[public com.atlml.reflex.Student(), private com.atlml.reflex.Student(java.lang.Integer,java.lang.String), public com.atlml.reflex.Student(java.lang.String), public com.atlml.reflex.Student(java.lang.Integer)]



            /*
                使用Declared 表示当前构造方法是私有的也可以被获取
                    直接使用 getConstructor() 获取单个构造器，只能是公共的
                    如果获取的不是公共的，或报错
             */

            //3.获取单个构造器(空参的)
            Constructor constructor = clazz.getDeclaredConstructor();
            System.out.println(constructor);
            //public com.atlml.reflex.Student()

            //4.获取单个构造器，一个参数的
            // 参数是 构造器参数是 ，参数类型的字节码
            Constructor declaredConstructor = clazz.getDeclaredConstructor(String.class);
            System.out.println(declaredConstructor);
            //public com.atlml.reflex.Student(java.lang.String)

            //5.获取单个构造器，一个参数的
            // 参数是 构造器参数是 ，参数类型的字节码
            Constructor declaredConstructor1 = clazz.getDeclaredConstructor(Integer.class);
            System.out.println(declaredConstructor1);
            //public com.atlml.reflex.Student(java.lang.Integer)

            //6.获取单个构造器，一个参数的
            // 参数是 构造器参数是 ，参数类型的字节码
            Constructor declaredConstructor2 = clazz.getDeclaredConstructor(Integer.class, String.class);
            System.out.println(declaredConstructor2);
            //private com.atlml.reflex.Student(java.lang.Integer,java.lang.String)

            /**
             * 构造方法获取到了，就能获取 构造方法上的所有内容
             *    1.权限修饰符
             *    2.获取所有形参
             *    3.能创建这个类的对象
             */

            // 7.通过反射来获取 构造方法中的所有内容

            //7.获取权限修饰符
            int modifiers = declaredConstructor2.getModifiers();
            System.out.println(modifiers);//2
            // private-> 2 ，public->1

            //8. 获取当前构造函数的所有参数
            Parameter[] parameters = declaredConstructor2.getParameters();
            System.out.println(Arrays.toString(parameters));
            //[java.lang.Integer arg0, java.lang.String arg1]

            //9. 通过构造方法，创建对象
            // 注意：这个方法是private私有的
            //临时取消权限的校验,没有下面这句话会报错（暴力反射）
            declaredConstructor2.setAccessible(true);
            Student student = (Student) declaredConstructor2.newInstance(23,"张三");
            System.out.println(student);
            //Student{age=23, name='张三'}


        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }


    }
}

```



---

---

## 五、利用反射获取成员变量

![image-20240718222315601](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407200005478.png)

```java
package com.atlml.reflex;

import java.lang.reflect.Field;
import java.util.Arrays;

/**
 * 利用反射获取成员变量
 */
public class ReflexDemo2 {
    public static void main(String[] args) throws ClassNotFoundException {


        try {
            // 获取 反射 字节码文件
            Class clazz = Class.forName("com.atlml.reflex.Student");

            //1.返回所有 公共的 成员变量
            Field[] fields = clazz.getFields();
            System.out.println(Arrays.toString(fields));
            //[public java.lang.String com.atlml.reflex.Student.grade, public java.lang.String com.atlml.reflex.Student.gender]


            // 2.返回所有成员变量对象的数组(公有，私有)
            Field[] declaredFields = clazz.getDeclaredFields();
            System.out.println(Arrays.toString(declaredFields));
            //[public java.lang.String com.atlml.reflex.Student.grade, public java.lang.String com.atlml.reflex.Student.gender, private java.lang.Integer com.atlml.reflex.Student.age, private java.lang.String com.atlml.reflex.Student.name]


            //3.返回单个公共成员变量对象
            Field field = clazz.getField("gender");
            System.out.println(field);
            //public java.lang.String com.atlml.reflex.Student.gender


            //4.返回单个成员变量对象
            Field name = clazz.getDeclaredField("name");
            //5.获取成员变量 修饰符
            int modifiers = name.getModifiers();
            // 6.获取成员变量 名
            String n = name.getName();
            // 7.获取成员变量 数据类型
            Class<?> type = name.getType();
            System.out.println(type);//String
            System.out.println(n);//name
            System.out.println(modifiers);// 2
            System.out.println(name);//private java.lang.String com.atlml.reflex.Student.name

            //8.获取成员变量 记录的值
            Student s = new Student(12, "张三");
            name.setAccessible(true);//临时获取权限
            //9.获取 s 这个对象，name记录的值
            Object value = name.get(s);
            System.out.println(value);//张三

            //9.修改name成员变量，对象里面记录的值
            name.set(s, "王一平");
            System.out.println(s);
            //Student{age=12, name='王一平'}

            

        } catch (NoSuchFieldException | IllegalAccessException e) {
            e.printStackTrace();
        }

    }
}
```





----

## 六、利用反射获取成员方法

![image-20240719184726716](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407191847059.png)

```java
package com.atlml.reflex;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.lang.reflect.Parameter;
import java.util.Arrays;

/**
 * 利用反射 获取 成员方法
 */
public class ReflexDemo3 {
    public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException {


        Class clazz = Class.forName("com.atlml.reflex.Student");

        //1.返回所有 公共成员方法 的数组，包括继承的
        Method[] methods = clazz.getMethods();
        for (Method method : methods) {
            System.out.println(method);
        }

        System.out.println("----------------------------------------------");
        //2.返回所有  成员方法  的数组，不包括继承的
        Method[] declaredMethods = clazz.getDeclaredMethods();
        for (Method declaredMethod : declaredMethods) {
            System.out.println(declaredMethod);
        }


        System.out.println("----------------------------------------------");


        //3.返回单个公共成员方法对象(这个方法必须是公有的)
        // 参数一：方法的名字，
        // 参数二、方法的形参类型，可以是多个（为了方法的重载）
        Method lookbook = clazz.getMethod("lookbook", String.class);
        System.out.println(lookbook); //public static void com.atlml.reflex.Student.lookbook(java.lang.String)
            // 运行当前的方法
            Student student = new Student();
            //参数1：是哪个学生对象，调用方法的形参是什么
            Object a = lookbook.invoke(student, "鲁宾孙漂流记");
            System.out.println(a);//没有返回值 null


        System.out.println("----------------------------------------------");

        //4.返回单个成员方法对象(私有的，公有的都能获取)
        // 参数一：方法的名字，
        // 参数二、方法的形参类型，可以是多个（为了方法的重载）
        //eat 是私有的
        Method eat = clazz.getDeclaredMethod("eat",String.class,Integer.class);
        System.out.println(eat);

            //4.1获取当前方法的权限修饰
        int modifiers = eat.getModifiers();
        System.out.println(modifiers); //2 私有的

        //4.2 获取方法名
        String name = eat.getName();
        System.out.println(name); //eat

        //4.3 获取方法的形参,这里两个参数
        Parameter[] parameters = eat.getParameters();
        System.out.println(Arrays.toString(parameters));
        // [java.lang.String arg0, java.lang.Integer arg1]

        
        //4.4 获取方法的抛出的异常
        Class<?>[] exceptionTypes = eat.getExceptionTypes();
        for (Class<?> exceptionType : exceptionTypes) {
            System.out.println(exceptionType);
        }
        //class java.io.IOException
        //class java.lang.NullPointerException
        //class java.lang.RuntimeException


        //4.5 运行当前方法
        Student student1 = new Student("小明");
        eat.setAccessible(true);//临时获取访问权限（eat是私有的方法）
        String result = (String) eat.invoke(student1, "鱼香肉丝",18);
        System.out.println(result);//这是私有的方法，学生吃鱼香肉丝饭,花了18元

    }
}
```



---



----

# 七、反射的作用

## 获取一个类里面所有的信息，获取到了之后，再执行其他的业务逻辑
## 结合配置文件，动态的创建对象并调用方法

#### 练习1：对于任意一个对象，都可以把对象所有的字段名和值，保存到文件中去

```java
package com.atlml.reflex;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.lang.reflect.Field;

/**
 * 练习1
 *  对于任意一个对象，都可以
 *         把对象所有的字段名和值，
 *         保存到文件中去
 */
public class Practice1 {
    public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, IOException {


        Student student = new Student("小A", 23, '女', 167.5, "睡觉");
        Teacher teacher = new Teacher("波妞", 10000);
        // 思路
//            利用反射，来获取某个对象中的私有成员变量 信息
        saveToFile(student);
        saveToFile(teacher);
    }

    /**
     * 将 对象 中的信息 保存到本地文件中
     */
    public static void saveToFile(Object o) throws NoSuchMethodException, IllegalAccessException, IOException {

        Class<?> aClass = o.getClass();
      /*  //获取构造方法数组
        Constructor[] declaredConstructors = aClass.getDeclaredConstructors();
        for (Constructor declaredConstructor : declaredConstructors) {
            System.out.println(declaredConstructor);
        }*/
        //写到本地文件中
        BufferedWriter bufferedWriter = new BufferedWriter(new FileWriter(new File("javabasis\\aaa\\ObjectMemberVariable.txt"), true));//追加
        //获取所有的 成员变量（公有，私有都存在）
        Field[] declaredFields = aClass.getDeclaredFields();
        for (Field declaredField : declaredFields) {
            //临时取消私有权限
            declaredField.setAccessible(true);

            String name = declaredField.getName(); //name
            Object value = declaredField.get(o);//value

            //成员变量值，每个值都拿出来
            System.out.println(name + "=" + value.toString());
            bufferedWriter.write(name + "=" + value.toString());
            bufferedWriter.newLine();//换一行
        }
        bufferedWriter.close();

    }
}

```



## 练习2：反射可以跟配置文件结合的方式，动态的创建对象，并调用方法

![image-20240720220912010](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407202209151.png)

```java
package com.atlml.reflex;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.Properties;

/**
 *
 * 练习二
 *  反射可以跟配置文件结合的方式，动态的创建对象，并调用方法
 */
public class Practice2 {

    public static void main(String[] args) throws IOException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {



        //1.将配置文件加载到内存中
        // Properties 的父类是一个map集合
        Properties properties = new Properties();
        properties.load(new FileInputStream(new File("javabasis\\src\\main\\resources\\properties.properties")));
        System.out.println(properties);//{classname=com.atlml.reflex.Student, method=study}


        //2.输出配置文件中的内容
        //3.根据配置文件中的全限定类名，反射创建对象，调用方法
        Class clazz = Class.forName(properties.getProperty("classname"));

        //获取构造函数
        Constructor declaredConstructor = clazz.getDeclaredConstructor();
        declaredConstructor.setAccessible(true);//创建对象
        Student student = (Student) declaredConstructor.newInstance();
        System.out.println(student);

        //获取成员方法,并调用。从配置文件中拿到方法名
        Method study = clazz.getDeclaredMethod(properties.getProperty("method"));
        Object invoke = study.invoke(student);//这是公有的方法，学生正在学习


    }


}
```



![image-20240720221217993](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202407202212473.png)















---


----

© 版权声明

<escape>

<div>
    <h3 align="center"  style="color: brown;" >版权声明</h3>
    <table>
   		<tr>
    		<ol>
				<li>本网站名称：𝚲𝚳𝚲</li>
				<li>𝚲𝚳𝚲提供的资源仅供您个人用于非商业性目的。</li>
				<li>本站文章部分内容可能来源于网络，仅供大家学习与参考，如有侵权，请联系我进行删除处理。</li>
				<li>本站一切资源不代表本站立场，并不代表本站赞同其观点和对其真实性负责。</li>
        		<li>本站一律禁止以任何方式发布或转载任何违法的相关信息，访客发现请举报</li> 
        		<li>本站资源大多存储在云盘，如发现链接失效，请联系我，我会第一时间更新。</li>
        		<li>本站强烈打击盗版/破解等有损他人权益和违法作为，请支持正版！</li>  
			</ol>
		</tr>
	</table>
</div>



</escape>

----



