---
title: ç¬¬å…«ç«  å¾®å¤´æ¡é¡¹ç›®å¼€å‘
date: 2019-10-08 16:00:00
author: ğš²ğš³ğš²
tags:   # æ·»åŠ åšæ–‡æ ‡ç­¾
	- javaweb
categories:   # æ·»åŠ åšæ–‡åˆ†ç±»
	- javaweb
---

# ç¬¬å…«ç«  å¾®å¤´æ¡é¡¹ç›®å¼€å‘

# ä¸€ é¡¹ç›®ç®€ä»‹

## 1.1 å¾®å¤´æ¡ä¸šåŠ¡ç®€ä»‹

> å¾®å¤´æ¡æ–°é—»å‘å¸ƒå’Œæµè§ˆå¹³å°,ä¸»è¦åŒ…å«ä¸šåŠ¡å¦‚ä¸‹

+ ç”¨æˆ·åŠŸèƒ½
    + æ³¨å†ŒåŠŸèƒ½
    + ç™»å½•åŠŸèƒ½
+ å¤´æ¡æ–°é—»
    + æ–°é—»çš„åˆ†é¡µæµè§ˆ
    + é€šè¿‡æ ‡é¢˜å…³é”®å­—æœç´¢æ–°é—»
    + æŸ¥çœ‹æ–°é—»è¯¦æƒ…
    + æ–°é—»çš„ä¿®æ”¹å’Œåˆ é™¤
+ æƒé™æ§åˆ¶
    + ç”¨æˆ·åªèƒ½ä¿®æ”¹å’Œè‡ªå·±å‘å¸ƒçš„å¤´æ¡æ–°é—»

## 1.2 æŠ€æœ¯æ ˆä»‹ç»

> å‰ç«¯æŠ€æœ¯æ ˆ

+ ES6ä½œä¸ºåŸºç¡€JSè¯­æ³•
+ nodejsç”¨äºè¿è¡Œç¯å¢ƒ
+ npmç”¨äºé¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·
+ viteç”¨äºé¡¹ç›®çš„æ„å»ºæ¶å·¥å…·
+ Vue3ç”¨äºé¡¹ç›®æ•°æ®çš„æ¸²æŸ“æ¡†æ¶
+ Axiosç”¨äºå‰åç«¯æ•°æ®çš„äº¤äº’
+ Routerç”¨äºé¡µé¢çš„è·³è½¬
+ Piniaç”¨äºå­˜å‚¨ç”¨æˆ·çš„æ•°æ®
+ LocalStorageä½œä¸ºç”¨æˆ·æ ¡éªŒtokençš„å­˜å‚¨æ‰‹æ®µ
+ Element-Plusæä¾›ç»„ä»¶

> åç«¯æŠ€æœ¯æ ˆ

+ JAVAä½œä¸ºå¼€å‘è¯­è¨€,ç‰ˆæœ¬ä¸ºJDK17
+ Tomcatä½œä¸ºæœåŠ¡å®¹å™¨,ç‰ˆæœ¬ä¸º10.1.7
+ Mysql8ç”¨äºé¡¹ç›®å­˜å‚¨æ•°æ®
+ Servletç”¨äºæ§åˆ¶å±‚å®ç°å‰åç«¯æ•°æ®äº¤äº’
+ JDBCç”¨äºå®ç°æ•°æ®çš„CURD
+ Druidç”¨äºæä¾›æ•°æ®æºçš„è¿æ¥æ± 
+ MD5ç”¨äºç”¨æˆ·å¯†ç çš„åŠ å¯†
+ Jwtç”¨äºtokençš„ç”Ÿæˆå’Œæ ¡éªŒ
+ Jacksonç”¨äºè½¬æ¢JSON
+ Filterç”¨äºç”¨æˆ·ç™»å½•æ ¡éªŒå’Œè·¨åŸŸå¤„ç†
+ Lombokç”¨äºå¤„ç†å®ä½“ç±»



## 1.3 åŠŸèƒ½å±•ç¤º

> å¤´æ¡é¦–é¡µä¿¡æ¯æœç´¢

![1687657562841](images/1687657562841.png)

> ç™»å½•åŠŸèƒ½

![1683883374643](images/1683883374643.png)

> æ³¨å†ŒåŠŸèƒ½

![1683883394612](images/1683883394612.png)

> æƒé™æ§åˆ¶åŠŸèƒ½

![1687657603246](images/1687657603246.png)

> å‘å¸ƒå¤´æ¡åŠŸèƒ½

![1683883660552](images/1683883660552.png)

> ä¿®æ”¹å¤´æ¡åŠŸèƒ½

![1683883695289](images/1683883695289.png)

> åˆ é™¤å¤´æ¡åŠŸèƒ½

![1683883724768](images/1683883724768.png)

# äºŒ å‰ç«¯é¡¹ç›®ç¯å¢ƒæ­å»º

+ è§£å‹å‰ç«¯é¡¹ç›®ä»£ç å¹¶å­˜æ”¾åˆ°ç£ç›˜çš„åˆé€‚ä½ç½®



![1683882754527](images/1683882754527.png)

+ ä½¿ç”¨vscodeæ‰“å¼€å·¥ç¨‹

![1683882823511](images/1683882823511.png)



+ è¿›å…¥é¡¹ç›®åæ‰“å¼€é›†æˆç»ˆç«¯æˆ–è€…åœ¨srcä¸Šå³å‡»é€‰æ‹©åœ¨é›†æˆç»ˆç«¯ä¸­æ‰“å¼€

![1683882921502](images/1683882921502.png)

+ é€šè¿‡ npm run devå¯åŠ¨å‰ç«¯é¡¹ç›®

![1683883090728](images/1683883090728.png)

![1683883112782](images/1683883112782.png)

# ä¸‰ åç«¯é¡¹ç›®ç¯å¢ƒæ­å»º

## 3.1  æ•°æ®åº“å‡†å¤‡

> `news_users` ç”¨æˆ·è¡¨

<img src="images/1683188408798.png" alt="1683188408798"  />

> `news_type` æ–°é—»ç±»å‹è¡¨

<img src="images/1683188444555.png" alt="1683188444555"  />

> `news_headline` æ–°é—»ä¿¡æ¯è¡¨

<img src="images/1683188471933.png" alt="1683188471933"  />

> æ•°æ®åº“åˆ›å»ºSQL

+ å¯¼å…¥èµ„æ–™ä¸­çš„top_news.sqlæ–‡ä»¶å³å¯

## 3.2 MVCé¡¹ç›®æ¶æ„æ¨¡å¼

>  MVCï¼ˆModel View Controllerï¼‰æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€ç§**`è½¯ä»¶æ¶æ„æ¨¡å¼`**ï¼Œå®ƒæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸º**`æ¨¡å‹`**ã€**`è§†å›¾`**å’Œ**`æ§åˆ¶å™¨`**ä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ã€‚ç”¨ä¸€ç§ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€ç•Œé¢æ˜¾ç¤ºåˆ†ç¦»çš„æ–¹æ³•ç»„ç»‡ä»£ç ï¼Œå°†ä¸šåŠ¡é€»è¾‘èšé›†åˆ°ä¸€ä¸ªéƒ¨ä»¶é‡Œé¢ï¼Œåœ¨æ”¹è¿›å’Œä¸ªæ€§åŒ–å®šåˆ¶ç•Œé¢åŠç”¨æˆ·äº¤äº’çš„åŒæ—¶ï¼Œä¸éœ€è¦é‡æ–°ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚

+ **M**ï¼šModel æ¨¡å‹å±‚,å…·ä½“åŠŸèƒ½å¦‚ä¸‹
    1. å­˜æ”¾å’Œæ•°æ®åº“å¯¹è±¡çš„å®ä½“ç±»ä»¥åŠä¸€äº›ç”¨äºå­˜å‚¨éæ•°æ®åº“è¡¨å®Œæ•´ç›¸å…³çš„VOå¯¹è±¡
    2. å­˜æ”¾ä¸€äº›å¯¹æ•°æ®è¿›è¡Œé€»è¾‘è¿ç®—æ“ä½œçš„çš„ä¸€äº›ä¸šåŠ¡å¤„ç†ä»£ç 

+ **V**ï¼šView è§†å›¾å±‚,å…·ä½“åŠŸèƒ½å¦‚ä¸‹
    1. å­˜æ”¾ä¸€äº›è§†å›¾æ–‡ä»¶ç›¸å…³çš„ä»£ç  html css jsç­‰
    2. åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­,åç«¯å·²ç»æ²¡æœ‰è§†å›¾æ–‡ä»¶,è¯¥å±‚æ¬¡å·²ç»è¡åŒ–æˆç‹¬ç«‹çš„å‰ç«¯é¡¹ç›®

+ **C**ï¼šController æ§åˆ¶å±‚,å…·ä½“åŠŸèƒ½å¦‚ä¸‹
    	1. æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚,è·å¾—è¯·æ±‚æ•°æ®
      2. å°†å‡†å¤‡å¥½çš„æ•°æ®å“åº”ç»™å®¢æˆ·ç«¯

> MVCæ¨¡å¼ä¸‹,é¡¹ç›®ä¸­çš„å¸¸è§åŒ…

+ M:
    1. å®ä½“ç±»åŒ…(pojo /entity /bean) ä¸“é—¨å­˜æ”¾å’Œæ•°æ®åº“å¯¹åº”çš„å®ä½“ç±»å’Œä¸€äº›VOå¯¹è±¡
    2. æ•°æ®åº“è®¿é—®åŒ…(dao/mapper)  ä¸“é—¨å­˜æ”¾å¯¹æ•°æ®åº“ä¸åŒè¡¨æ ¼CURDæ–¹æ³•å°è£…çš„ä¸€äº›ç±»
    3. æœåŠ¡åŒ…(service)                       ä¸“é—¨å­˜æ”¾å¯¹æ•°æ®è¿›è¡Œä¸šåŠ¡é€»è¾‘é¢„ç®—çš„ä¸€äº›ç±»

+ C:
    1. æ§åˆ¶å±‚åŒ…(controller)

+ V:
    1. webç›®å½•ä¸‹çš„è§†å›¾èµ„æº html css js img ç­‰
    2. å‰ç«¯å·¥ç¨‹åŒ–å,åœ¨åç«¯é¡¹ç›®ä¸­å·²ç»ä¸å­˜åœ¨äº†

![1683363039636](images/1683363039636.png)

## 3.3 æ­å»ºé¡¹ç›®

### 3.3.1 åˆ›å»ºWEBé¡¹ç›®

![1683350231551](images/1683350231551.png)

### 3.3.2 å¯¼å…¥ä¾èµ–

![1683351095131](images/1683351095131.png)

### 3.3.3 å‡†å¤‡åŒ…ç»“æ„

![1683350275719](images/1683350275719.png)

+ controller æ§åˆ¶å±‚ä»£ç ,ä¸»è¦ç”±Servletç»„æˆ
+ service     æœåŠ¡å±‚ä»£ç ,ä¸»è¦ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘
+ dao          æ•°æ®è®¿é—®å±‚,ä¸»è¦ç”¨æˆ·å®šä¹‰å¯¹äºå„ä¸ªè¡¨æ ¼çš„CURDçš„æ–¹æ³•
+ pojo         å®ä½“ç±»å±‚,ä¸»è¦ç”¨äºå­˜æ”¾å’Œæ•°æ®åº“å¯¹åº”çš„å®ä½“ç±»ä»¥åŠä¸€äº›VOå¯¹è±¡
+ util           å·¥å…·ç±»åŒ…,ä¸»è¦ç”¨å­˜æ”¾ä¸€äº›å·¥å…·ç±»
+ common  å…¬å…±åŒ…,ä¸»è¦ç”¨æˆ·å­˜æ”¾ä¸€äº›å…¶ä»–å…¬å…±ä»£ç 
+ filters       è¿‡æ»¤å™¨åŒ…,ä¸“é—¨ç”¨äºå­˜æ”¾ä¸€äº›è¿‡æ»¤å™¨
+ test          æµ‹è¯•ä»£ç åŒ…,ä¸“é—¨ç”¨äºå®šä¹‰ä¸€äº›æµ‹è¯•çš„åŠŸèƒ½ä»£ç ,ä¸Šçº¿å‰åº”è¯¥åˆ æ‰,åæœŸç”¨mavenå¯ä»¥è‡ªåŠ¨å¤„ç†æ‰

## 3.5 å‡†å¤‡å·¥å…·ç±»

### 3.5.1 å¼‚æ­¥å“åº”è§„èŒƒæ ¼å¼ç±»

+ Resultç±»

```java
package com.atguigu.headline.common;

/**
 * å…¨å±€ç»Ÿä¸€è¿”å›ç»“æœç±»
 *
 */
public class Result<T> {
    // è¿”å›ç 
    private Integer code;
    // è¿”å›æ¶ˆæ¯
    private String message;
    // è¿”å›æ•°æ®
    private T data;
    public Result(){}
    // è¿”å›æ•°æ®
    protected static <T> Result<T> build(T data) {
        Result<T> result = new Result<T>();
        if (data != null)
            result.setData(data);
        return result;
    }
    public static <T> Result<T> build(T body, Integer code, String message) {
        Result<T> result = build(body);
        result.setCode(code);
        result.setMessage(message);
        return result;
    }
    public static <T> Result<T> build(T body, ResultCodeEnum resultCodeEnum) {
        Result<T> result = build(body);
        result.setCode(resultCodeEnum.getCode());
        result.setMessage(resultCodeEnum.getMessage());
        return result;
    }
    /**
     * æ“ä½œæˆåŠŸ
     * @param data  baseCategory1List
     * @param <T>
     * @return
     */
    public static<T> Result<T> ok(T data){
        Result<T> result = build(data);
        return build(data, ResultCodeEnum.SUCCESS);
    }
    public Result<T> message(String msg){
        this.setMessage(msg);
        return this;
    }
    public Result<T> code(Integer code){
        this.setCode(code);
        return this;
    }
    public Integer getCode() {
        return code;
    }
    public void setCode(Integer code) {
        this.code = code;
    }
    public String getMessage() {
        return message;
    }
    public void setMessage(String message) {
        this.message = message;
    }
    public T getData() {
        return data;
    }
    public void setData(T data) {
        this.data = data;
    }
}
```

+ ResultCodeEnum æšä¸¾ç±»

``` java
package com.atguigu.headline.common;
/**
 * ç»Ÿä¸€è¿”å›ç»“æœçŠ¶æ€ä¿¡æ¯ç±»
 *
 */
public enum ResultCodeEnum {

    SUCCESS(200,"success"),
    USERNAME_ERROR(501,"usernameError"),
    PASSWORD_ERROR(503,"passwordError"),
    NOTLOGIN(504,"notLogin"),
    USERNAME_USED(505,"userNameUsed")
    ;

    private Integer code;
    private String message;
    private ResultCodeEnum(Integer code, String message) {
        this.code = code;
        this.message = message;
    }
    public Integer getCode() {
        return code;
    }
    public String getMessage() {
        return message;
    }
}

```



### 3.5.2 MD5åŠ å¯†å·¥å…·ç±»



``` java
package com.atguigu.headline.util;

import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

public final class MD5Util {
    public static String encrypt(String strSrc) {
        try {
            char hexChars[] = { '0', '1', '2', '3', '4', '5', '6', '7', '8',
                    '9', 'a', 'b', 'c', 'd', 'e', 'f' };
            byte[] bytes = strSrc.getBytes();
            MessageDigest md = MessageDigest.getInstance("MD5");
            md.update(bytes);
            bytes = md.digest();
            int j = bytes.length;
            char[] chars = new char[j * 2];
            int k = 0;
            for (int i = 0; i < bytes.length; i++) {
                byte b = bytes[i];
                chars[k++] = hexChars[b >>> 4 & 0xf];
                chars[k++] = hexChars[b & 0xf];
            }
            return new String(chars);
        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
            throw new RuntimeException("MD5åŠ å¯†å‡ºé”™ï¼ï¼+" + e);
        }
    }
}

```

### 3.5.3 JDBCUtilè¿æ¥æ± å·¥å…·ç±»



``` java
package com.atguigu.headline.util;

import com.alibaba.druid.pool.DruidDataSourceFactory;

import javax.sql.DataSource;
import java.io.IOException;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.SQLException;
import java.util.Properties;

public class JDBCUtil {
    private static ThreadLocal<Connection> threadLocal =new ThreadLocal<>();

    private static DataSource dataSource;
    // åˆå§‹åŒ–è¿æ¥æ± 
    static{
        // å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¯»å–.propertiesé…ç½®æ–‡ä»¶
        Properties properties =new Properties();
        InputStream resourceAsStream = JDBCUtil.class.getClassLoader().getResourceAsStream("jdbc.properties");
        try {
            properties.load(resourceAsStream);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }

        try {
            dataSource = DruidDataSourceFactory.createDataSource(properties);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }


    }
    /*1 å‘å¤–æä¾›è¿æ¥æ± çš„æ–¹æ³•*/
    public static DataSource getDataSource(){
        return dataSource;
    }

    /*2 å‘å¤–æä¾›è¿æ¥çš„æ–¹æ³•*/
    public static Connection getConnection(){
        Connection connection = threadLocal.get();
        if (null == connection) {
            try {
                connection = dataSource.getConnection();
            } catch (SQLException e) {
                throw new RuntimeException(e);
            }
            threadLocal.set(connection);
        }

        return connection;
    }


    /*å®šä¹‰ä¸€ä¸ªå½’è¿˜è¿æ¥çš„æ–¹æ³• (è§£é™¤å’ŒThreadLocalä¹‹é—´çš„å…³è”å…³ç³») */
    public static void releaseConnection(){
        Connection connection = threadLocal.get();
        if (null != connection) {
            threadLocal.remove();
            // æŠŠè¿æ¥è®¾ç½®å›è‡ªåŠ¨æäº¤çš„è¿æ¥
            try {
                connection.setAutoCommit(true);
                // è‡ªåŠ¨å½’è¿˜åˆ°è¿æ¥æ± 
                connection.close();
            } catch (SQLException e) {
                throw new RuntimeException(e);
            }
        }
    }
}

```

+ æ·»åŠ jdbc.propertiesé…ç½®æ–‡ä»¶

``` properties
driverClassName=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/top_news
username=root
password=root
initialSize=5
maxActive=10
maxWait=1000
```

###  3.5.4  JwtHelperå·¥å…·ç±»

``` java
package com.atguigu.headline.util;

import com.alibaba.druid.util.StringUtils;
import io.jsonwebtoken.*;

import java.util.Date;

public class JwtHelper {
    private static long tokenExpiration = 24*60*60*1000;
    private static String tokenSignKey = "123456";

    //ç”Ÿæˆtokenå­—ç¬¦ä¸²
    public static String createToken(Long userId) {
        String token = Jwts.builder()

                .setSubject("YYGH-USER")
                .setExpiration(new Date(System.currentTimeMillis() + tokenExpiration))
                .claim("userId", userId)
                .signWith(SignatureAlgorithm.HS512, tokenSignKey)
                .compressWith(CompressionCodecs.GZIP)
                .compact();
        return token;
    }

    //ä»tokenå­—ç¬¦ä¸²è·å–userid
    public static Long getUserId(String token) {
        if(StringUtils.isEmpty(token)) return null;
        Jws<Claims> claimsJws = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token);
        Claims claims = claimsJws.getBody();
        Integer userId = (Integer)claims.get("userId");
        return userId.longValue();
    }



    //åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆ
    public static boolean isExpiration(String token){
        try {
            boolean isExpire = Jwts.parser()
                    .setSigningKey(tokenSignKey)
                    .parseClaimsJws(token)
                    .getBody()
                    .getExpiration().before(new Date());
            //æ²¡æœ‰è¿‡æœŸï¼Œæœ‰æ•ˆï¼Œè¿”å›false
            return isExpire;
        }catch(Exception e) {
            //è¿‡æœŸå‡ºç°å¼‚å¸¸ï¼Œè¿”å›true
            return true;
        }
    }
}

```

### 3.5.5 JSONè½¬æ¢çš„WEBUtilå·¥å…·ç±»

``` java
package com.atguigu.headline.util;

import com.atguigu.headline.common.Result;
import com.fasterxml.jackson.databind.ObjectMapper;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.BufferedReader;
import java.io.IOException;
import java.text.SimpleDateFormat;

public class WebUtil {
    private static ObjectMapper objectMapper;
    // åˆå§‹åŒ–objectMapper
    static{
        objectMapper=new ObjectMapper();
        // è®¾ç½®JSONå’ŒObjectè½¬æ¢æ—¶çš„æ—¶é—´æ—¥æœŸæ ¼å¼
        objectMapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));
    }
	// ä»è¯·æ±‚ä¸­è·å–JSONä¸²å¹¶è½¬æ¢ä¸ºObject
    public static <T> T readJson(HttpServletRequest request,Class<T> clazz){
        T t =null;
        BufferedReader reader = null;
        try {
            reader = request.getReader();
            StringBuffer buffer =new StringBuffer();
            String line =null;
            while((line = reader.readLine())!= null){
                buffer.append(line);
            }

            t= objectMapper.readValue(buffer.toString(),clazz);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        return t;
    }
	// å°†Resultå¯¹è±¡è½¬æ¢æˆJSONä¸²å¹¶æ”¾å…¥å“åº”å¯¹è±¡
    public static void writeJson(HttpServletResponse response, Result result){
        response.setContentType("application/json;charset=UTF-8");
        try {
            String json = objectMapper.writeValueAsString(result);
            response.getWriter().write(json);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
```

## 3.6 å‡†å¤‡å„å±‚çš„æ¥å£å’Œå®ç°ç±»

### 3.6.1 å‡†å¤‡å®ä½“ç±»å’ŒVOå¯¹è±¡

> NewsUser

``` java
package com.atguigu.headline.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class NewsUser implements Serializable {
    private Integer uid;
    private String username;
    private String userPwd;
    private String nickName;
}
```

> NewsType

``` java
package com.atguigu.headline.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class NewsType implements Serializable {
    private Integer tid;
    private String tname;
}
```

> NewsHeadline

``` java
package com.atguigu.headline.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;
import java.util.Date;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class NewsHeadline implements Serializable {
    private Integer hid;
    private String title;
    private String article;
    private Integer type;
    private Integer publisher;
    private Integer pageViews;
    private Date createTime;
    private Date updateTime;
    private Integer isDeleted;

}
```

> HeadlineQueryVo

``` java
package com.atguigu.headline.pojo.vo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class HeadlineQueryVo implements Serializable {
    private String keyWords;
    private Integer type ;
    private Integer pageNum;
    private Integer pageSize;
}

```

> HeadlinePageVo

``` java
package com.atguigu.headline.pojo.vo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class HeadlinePageVo implements Serializable {
    private Integer hid;
    private String title;
    private Integer type;
    private Integer pageViews;
    private Long pastHours;
    private Integer publisher;
}
```

> HeadlineDetailVo

``` java
package com.atguigu.headline.pojo.vo;


import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class HeadlineDetailVo implements Serializable {
    private Integer hid;
    private String title;
    private String article;
    private Integer type;
    private String typeName;
    private Integer pageViews;
    private Long pastHours;
    private Integer publisher;
    private String author;
}

```

### 3.6.2 DAOå±‚æ¥å£å’Œå®ç°ç±»

![1683354561889](images/1683354561889.png)

> BaseDaoåŸºç¡€ç±»,å°è£…äº†å…¬å…±çš„æŸ¥è¯¢æ–¹æ³•å’Œå…¬å…±çš„å¢åˆ æ”¹æ–¹æ³•

+ `æ³¨æ„,æ‰€æœ‰çš„Daoæ¥å£çš„å®ç°ç±»éƒ½è¦ç»§æ‰¿BaseDao`

``` java
package com.atguigu.headline.dao;


import com.atguigu.headline.util.JDBCUtil;
import java.lang.reflect.Field;
import java.sql.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

public class BaseDao {
    // å…¬å…±çš„æŸ¥è¯¢æ–¹æ³•  è¿”å›çš„æ˜¯å•ä¸ªå¯¹è±¡
    public <T> T baseQueryObject(Class<T> clazz, String sql, Object ... args) {
        T t = null;
        Connection connection = JDBCUtil.getConnection();
        PreparedStatement preparedStatement = null;
        ResultSet resultSet = null;
        int rows = 0;
        try {
            // å‡†å¤‡è¯­å¥å¯¹è±¡
            preparedStatement = connection.prepareStatement(sql);
            // è®¾ç½®è¯­å¥ä¸Šçš„å‚æ•°
            for (int i = 0; i < args.length; i++) {
                preparedStatement.setObject(i + 1, args[i]);
            }

            // æ‰§è¡Œ æŸ¥è¯¢
            resultSet = preparedStatement.executeQuery();
            if (resultSet.next()) {
                t = (T) resultSet.getObject(1);
            }
        } catch (Exception e) {
            throw new RuntimeException(e);
        } finally {
            if (null != resultSet) {
                try {
                    resultSet.close();
                } catch (SQLException e) {
                    throw new RuntimeException(e);
                }
            }
            if (null != preparedStatement) {
                try {
                    preparedStatement.close();
                } catch (SQLException e) {
                    throw new RuntimeException(e);
                }

            }
            JDBCUtil.releaseConnection();
        }
        return t;
    }
    // å…¬å…±çš„æŸ¥è¯¢æ–¹æ³•  è¿”å›çš„æ˜¯å¯¹è±¡çš„é›†åˆ

    public <T> List<T> baseQuery(Class clazz, String sql, Object ... args){
        List<T> list =new ArrayList<>();
        Connection connection = JDBCUtil.getConnection();
        PreparedStatement preparedStatement=null;
        ResultSet resultSet =null;
        int rows = 0;
        try {
            // å‡†å¤‡è¯­å¥å¯¹è±¡
            preparedStatement = connection.prepareStatement(sql);
            // è®¾ç½®è¯­å¥ä¸Šçš„å‚æ•°
            for (int i = 0; i < args.length; i++) {
                preparedStatement.setObject(i+1,args[i]);
            }

            // æ‰§è¡Œ æŸ¥è¯¢
            resultSet = preparedStatement.executeQuery();

            ResultSetMetaData metaData = resultSet.getMetaData();
            int columnCount = metaData.getColumnCount();

            // å°†ç»“æœé›†é€šè¿‡åå°„å°è£…æˆå®ä½“ç±»å¯¹è±¡
            while (resultSet.next()) {
                // ä½¿ç”¨åå°„å®ä¾‹åŒ–å¯¹è±¡
                Object obj =clazz.getDeclaredConstructor().newInstance();

                for (int i = 1; i <= columnCount; i++) {
                    String columnName = metaData.getColumnLabel(i);
                    Object value = resultSet.getObject(columnName);
                    // å¤„ç†datetimeç±»å‹å­—æ®µå’Œjava.util.Dataè½¬æ¢é—®é¢˜
                    if(value.getClass().equals(LocalDateTime.class)){
                        value= Timestamp.valueOf((LocalDateTime) value);
                    }
                    Field field = clazz.getDeclaredField(columnName);
                    field.setAccessible(true);
                    field.set(obj,value);
                }

                list.add((T)obj);
            }

        } catch (Exception e) {
            throw new RuntimeException(e);
        } finally {
            if (null !=resultSet) {
                try {
                    resultSet.close();
                } catch (SQLException e) {
                    throw new RuntimeException(e);
                }
            }
            if (null != preparedStatement) {
                try {
                    preparedStatement.close();
                } catch (SQLException e) {
                    throw new RuntimeException(e);
                }
            }
            JDBCUtil.releaseConnection();
        }
        return list;
    }
    
    // é€šç”¨çš„å¢åˆ æ”¹æ–¹æ³•
    public int baseUpdate(String sql,Object ... args) {
        // è·å–è¿æ¥
        Connection connection = JDBCUtil.getConnection();
        PreparedStatement preparedStatement=null;
        int rows = 0;
        try {
            // å‡†å¤‡è¯­å¥å¯¹è±¡
            preparedStatement = connection.prepareStatement(sql);
            // è®¾ç½®è¯­å¥ä¸Šçš„å‚æ•°
            for (int i = 0; i < args.length; i++) {
                preparedStatement.setObject(i+1,args[i]);
            }

            // æ‰§è¡Œ å¢åˆ æ”¹ executeUpdate
            rows = preparedStatement.executeUpdate();
            // é‡Šæ”¾èµ„æº(å¯é€‰)


        } catch (SQLException e) {
            throw new RuntimeException(e);
        } finally {
            if (null != preparedStatement) {
                try {
                    preparedStatement.close();
                } catch (SQLException e) {
                    throw new RuntimeException(e);
                }

            }
            JDBCUtil.releaseConnection();
        }
        // è¿”å›çš„æ˜¯å½±å“æ•°æ®åº“è®°å½•æ•°
        return rows;
    }
}

```

> daoå±‚çš„æ‰€æœ‰æ¥å£

``` java
package com.atguigu.headline.dao;
public interface NewsHeadLineDao {
    
}

package com.atguigu.headline.dao;
public interface NewsTypeDao {
    
}


package com.atguigu.headline.dao;
public interface NewsUserDao {

}

```

> daoå±‚æ‰€æœ‰å®ç°ç±»

``` java
package com.atguigu.headline.dao.impl;
import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao{
    
}

package com.atguigu.headline.dao.impl;
import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsTypeDao;
public class NewsTypeDaoImpl extends BaseDao implements NewsTypeDao{
    
}

package com.atguigu.headline.dao.impl;
import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsUserDao;
public class NewsUserDaoImpl extends BaseDao implements NewsUserDao{
    
}
```

### 3.6.3 Serviceå±‚æ¥å£å’Œå®ç°ç±»

![1683354989263](images/1683354989263.png)

> serviceå±‚æ‰€æœ‰æ¥å£

``` java
package com.atguigu.headline.service;
public interface NewsHeadlineService {
    
}

package com.atguigu.headline.service;
public interface NewsTypeService {
    List<NewsType> findAll();
}

package com.atguigu.headline.service;
public interface NewsUserService {
    
}
```

> serviceå±‚æ‰€æœ‰å®ç°ç±»

``` java
package com.atguigu.headline.service.impl;
import com.atguigu.headline.service.NewsHeadlineService;
public class NewsHeadlineServiceImpl  implements NewsHeadlineService {
}


package com.atguigu.headline.service.impl;
import com.atguigu.headline.service.NewsTypeService;
public class NewsTypeServiceImpl implements NewsTypeService {
  
}

package com.atguigu.headline.service.impl;
import com.atguigu.headline.service.NewsUserService;
public class NewsUserServiceImpl implements NewsUserService {
   
}

```

### 3.6.4 Controllerå±‚æ¥å£å’Œå®ç°ç±»

> BaseController ç”¨äºå°†è·¯å¾„å…³è”åˆ°å¤„ç†æ–¹æ³•çš„åŸºç¡€æ§åˆ¶å™¨

+ `æ‰€æœ‰çš„Controlleréƒ½è¦ç»§æ‰¿è¯¥ç±»`

``` java
package com.atguigu.headline.controller;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.lang.reflect.Method;

public class BaseController extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å“åº”çš„MIMEç±»å‹å’Œä¹±ç é—®é¢˜
        resp.setContentType("application/json;charset=UTF-8");

        String requestURI = req.getRequestURI();
        String[] split = requestURI.split("/");
        String methodName =split[split.length-1];
        // é€šè¿‡åå°„è·å–è¦æ‰§è¡Œçš„æ–¹æ³•
        Class clazz = this.getClass();
        try {
            Method method=clazz.getDeclaredMethod(methodName,HttpServletRequest.class,HttpServletResponse.class);
            // è®¾ç½®æ–¹æ³•å¯ä»¥è®¿é—®
            method.setAccessible(true);
            // é€šè¿‡åå°„æ‰§è¡Œä»£ç 
            method.invoke(this,req,resp);
        } catch (Exception e) {
            e.printStackTrace();
            throw new RuntimeException(e.getMessage());
        }
    }
}

```

> æ‰€æœ‰çš„Controllerç±»

``` java
package com.atguigu.headline.controller;
import jakarta.servlet.annotation.WebServlet;
@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {
    
}

package com.atguigu.headline.controller;
import jakarta.servlet.annotation.WebServlet;
@WebServlet("/type/*")
public class NewsTypeController {
    
}

package com.atguigu.headline.controller;
import jakarta.servlet.annotation.WebServlet;
@WebServlet("/user/*")
public class NewsUserController extends BaseController{
    
}

package com.atguigu.headline.controller;
import jakarta.servlet.annotation.WebServlet;
@WebServlet("/portal/*")
public class PortalController extends BaseController{
    
}

```

## 3.7 å¼€å‘è·¨åŸŸCORSè¿‡æ»¤å™¨

### 3.7.1 ä»€ä¹ˆæ˜¯è·¨åŸŸ

> åŒæºç­–ç•¥ï¼ˆSameoriginpolicyï¼‰æ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœç¼ºå°‘äº†åŒæºç­–ç•¥ï¼Œåˆ™æµè§ˆå™¨çš„æ­£å¸¸åŠŸèƒ½å¯èƒ½éƒ½ä¼šå—åˆ°å½±å“ã€‚å¯ä»¥è¯´Webæ˜¯æ„å»ºåœ¨åŒæºç­–ç•¥åŸºç¡€ä¹‹ä¸Šçš„ï¼Œæµè§ˆå™¨åªæ˜¯é’ˆå¯¹åŒæºç­–ç•¥çš„ä¸€ç§å®ç°ã€‚**`åŒæºç­–ç•¥ä¼šé˜»æ­¢ä¸€ä¸ªåŸŸçš„javascriptè„šæœ¬å’Œå¦å¤–ä¸€ä¸ªåŸŸçš„å†…å®¹è¿›è¡Œäº¤äº’ã€‚æ‰€è°“åŒæºï¼ˆå³æŒ‡åœ¨åŒä¸€ä¸ªåŸŸï¼‰å°±æ˜¯ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„åè®®ï¼ˆprotocolï¼‰ï¼Œä¸»æœºï¼ˆhostï¼‰å’Œç«¯å£å·`**

### 3.7.2 ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè·¨åŸŸ

> å‰åç«¯åˆ†ç¦»æ¨¡å¼ä¸‹,å®¢æˆ·ç«¯è¯·æ±‚å‰ç«¯æœåŠ¡å™¨è·å–è§†å›¾èµ„æº,ç„¶åå®¢æˆ·ç«¯è‡ªè¡Œå‘åç«¯æœåŠ¡å™¨è·å–æ•°æ®èµ„æº,å‰ç«¯æœåŠ¡å™¨çš„ åè®®,IPå’Œç«¯å£å’Œåç«¯æœåŠ¡å™¨å¾ˆå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„,è¿™æ ·å°±äº§ç”Ÿäº†è·¨åŸŸ

![1683364198087](images/1683364198087.png)

### 3.7.3 å¦‚ä½•è§£å†³è·¨åŸŸ

> å‰ç«¯é¡¹ç›®ä»£ç†æ¨¡å¼å¤„ç†

![1683365066926](images/1683365066926.png)



> åç«¯è·¨åŸŸè¿‡æ»¤å™¨æ–¹å¼å¤„ç†

![1683364436315](images/1683364436315.png)

+ CrosFilterè¿‡æ»¤å™¨

``` java
package com.atguigu.headline.filters;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebFilter;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

@WebFilter("/*")
public class CrosFilter implements Filter {
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletResponse response = (HttpServletResponse) servletResponse;
        HttpServletRequest request =(HttpServletRequest) servletRequest;
        response.setHeader("Access-Control-Allow-Origin", "*");
        response.setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS, DELETE, HEAD");
        response.setHeader("Access-Control-Max-Age", "3600");
        response.setHeader("Access-Control-Allow-Headers", "access-control-allow-origin, authority, content-type, version-info, X-Requested-With");
        // éé¢„æ£€è¯·æ±‚,æ”¾è¡Œå³å¯,é¢„æ£€è¯·æ±‚,åˆ™åˆ°æ­¤ç»“æŸ,ä¸éœ€è¦æ”¾è¡Œ
        if(!request.getMethod().equalsIgnoreCase("OPTIONS")){
            filterChain.doFilter(servletRequest, servletResponse);
        }
    }
}
```



+ æœªæ¥æˆ‘ä»¬ä½¿ç”¨æ¡†æ¶,ç›´æ¥ç”¨ä¸€ä¸ª@CrossOrigin å°±å¯ä»¥è§£å†³è·¨åŸŸé—®é¢˜äº†

# å›› PostManæµ‹è¯•å·¥å…·

## 4.1 ä»€ä¹ˆæ˜¯PostMan

+  Postmanæ˜¯ä¸€ä¸ª**`æ¥å£æµ‹è¯•å·¥å…·`**,åœ¨åšæ¥å£æµ‹è¯•çš„æ—¶å€™,Postmanç›¸å½“äºä¸€ä¸ªå®¢æˆ·ç«¯,å®ƒå¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·å‘èµ·çš„å„ç±»HTTPè¯·æ±‚,å°†è¯·æ±‚æ•°æ®å‘é€è‡³æœåŠ¡ç«¯,è·å–å¯¹åº”çš„å“åº”ç»“æœ, ä»è€ŒéªŒè¯å“åº”ä¸­çš„ç»“æœæ•°æ®æ˜¯å¦å’Œé¢„æœŸå€¼ç›¸åŒ¹é…;å¹¶ç¡®ä¿å¼€å‘äººå‘˜èƒ½å¤ŸåŠæ—¶å¤„ç†æ¥å£ä¸­çš„bug,è¿›è€Œä¿è¯äº§å“ä¸Šçº¿ä¹‹åçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚ å®ƒä¸»è¦æ˜¯ç”¨æ¥æ¨¡æ‹Ÿå„ç§HTTPè¯·æ±‚çš„(å¦‚:get/post/delete/put..ç­‰ç­‰),Postmanä¸æµè§ˆå™¨çš„åŒºåˆ«åœ¨äºæœ‰çš„æµè§ˆå™¨ä¸èƒ½è¾“å‡ºJsonæ ¼å¼,è€ŒPostmanæ›´ç›´è§‚æ¥å£è¿”å›çš„ç»“æœã€‚ 

## 4.2 æ€ä¹ˆå®‰è£…PostMan

+ å®˜ç½‘ä¸‹è½½åœ°å€: https://www.getpostman.com ,æˆ–è€…ä½¿ç”¨èµ„æ–™ä¸­æä¾›çš„å®‰è£…åŒ…
+ å®‰è£…è¿‡ç¨‹ç®€å•,ä¸€è·¯nextå³å¯
+  ç¬¬ä¸€æ¬¡å¯åŠ¨postman ä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå…³é—­ï¼Œå†æ¬¡å¯åŠ¨å°±å¯ä»¥ç›´æ¥è¿›å…¥äº† 

## 4.3 æ€ä¹ˆä½¿ç”¨PostMan

> å¯åŠ¨PostManå,åˆ›å»ºä¸€ä¸ªcollection,åœ¨è¯¥collectionä¸‹ä¸“é—¨å­˜æ”¾å’Œå¾®å¤´æ¡é¡¹ç›®ç›¸å…³çš„æµ‹è¯•

<img src="images/1683385255826.png" alt="1683385255826" style="zoom: 65%;" />

> åˆ›å»ºå®Œæ¯•å,å¢åŠ æ–°çš„æ¥å£æµ‹è¯•

<img src="images/1683385333460.png" alt="1683385333460" style="zoom:50%;" />

> å¡«å†™è¦æµ‹è¯•çš„æ¥å£ç›¸å…³çš„è·¯å¾„,å‚æ•°,è¯·æ±‚ä½“å†…å®¹ç­‰ä¿¡æ¯

<img src="images/1683385500897.png" alt="1683385500897" style="zoom:55%;" />

> æµ‹è¯•å®Œæ¯•å,å¯ä»¥é€‰æ‹©å°†è¯¥æ¥å£çš„æµ‹è¯•è¿›è¡Œä¿å­˜,æ–¹ä¾¿åç»­éšæ—¶å†æ¬¡æµ‹è¯•

<img src="images/1683385608824.png" alt="1683385608824" style="zoom:55%;" />





# äº” ç™»å½•æ³¨å†ŒåŠŸèƒ½

## 5.1 ç™»å½•è¡¨å•æäº¤

![1687657661761](images/1687657661761.png)

> éœ€æ±‚æè¿°

+ ç”¨æˆ·åœ¨å®¢æˆ·ç«¯è¾“å…¥ç”¨æˆ·åå¯†ç å¹¶å‘åç«¯æäº¤,åç«¯æ ¹æ®ç”¨æˆ·åå’Œå¯†ç åˆ¤æ–­ç™»å½•æ˜¯å¦æˆåŠŸ,ç”¨æˆ·æœ‰è¯¯æˆ–è€…å¯†ç æœ‰è¯¯å“åº”ä¸åŒçš„æç¤ºä¿¡æ¯

> uri: 

``` http
user/login
```

> è¯·æ±‚æ–¹å¼:

``` http
POST
```

> è¯·æ±‚å‚æ•°

``` json
{
    "username":"zhangsan", //ç”¨æˆ·å
    "userPwd":"123456"     //æ˜æ–‡å¯†ç 
}
```

> å“åº”ç¤ºä¾‹

+ ç™»å½•æˆåŠŸ

``` json
{
    "code":"200",         // æˆåŠŸçŠ¶æ€ç  
 	"message":"success"   // æˆåŠŸçŠ¶æ€æè¿°
 	"data":{
		"token":"... ..." // ç”¨æˆ·idçš„token
	}
}
```

+ ç”¨æˆ·åæœ‰è¯¯

``` json
{
    "code":"501",
 	"message":"ç”¨æˆ·åæœ‰è¯¯"
 	"data":{}
}
```

+ å¯†ç æœ‰è¯¯

``` json
{
    "code":"503",
 	"message":"å¯†ç æœ‰è¯¯"
 	"data":{}
}
```

> åç«¯ä»£ç 

+ NewsUserController

``` java
package com.atguigu.headline.controller;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;


@WebServlet("/user/*")
public class NewsUserController extends BaseController{

    private NewsUserService newsUserService =new NewsUserServiceImpl();
     /**
     * ç™»å½•éªŒè¯
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void login(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        NewsUser newsUser = WebUtil.readJson(req, NewsUser.class);

        Result result =null;
        NewsUser loginNewsUser =newsUserService.findByUserName(newsUser.getUsername());
        // åˆ¤æ–­ç”¨æˆ·å
        if (null != loginNewsUser) {
            // åˆ¤æ–­å¯†ç 
            if(loginNewsUser.getUserPwd().equals(MD5Util.encrypt(newsUser.getUserPwd()))){
                // å¯†ç æ­£ç¡®
                Map<String,Object> data =new HashMap<>();
                // ç”Ÿæˆtokenå£ä»¤
                String token = JwtHelper.createToken(loginNewsUser.getUid().longValue());
                // å°è£…æ•°æ®map
                data.put("token",token);
                // å°è£…ç»“æœ
                result=Result.ok(data);
            }else{
                // å°è£…å¯†ç é”™è¯¯ç»“æœ
                result=Result.build(null, ResultCodeEnum.PASSWORD_ERROR);
            }
        }else{
            // å°è£…ç”¨æˆ·åé”™è¯¯ç»“æœ
            result=Result.build(null, ResultCodeEnum.USERNAME_ERROR);
        }
        // å“åº”ç»“æœ
        WebUtil.writeJson(resp,result);
    }
}
```

+ NewsUserService

``` java
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserService {
    /**
     * æ ¹æ®ç”¨æˆ·å,è·å¾—æŸ¥è¯¢ç”¨æˆ·çš„æ–¹æ³•
     * @param username è¦æŸ¥è¯¢çš„ç”¨æˆ·å
     * @return å¦‚æœæ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
     */
    NewsUser findByUserName(String username);
}
```

+ NewsUserServiceImpl

``` java 
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.dao.impl.NewsUserDaoImpl;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.util.MD5Util;

public class NewsUserServiceImpl implements NewsUserService {
    private NewsUserDao newsUserDao =new NewsUserDaoImpl();
    @Override
    public NewsUser findByUserName(String username) {
        return newsUserDao.findByUserName(username);
    }
}
```

+ NewUserDao

``` java
package com.atguigu.headline.dao;
import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserDao {
    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     * @param username è¦æŸ¥è¯¢çš„ç”¨æˆ·å
     * @return æ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
     */
    NewsUser findByUserName(String username);
}
```

+ NewsUserDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.pojo.NewsUser;
import java.util.List;

public class NewsUserDaoImpl extends BaseDao implements NewsUserDao {

    @Override
    public NewsUser findByUserName(String username) {
        // å‡†å¤‡SQL
        String sql ="select uid,username,user_pwd userPwd ,nick_name nickName from news_user where username = ?";
        // è°ƒç”¨BaseDaoå…¬å…±æŸ¥è¯¢æ–¹æ³•
        List<NewsUser> newsUserList = baseQuery(NewsUser.class, sql, username);
        // å¦‚æœæ‰¾åˆ°,è¿”å›é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®(å…¶å®å°±ä¸€ä¸ª)
        if (null != newsUserList && newsUserList.size()>0){
            return  newsUserList.get(0);
        }
        return null;
    }
}
```

## 5.2 æ ¹æ®tokenè·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯

> éœ€æ±‚æè¿°

+ å®¢æˆ·ç«¯å‘é€è¯·æ±‚,æäº¤tokenè¯·æ±‚å¤´,åç«¯æ ¹æ®tokenè¯·æ±‚å¤´è·å–ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯å¹¶å“åº”ç»™å®¢æˆ·ç«¯è¿›è¡Œå­˜å‚¨

> uri

``` http
user/getUserInfo
```

> è¯·æ±‚æ–¹å¼

``` http
GET
```

> è¯·æ±‚å¤´

``` json
token: ... ...
```

> å“åº”ç¤ºä¾‹

+ æˆåŠŸè·å–

``` JSON
{
    "code": 200,
    "message": "success",
    "data": {
        "loginUser": {
            "uid": 1,
            "username": "zhangsan",
            "userPwd": "",
            "nickName": "å¼ ä¸‰"
        }
    }
}
```

+ è·å–å¤±è´¥

``` json
{
    "code": 504,
    "message": "notLogin",
    "data": null
}
```

> åç«¯ä»£ç 

+ NewsUserController

``` java 
package com.atguigu.headline.controller;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;


@WebServlet("/user/*")
public class NewsUserController extends BaseController{

    private NewsUserService newsUserService =new NewsUserServiceImpl();

    /**
     * æ¥æ”¶token,æ ¹æ®tokenæŸ¥è¯¢å®Œæ•´ç”¨æˆ·ä¿¡æ¯
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void getUserInfo(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String token = req.getHeader("token");
        Result  result =Result.build(null,ResultCodeEnum.NOTLOGIN);
        if(null!= token){
            if (!JwtHelper.isExpiration(token)) {
                Integer uid = JwtHelper.getUserId(token).intValue();
                NewsUser newsUser =newsUserService.findByUid(uid);
                newsUser.setUserPwd("");
                Map<String,Object> data =new HashMap<>();
                data.put("loginUser",newsUser);
                result=Result.ok(data);

            }
        }
        WebUtil.writeJson(resp,result);
    }
}
```

+ NewsUserService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserService {
    /**
     * æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     * @param uid è¦æŸ¥è¯¢çš„ç”¨æˆ·id
     * @return æ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
     */
    NewsUser findByUid(Integer uid);
}
```

+ NewsUserServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.dao.impl.NewsUserDaoImpl;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.util.MD5Util;

public class NewsUserServiceImpl implements NewsUserService {
    private NewsUserDao newsUserDao =new NewsUserDaoImpl();

    @Override
    public NewsUser findByUid(Integer uid) {
        return newsUserDao.findByUid(uid);
    }
}
```

+ NewUserDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsUser;


public interface NewsUserDao {
    /**
     * æ ¹æ®ç”¨æˆ·idè¿æ¥æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     * @param uid  è¦æŸ¥è¯¢çš„ç”¨æˆ·id
     * @return æ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
     */
    NewsUser findByUid(Integer uid);
}
```

+ NewUserDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.pojo.NewsUser;
import java.util.List;

public class NewsUserDaoImpl extends BaseDao implements NewsUserDao {
    @Override
    public NewsUser findByUid(Integer uid) {
        String sql ="select uid,username,user_pwd userPwd ,nick_name nickName from news_user where uid = ?";
        List<NewsUser> newsUserList = baseQuery(NewsUser.class, sql, uid);
        if (null != newsUserList && newsUserList.size()>0){
            return  newsUserList.get(0);
        }
        return null;
    }
}
```

## 5.3 æ³¨å†Œæ—¶ç”¨æˆ·åå ç”¨æ ¡éªŒ

<img src="images/checkuserName.gif" alt="checkuserName" style="zoom:60%;" />

> éœ€æ±‚è¯´æ˜

+ ç”¨æˆ·åœ¨æ³¨å†Œæ—¶è¾“å…¥ç”¨æˆ·åæ—¶,ç«‹åˆ»å°†ç”¨æˆ·åå‘é€ç»™åç«¯,åç«¯æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·åæ˜¯å¦å¯ç”¨å¹¶åšå‡ºå“åº”

> uri:

``` http
user/checkUserName
```

> è¯·æ±‚æ–¹å¼:

``` http
POST
```

> è¯·æ±‚å‚æ•°

``` json
username=zhangsan
```

> å“åº”ç¤ºä¾‹

+ ç”¨æˆ·åæ ¡éªŒé€šè¿‡

``` json
{
    "code":"200",
 	"message":"success"
 	"data":{}
}
```

+ ç”¨æˆ·åå ç”¨

``` json
{
    "code":"505",
 	"message":"ç”¨æˆ·åå ç”¨"
 	"data":{}
}
```

> åç«¯ä»£ç 

+ NewsUserController

``` java 
package com.atguigu.headline.controller;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;


@WebServlet("/user/*")
public class NewsUserController extends BaseController{

    private NewsUserService newsUserService =new NewsUserServiceImpl();
    /**
     * æ³¨å†Œæ—¶æ ¡éªŒç”¨æˆ·åæ˜¯å¦è¢«å ç”¨
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void checkUserName(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String username = req.getParameter("username");
        NewsUser newsUser = newsUserService.findByUserName(username);
        Result result=null;
        if (null == newsUser){
            result=Result.ok(null);
        }else{
            result=Result.build(null,ResultCodeEnum.USERNAME_USED);
        }
        WebUtil.writeJson(resp,result);
    }
}
```

## 5.4 æ³¨å†Œè¡¨å•æäº¤

<img src="images/regist.gif" alt="regist" style="zoom:60%;" />

> éœ€æ±‚è¯´æ˜

+ å®¢æˆ·ç«¯å°†æ–°ç”¨æˆ·ä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯,æœåŠ¡ç«¯å°†æ–°ç”¨æˆ·å­˜å…¥æ•°æ®åº“,å­˜å…¥ä¹‹å‰åšç”¨æˆ·åæ˜¯å¦è¢«å ç”¨æ ¡éªŒ,æ ¡éªŒé€šè¿‡å“åº”æˆåŠŸæç¤º,å¦åˆ™å“åº”å¤±è´¥æç¤º


> uri:

``` http
user/regist
```

> è¯·æ±‚æ–¹å¼:

``` http
POST
```

> è¯·æ±‚å‚æ•°

``` json
{
    "username":"zhangsan",
    "userPwd":"123456",
    "nickName":"å¼ ä¸‰"
}
```

> å“åº”ç¤ºä¾‹

+ æ³¨å†ŒæˆåŠŸ

``` json
{
    "code":"200",
 	"message":"success"
 	"data":{}
}
```

+ ç”¨æˆ·åå ç”¨

``` json
{
    "code":"505",
 	"message":"ç”¨æˆ·åå ç”¨"
 	"data":{}
}
```

> åç«¯ä»£ç 

+ NewsUserController

``` java 
package com.atguigu.headline.controller;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;


@WebServlet("/user/*")
public class NewsUserController extends BaseController{

    private NewsUserService newsUserService =new NewsUserServiceImpl();

    /**
     * æ³¨å†ŒåŠŸèƒ½æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void regist(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        NewsUser newsUser = WebUtil.readJson(req, NewsUser.class);
        NewsUser usedUser = newsUserService.findByUserName(newsUser.getUsername());
        Result result=null;
        if (null == usedUser){
            newsUserService.registUser(newsUser);
            result=Result.ok(null);
        }else{
            result=Result.build(null,ResultCodeEnum.USERNAME_USED);
        }
        WebUtil.writeJson(resp,result);
    }
}
```

+ NewsUserService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserService {

    /**
     * æ³¨å†Œç”¨æˆ·ä¿¡æ¯,æ³¨å†ŒæˆåŠŸè¿”å›å¤§äº0çš„æ•´æ•°,å¤±è´¥è¿”å›0
     * @param newsUser
     * @return
     */
    int registUser(NewsUser newsUser);
}
```

+ NewsUserServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.dao.impl.NewsUserDaoImpl;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.util.MD5Util;

public class NewsUserServiceImpl implements NewsUserService {
    @Override
    public int registUser(NewsUser newsUser) {
        // å¯†ç æ˜æ–‡è½¬å¯†æ–‡
        newsUser.setUserPwd(MD5Util.encrypt(newsUser.getUserPwd()));
        // å­˜å…¥æ•°æ®åº“
        return newsUserDao.insertNewsUser(newsUser);
    }
}
```

+ NewUserDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsUser;


public interface NewsUserDao {
    /**
     * å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥æ•°æ®åº“
     * @param newsUser 
     * @return
     */
    int insertNewsUser(NewsUser newsUser);
}
```

+ NewUserDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.pojo.NewsUser;
import java.util.List;

public class NewsUserDaoImpl extends BaseDao implements NewsUserDao {
    @Override
    public int insertNewsUser(NewsUser newsUser) {
        String sql ="insert into news_user values(DEFAULT,?,?,?)";
        return baseUpdate(sql,newsUser.getUsername(),newsUser.getUserPwd(),newsUser.getNickName());
    }
}
```

# å…­ å¤´æ¡é¦–é¡µåŠŸèƒ½

## 6.1 æŸ¥è¯¢æ‰€æœ‰å¤´æ¡åˆ†ç±»

![1684890693363](images/1684890693363.png)

> éœ€æ±‚è¯´æ˜

+ è¿›å…¥æ–°é—»é¦–é¡µ,æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»å¹¶åŠ¨æ€å±•ç¤ºæ–°é—»ç±»åˆ«æ ä½

> uri:

``` http
portal/findAllTypes
```

> è¯·æ±‚æ–¹å¼

``` http
GET
```

> è¯·æ±‚å‚æ•°

``` JSON
æ— 
```

> å“åº”ç¤ºä¾‹

``` JSON
{
    "code":"200",
 	"message":"OK"
 	"data":
            [
                {
                    "tid":"1",
                    "tname":"æ–°é—»"
                },
                {
                    "tid":"2",
                    "tname":"ä½“è‚²"
                },
                {
                    "tid":"3",
                    "tname":"å¨±ä¹"
                },
                {
                    "tid":"4",
                    "tname":"ç§‘æŠ€"
                },
                {
                    "tid":"5",
                    "tname":"å…¶ä»–"
                }
            ]
    
}

```

> åç«¯ä»£ç 

+ PortalController

``` java 
package com.atguigu.headline.controller;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsType;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.service.impl.NewsTypeServiceImpl;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@WebServlet("/portal/*")
public class PortalController extends BaseController{

    private NewsHeadlineService headlineService=new NewsHeadlineServiceImpl();
    private NewsTypeService newsTypeService=new NewsTypeServiceImpl();
    /**
     * æŸ¥è¯¢æ‰€æœ‰æ–°é—»ç±»å‹
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void findAllTypes(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        List<NewsType> newsTypeList =newsTypeService.findAll();
        WebUtil.writeJson(resp,Result.ok(newsTypeList));
    }
}
```

+ NewsTypeService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsType;

import java.util.List;

public interface NewsTypeService {
    /**
     * æŸ¥è¯¢å…¨éƒ¨æ–°é—»ç±»å‹
     * @return
     */
    List<NewsType> findAll();
}

```

+ NewsTypeServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsTypeDao;
import com.atguigu.headline.dao.impl.NewsTypeDaoImpl;
import com.atguigu.headline.pojo.NewsType;
import com.atguigu.headline.service.NewsTypeService;

import java.util.List;

public class NewsTypeServiceImpl implements NewsTypeService {
    private NewsTypeDao  newsTypeDao =new NewsTypeDaoImpl();
    @Override
    public List<NewsType> findAll() {
        return newsTypeDao.findAll();
    }
}
```

+ NewUserDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsType;

import java.util.List;

public interface NewsTypeDao {
    /**
     * ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å…¨éƒ¨æ–°é—»ç±»å‹
     * @return
     */
    List<NewsType> findAll();
}

```

+ NewsTypeDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsTypeDao;
import com.atguigu.headline.pojo.NewsType;

import java.util.List;

public class NewsTypeDaoImpl extends BaseDao implements NewsTypeDao {
    @Override
    public List<NewsType> findAll() {
        String sql ="select tid,tname from news_type";
        return  baseQuery(NewsType.class, sql);
    }
}
```

## 6.2 åˆ†é¡µå¸¦æ¡ä»¶æŸ¥è¯¢æ‰€æœ‰å¤´æ¡

![1684890943094](images/1684890943094.png)

> éœ€æ±‚è¯´æ˜

+ å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æŸ¥è¯¢å…³é”®å­—,æ–°é—»ç±»åˆ«,é¡µç æ•°,é¡µå¤§å°
+ æœåŠ¡ç«¯æ ¹æ®æ¡ä»¶æœç´¢åˆ†é¡µä¿¡æ¯,è¿”å›å«é¡µç æ•°,é¡µå¤§å°,æ€»é¡µæ•°,æ€»è®°å½•æ•°,å½“å‰é¡µæ•°æ®ç­‰ä¿¡æ¯,å¹¶æ ¹æ®æ—¶é—´é™åº,æµè§ˆé‡é™åºæ’åº

> uri:

``` http
portal/findNewsPage
```

> è¯·æ±‚æ–¹å¼:

``` http
POST
```

> è¯·æ±‚å‚æ•°:

``` json
{
    "keyWords":"é©¬æ–¯å…‹", // æœç´¢æ ‡é¢˜å…³é”®å­—
    "type":0,           // æ–°é—»ç±»å‹
    "pageNum":1,        // é¡µç æ•°
    "pageSize":"10"     // é¡µå¤§å°
}
```

> å“åº”ç¤ºä¾‹:

``` json
{
    "code":"200",
 	"message":"success"
 	"data":{
    	"pageInfo":{
    		"pageData":[                           // æœ¬é¡µçš„æ•°æ®
    			{
    				"hid":"1",                     // æ–°é—»id 
    				"title":"å°šç¡…è°·å®£å¸ƒ ... ...",   // æ–°é—»æ ‡é¢˜
    				"type":"1",                    // æ–°é—»æ‰€å±ç±»åˆ«ç¼–å·
    				"pageViews":"40",              // æ–°é—»æµè§ˆé‡
    				"pastHours":"3" ,              // å‘å¸ƒæ—¶é—´å·²è¿‡å°æ—¶æ•°
    				"publisher":"1"                // å‘å¸ƒç”¨æˆ·ID
				},
				{
    				"hid":"1",                     // æ–°é—»id 
    				"title":"å°šç¡…è°·å®£å¸ƒ ... ...",   // æ–°é—»æ ‡é¢˜
    				"type":"1",                    // æ–°é—»æ‰€å±ç±»åˆ«ç¼–å·
    				"pageViews":"40",              // æ–°é—»æµè§ˆé‡
    				"pastHours":"3",              // å‘å¸ƒæ—¶é—´å·²è¿‡å°æ—¶æ•°
    				"publisher":"1"                // å‘å¸ƒç”¨æˆ·ID
				},
				{
    				"hid":"1",                     // æ–°é—»id 
    				"title":"å°šç¡…è°·å®£å¸ƒ ... ...",   // æ–°é—»æ ‡é¢˜
    				"type":"1",                    // æ–°é—»æ‰€å±ç±»åˆ«ç¼–å·
    				"pageViews":"40",              // æ–°é—»æµè§ˆé‡
    				"pastHours":"3",               // å‘å¸ƒæ—¶é—´å·²è¿‡å°æ—¶æ•°
    				"publisher":"1"                // å‘å¸ƒç”¨æˆ·ID
				}
    		],
			"pageNum":1,    //é¡µç æ•°
			"pageSize":10,  // é¡µå¤§å°
			"totalPage":20, // æ€»é¡µæ•°
			"totalSize":200 // æ€»è®°å½•æ•°
		}
	}
}
```

>  åç«¯ä»£ç 

+ PortalController

``` java 
package com.atguigu.headline.controller;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsType;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.service.impl.NewsTypeServiceImpl;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@WebServlet("/portal/*")
public class PortalController extends BaseController{

    private NewsHeadlineService headlineService=new NewsHeadlineServiceImpl();
    private NewsTypeService newsTypeService=new NewsTypeServiceImpl();
    /**
     * åˆ†é¡µå¸¦æ¡ä»¶æŸ¥è¯¢æ–°é—»
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void findNewsPage(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HeadlineQueryVo headLineQueryVo = WebUtil.readJson(req, HeadlineQueryVo.class);
        // æŸ¥è¯¢åˆ†é¡µäº”é¡¹æ•°æ®
        Map<String,Object> pageInfo =headlineService.findPage(headLineQueryVo);
        // å°†åˆ†é¡µäº”é¡¹æ•°æ®æ”¾å…¥PageInfoMap
        Map<String,Object> pageInfoMap=new HashMap<>();
        pageInfoMap.put("pageInfo",pageInfo);
        // å“åº”JSON
        WebUtil.writeJson(resp, Result.ok(pageInfoMap));
    }
}
```

+ NewsHeadlineService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;
import java.util.Map;

public interface NewsHeadlineService {
    /**
     * åˆ†é¡µæŸ¥è¯¢å¤´æ¡æ–°é—»æ–¹æ³•
     * @param headLineQueryVo
     * @return
     */
    Map<String, Object> findPage(HeadlineQueryVo headLineQueryVo);
}
```

+ NewsHeadlineServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class NewsHeadlineServiceImpl  implements NewsHeadlineService {
    private NewsHeadLineDao newsHeadLineDao =new NewsHeadlineDaoImpl();

    @Override
    public Map<String, Object> findPage(HeadlineQueryVo headLineQueryVo) {
        // å‡†å¤‡ä¸€ä¸ªmap,ç”¨äºè£…åˆ†é¡µçš„äº”é¡¹æ•°æ®
        Map<String,Object> pageInfo =new HashMap<>();
        // åˆ†é¡µæŸ¥è¯¢æœ¬é¡µæ•°æ®
        List<HeadlinePageVo>  pageData =newsHeadLineDao.findPageList(headLineQueryVo);
        // åˆ†é¡µæŸ¥è¯¢æ»¡è¶³è®°å½•çš„æ€»æ•°æ®é‡
        int totalSize = newsHeadLineDao.findPageCount(headLineQueryVo);
        // é¡µå¤§å°
        int pageSize =headLineQueryVo.getPageSize();
        // æ€»é¡µç æ•°
        int totalPage=totalSize%pageSize == 0 ?  totalSize/pageSize  : totalSize/pageSize+1;
        // å½“å‰é¡µç æ•°
        int pageNum= headLineQueryVo.getPageNum();
        pageInfo.put("pageData",pageData);
        pageInfo.put("pageNum",pageNum);
        pageInfo.put("pageSize",pageSize);
        pageInfo.put("totalPage",totalPage);
        pageInfo.put("totalSize",totalSize);


        return pageInfo;
    }
}
```

+ NewsHeadLineDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;

public interface NewsHeadLineDao {
    /**
     * æ ¹æ®æŸ¥è¯¢æ¡ä»¶,æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„è®°å½•æ•°
     * @param headLineQueryVo
     * @return
     */
    int findPageCount(HeadlineQueryVo headLineQueryVo);

    /**
     * æ ¹æ®æŸ¥è¯¢æ¡ä»¶,æŸ¥è¯¢å½“å‰é¡µæ•°æ®
     * @param headLineQueryVo
     * @return
     */
    List<HeadlinePageVo> findPageList(HeadlineQueryVo headLineQueryVo);
}
```

+ NewsHeadlineDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.LinkedList;
import java.util.List;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao{

    @Override
    public int findPageCount(HeadlineQueryVo headLineQueryVo) {
        //  æ‹¼æ¥åŠ¨æ€ SQL,æ‹¼æ¥å‚æ•°
        List<Object> args =new LinkedList<>();
        String  sql="select count(1) from news_headline where is_deleted=0 ";
        StringBuilder sqlBuffer =new StringBuilder(sql) ;
        String keyWords = headLineQueryVo.getKeyWords();
        //åˆ¤æ–­å¹¶åŠ¨æ€æ‹¼æ¥æ¡ä»¶
        if (null != keyWords && keyWords.length()>0){
            sqlBuffer.append("and title like ? ");
            args.add("%"+keyWords+"%");
        }
        //  åˆ¤æ–­å¹¶åŠ¨æ€æ‹¼æ¥æ¡ä»¶
        Integer type = headLineQueryVo.getType();
        if(null != type  && type != 0){
            sqlBuffer.append("and type  =  ? ");
            args.add(type);
        }

        // å‚æ•°è½¬æ•°ç»„
        Object[] argsArr = args.toArray();
        System.out.println(sqlBuffer.toString());
        Long totalSize = baseQueryObject(Long.class, sqlBuffer.toString(), argsArr);
        // è¿”å›æ•°æ®
        return totalSize.intValue();
    }

    @Override
    public List<HeadlinePageVo> findPageList(HeadlineQueryVo headLineQueryVo) {
        //  æ‹¼æ¥åŠ¨æ€ SQL,æ‹¼æ¥å‚æ•°
        List<Object> args =new LinkedList<>();
        String  sql="select hid,title,type,page_views pageViews,TIMESTAMPDIFF(HOUR,create_time,NOW()) pastHours,publisher from news_headline where is_deleted=0 ";
        StringBuilder sqlBuffer =new StringBuilder(sql) ;
        String keyWords = headLineQueryVo.getKeyWords();
        if (null != keyWords && keyWords.length()>0){
            sqlBuffer.append("and title like ? ");
            args.add("%"+keyWords+"%");
        }
        Integer type = headLineQueryVo.getType();
        if(null != type  && type != 0){
            sqlBuffer.append("and type  =  ? ");
            args.add(type);
        }

        sqlBuffer.append("order by pastHours , page_views desc ");
        sqlBuffer.append("limit ? , ?");
        args.add((headLineQueryVo.getPageNum()-1)*headLineQueryVo.getPageSize());
        args.add(headLineQueryVo.getPageSize());

        // å‚æ•°è½¬æ•°ç»„
        Object[] argsArr = args.toArray();
        System.out.println(sqlBuffer.toString());
        List<HeadlinePageVo> pageData = baseQuery(HeadlinePageVo.class, sqlBuffer.toString(), argsArr);

        return pageData;
    }
}
```

##  6.3 æŸ¥çœ‹å¤´æ¡è¯¦æƒ…

<img src="images/1684891013180.png" alt="1684891013180" style="zoom:80%;" />

![1684891029981](images/1684891029981.png)

> éœ€æ±‚è¯´æ˜

+ ç”¨æˆ·ç‚¹å‡»"æŸ¥çœ‹å…¨æ–‡"æ—¶,å‘æœåŠ¡ç«¯å‘é€æ–°é—»id
+ åç«¯æ ¹æ®æ–°é—»idæŸ¥è¯¢å®Œæ•´æ–°é—»æ–‡ç« ä¿¡æ¯å¹¶è¿”å›
+ åç«¯è¦åŒæ—¶è®©æ–°é—»çš„æµè§ˆé‡+1

> uri

``` http
portal/showHeadlineDetail
```

> è¯·æ±‚æ–¹å¼

``` http
POST
```

> è¯·æ±‚å‚æ•°

``` json
hid=1
```

> å“åº”ç¤ºä¾‹

``` json
{
    "code":"200",
    "message":"success",
    "data":{
        "headline":{
            "hid":"1",                     // æ–°é—»id 
            "title":"é©¬æ–¯å…‹å®£å¸ƒ ... ...",   // æ–°é—»æ ‡é¢˜
            "article":"... ..."            // æ–°é—»æ­£æ–‡
            "type":"1",                    // æ–°é—»æ‰€å±ç±»åˆ«ç¼–å·
            "typeName":"ç§‘æŠ€",             // æ–°é—»æ‰€å±ç±»åˆ«
            "pageViews":"40",              // æ–°é—»æµè§ˆé‡
            "pastHours":"3" ,              // å‘å¸ƒæ—¶é—´å·²è¿‡å°æ—¶æ•°
            "publisher":"1" ,               // å‘å¸ƒç”¨æˆ·ID
            "author":"å¼ ä¸‰"                 // æ–°é—»ä½œè€…
        }
    }
}
```

> åç«¯ä»£ç 

+ PortalController

``` java 
package com.atguigu.headline.controller;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsType;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.service.impl.NewsTypeServiceImpl;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@WebServlet("/portal/*")
public class PortalController extends BaseController{

    private NewsHeadlineService headlineService=new NewsHeadlineServiceImpl();
    private NewsTypeService newsTypeService=new NewsTypeServiceImpl();
    /**
     * æŸ¥è¯¢å•ä¸ªæ–°é—»è¯¦æƒ…
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void showHeadlineDetail(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // è·å–è¦æŸ¥è¯¢çš„è¯¦æƒ…æ–°é—»id
        Integer hid =Integer.parseInt(req.getParameter("hid"));
        
        // æŸ¥è¯¢æ–°é—»è¯¦æƒ…vo
        HeadlineDetailVo headlineDetailVo =headlineService.findHeadlineDetail(hid);
        // å°è£…dataå†…å®¹
        Map<String ,Object> data =new HashMap<>();
        data.put("headline",headlineDetailVo);
        // å“åº”JSON
        WebUtil.writeJson(resp,Result.ok(data));
    }
}
```

+ NewsHeadlineService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;
import java.util.Map;

public interface NewsHeadlineService {
    /**
     * æ ¹æ®å¤´æ¡id,æ˜¾ç¤ºå¤´æ¡è¯¦æƒ…
     * @param hid
     * @return
     */
    HeadlineDetailVo findHeadlineDetail(Integer hid);
}
```

+ NewsHeadlineServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class NewsHeadlineServiceImpl  implements NewsHeadlineService {
    private NewsHeadLineDao newsHeadLineDao =new NewsHeadlineDaoImpl();
    @Override
    public HeadlineDetailVo findHeadlineDetail(Integer hid) {
        // ä¿®æ”¹æ–°é—»ä¿¡æ¯æµè§ˆé‡+1
        newsHeadLineDao.increasePageViews(hid);
        // æŸ¥è¯¢æ–°é—»è¯¦æƒ…
        return newsHeadLineDao.findHeadlineDetail(hid);
    }
}
```

+ NewsHeadLineDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;

public interface NewsHeadLineDao {
    /**
     * å¤šè¡¨æŸ¥è¯¢æ–°é—»è¯¦æƒ…
     * @param hid
     * @return
     */
    HeadlineDetailVo findHeadlineDetail(Integer hid);
    
    int increasePageViews(Integer hid);
}
```

+ NewsHeadlineDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.LinkedList;
import java.util.List;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao{
    @Override
    public HeadlineDetailVo findHeadlineDetail(Integer hid) {
        String sql ="select hid,title,article,type, tname typeName ,page_views pageViews,TIMESTAMPDIFF(HOUR,create_time,NOW()) pastHours,publisher,nick_name author from news_headline h left join  news_type t on h.type = t.tid left join news_user u  on h.publisher = u.uid where hid = ?";
        List<HeadlineDetailVo> headlineDetailVoList = baseQuery(HeadlineDetailVo.class, sql, hid);
        if(null != headlineDetailVoList && headlineDetailVoList.size()>0)
            return headlineDetailVoList.get(0);
        return null;
    }
    
    @Override
    public int increasePageViews(Integer hid) {
        String sql ="update news_headline set page_views = page_views +1 where hid =?";
        return baseUpdate(sql,hid);
    }
}
```



# ä¸ƒ å¤´æ¡å‘å¸ƒä¿®æ”¹å’Œåˆ é™¤

## 7.1 ç™»å½•æ ¡éªŒ

> éœ€æ±‚è¯´æ˜

+ å®¢æˆ·ç«¯åœ¨è¿›å…¥å‘å¸ƒé¡µå‰ã€å‘å¸ƒæ–°é—»å‰ã€è¿›å…¥ä¿®æ”¹é¡µå‰ã€ä¿®æ”¹å‰ã€åˆ é™¤æ–°é—»å‰å…ˆå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æºå¸¦tokenè¯·æ±‚å¤´
+ åç«¯æ¥æ”¶tokenè¯·æ±‚å¤´å,æ ¡éªŒç”¨æˆ·ç™»å½•æ˜¯å¦è¿‡æœŸå¹¶åšå“åº”
+ å‰ç«¯æ ¹æ®å“åº”ä¿¡æ¯æç¤ºç”¨æˆ·è¿›å…¥ç™»å½•é¡µè¿˜æ˜¯è¿›å…¥æ­£å¸¸ä¸šåŠ¡é¡µé¢

> uri

``` http
user/checkLogin
```

> è¯·æ±‚æ–¹å¼

``` http
GET
```

> è¯·æ±‚å‚æ•°

``` json
æ— 
```

> è¯·æ±‚å¤´

``` JSON
token: ... ...
```

> å“åº”ç¤ºä¾‹

+ ç™»å½•æœªè¿‡æœŸ

``` json
{
    "code":"200",
    "message":"success",
    "data":{}
}
```

+ ç™»å½•å·²è¿‡æœŸ

``` json
{
    "code":"504",
    "message":"loginExpired",
    "data":{}
}
```

> åç«¯ä»£ç 

+ NewsUserController

``` java 
package com.atguigu.headline.controller;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;


@WebServlet("/user/*")
public class NewsUserController extends BaseController{

    private NewsUserService newsUserService =new NewsUserServiceImpl();
    /**
     * é€šè¿‡tokenæ£€éªŒç”¨æˆ·ç™»å½•æ˜¯å¦è¿‡æœŸ
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void checkLogin(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String token = req.getHeader("token");
        Result  result =Result.build(null,ResultCodeEnum.NOTLOGIN);
        if(null!= token){
            if (!JwtHelper.isExpiration(token)) {
                result=Result.ok(null);
            }
        }
        WebUtil.writeJson(resp,result);
    }
}
```

+ ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨

``` java
package com.atguigu.headline.filters;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.*;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public class LoginFilter implements Filter {
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest request =(HttpServletRequest)  servletRequest;
        String token = request.getHeader("token");
        boolean flag =false;
        // tokenä¸ä¸ºç©ºå¹¶ä¸”æ²¡è¿‡æœŸ
        if (null  != token ){
            boolean expiration = JwtHelper.isExpiration(token);
            if (!expiration ){
               flag=true;
            }
        }
        if (flag){
            filterChain.doFilter(servletRequest,servletResponse);
        }else{
            WebUtil.writeJson((HttpServletResponse) servletResponse, Result.build(null, ResultCodeEnum.NOTLOGIN));
        }
    }
}
```

+ web.xmlä¸­é…ç½®ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨

``` xml
    <!--ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨-->
    <filter>
        <filter-name>loginFilter</filter-name>
        <filter-class>com.atguigu.headline.filters.LoginFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>loginFilter</filter-name>
        <url-pattern>/headline/*</url-pattern>
    </filter-mapping>
```

## 7.2 æäº¤å‘å¸ƒå¤´æ¡

![1683883660552](images/1683883660552.png)

> éœ€æ±‚è¯´æ˜

+ ç”¨æˆ·åœ¨å®¢æˆ·ç«¯è¾“å…¥å‘å¸ƒçš„æ–°é—»ä¿¡æ¯å®Œæ¯•å
+ å‘å¸ƒå‰å…ˆè¯·æ±‚åç«¯çš„ç™»å½•æ ¡éªŒæ¥å£éªŒè¯ç™»å½•
+ ç™»å½•é€šè¿‡åˆ™æäº¤æ–°é—»ä¿¡æ¯
+ åç«¯å°†æ–°é—»ä¿¡æ¯å­˜å…¥æ•°æ®åº“

> uri

``` http
headline/publish
```

> è¯·æ±‚æ–¹å¼

``` http
POST
```

> è¯·æ±‚å¤´

``` json
token: ... ...
```

> è¯·æ±‚å‚æ•°

``` json
{
    "title":"å°šç¡…è°·å®£å¸ƒ ... ...",   // æ–‡ç« æ ‡é¢˜
    "article":"... ...",          // æ–‡ç« å†…å®¹
    "type":"1"                    // æ–‡ç« ç±»åˆ«
}
```

> å“åº”ç¤ºä¾‹

+ å‘å¸ƒæˆåŠŸ

``` json
{
    "code":"200",
    "message":"success",
    "data":{}
}
```

+ å¤±å»ç™»å½•çŠ¶æ€å‘å¸ƒå¤±è´¥

```  json
{
    "code":"504",
    "message":"loginExpired",
    "data":{}
}
```

> åç«¯ä»£ç 


+ NewsHeadlineController

``` java 
package com.atguigu.headline.controller;


import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {

    private NewsHeadlineService newsHeadlineService =new NewsHeadlineServiceImpl();
    /**
     * å‘å¸ƒæ–°é—»
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void publish(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // è¯»å–æ–°é—»ä¿¡æ¯
        NewsHeadline newsHeadline = WebUtil.readJson(req, NewsHeadline.class);
        // é€šè¿‡tokenè·å–å‘å¸ƒè€…ID
        String token = req.getHeader("token");
        Long userId = JwtHelper.getUserId(token);
        newsHeadline.setPublisher(userId.intValue());
        // å°†æ–°é—»å­˜å…¥æ•°æ®åº“
        newsHeadlineService.addNewsHeadline(newsHeadline);
        WebUtil.writeJson(resp,Result.ok(null));
    }
}
```

+ NewsHeadlineService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;
import java.util.Map;

public interface NewsHeadlineService {
    /**
     * æ–°å¢å¤´æ¡
     * @param newsHeadline
     * @return
     */
    int addNewsHeadline(NewsHeadline newsHeadline);
}
```

+ NewsHeadlineServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class NewsHeadlineServiceImpl  implements NewsHeadlineService {
    private NewsHeadLineDao newsHeadLineDao =new NewsHeadlineDaoImpl();
    public int addNewsHeadline(NewsHeadline newsHeadline) {
        return newsHeadLineDao.addNewsHeadline(newsHeadline);
    }
}
```

+ NewsHeadLineDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;

public interface NewsHeadLineDao {
    /**
     * å¤´æ¡å­˜å…¥æ•°æ®åº“
     * @param newsHeadline
     * @return
     */
    int addNewsHeadline(NewsHeadline newsHeadline);
}
```

+ NewsHeadlineDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.LinkedList;
import java.util.List;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao{
    @Override
    public int addNewsHeadline(NewsHeadline newsHeadline) {
        String sql = "insert into news_headline values(DEFAULT,?,?,?,?,0,NOW(),NOW(),0)";

        return baseUpdate(
                sql,
                newsHeadline.getTitle(),
                newsHeadline.getArticle(),
                newsHeadline.getType(),
                newsHeadline.getPublisher()
        );
    }
}
```

## 7.3 ä¿®æ”¹å¤´æ¡å›æ˜¾

![1683883695289](images/1683883695289.png)

> éœ€æ±‚è¯´æ˜

+ å‰ç«¯å…ˆè°ƒç”¨ç™»å½•æ ¡éªŒæ¥å£,æ ¡éªŒç™»å½•æ˜¯å¦è¿‡æœŸ
+ ç™»å½•æ ¡éªŒé€šè¿‡å ,åˆ™æ ¹æ®æ–°é—»idæŸ¥è¯¢æ–°é—»çš„å®Œæ•´ä¿¡æ¯å¹¶å“åº”ç»™å‰ç«¯

> uri

``` http
headline/findHeadlineByHid
```

> è¯·æ±‚æ–¹å¼

``` http
POST
```

> è¯·æ±‚å‚æ•°

``` json
hid=1
```

> å“åº”ç¤ºä¾‹

+ æŸ¥è¯¢æˆåŠŸ

``` json
{
    "code":"200",
    "message":"success",
    "data":{
        "headline":{
            "hid":"1",
            "title":"é©¬æ–¯å…‹å®£å¸ƒ",
            "article":"... ... ",
            "type":"2"
        }
    }
}
```

> åç«¯ä»£ç 

+ NewsHeadlineController

``` java 
package com.atguigu.headline.controller;


import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {
    private NewsHeadlineService newsHeadlineService =new NewsHeadlineServiceImpl();
    /**
     * ä¿®æ”¹æ–°é—»å›æ˜¾
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void findHeadlineByHid(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        Integer hid = Integer.parseInt(req.getParameter("hid"));
        NewsHeadline newsHeadline =newsHeadlineService.findHeadlineByHid(hid);
        Map<String ,Object> data =new HashMap<>();
        data.put("headline",newsHeadline);
        WebUtil.writeJson(resp,Result.ok(data));

    }
}
```

+ NewsHeadlineService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;
import java.util.Map;

public interface NewsHeadlineService {
    /**
     * æ ¹æ®æ–°é—»idæŸ¥è¯¢å•ä¸ªæ–°é—»
     * @param hid
     * @return
     */
    NewsHeadline findHeadlineByHid(Integer hid);
}
```

+ NewsHeadlineServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class NewsHeadlineServiceImpl  implements NewsHeadlineService {
    private NewsHeadLineDao newsHeadLineDao =new NewsHeadlineDaoImpl();
    @Override
    public NewsHeadline findHeadlineByHid(Integer hid) {
        return newsHeadLineDao.findHeadlineByHid(hid);
    }
}
```

+ NewsHeadLineDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;

public interface NewsHeadLineDao {
    NewsHeadline findHeadlineByHid(Integer hid);
}
```

+ NewUserDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.LinkedList;
import java.util.List;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao{
    
    @Override
    public NewsHeadline findHeadlineByHid(Integer hid) {
        String sql ="select hid,title,article,type,publisher,page_views pageViews from news_headline where hid =?";
        List<NewsHeadline> newsHeadlineList = baseQuery(NewsHeadline.class, sql, hid);
        if(null != newsHeadlineList && newsHeadlineList.size()>0)
            return newsHeadlineList.get(0);
        return null;
    }
}
```

## 7.4 ä¿å­˜ä¿®æ”¹

> éœ€æ±‚æè¿°

+ å®¢æˆ·ç«¯å°†æ–°é—»ä¿¡æ¯ä¿®æ”¹å,æäº¤å‰å…ˆè¯·æ±‚ç™»å½•æ ¡éªŒæ¥å£æ ¡éªŒç™»å½•çŠ¶æ€
+ ç™»å½•æ ¡éªŒé€šè¿‡åˆ™æäº¤ä¿®æ”¹åçš„æ–°é—»ä¿¡æ¯,åç«¯æ¥æ”¶å¹¶æ›´æ–°è¿›å…¥æ•°æ®åº“

> uri

``` http
headline/update
```

> è¯·æ±‚æ–¹å¼ 

``` http
POST
```

> è¯·æ±‚å‚æ•°

``` JSON
{
    "hid":"1",
    "title":"å°šç¡…è°·å®£å¸ƒ ... ...",
    "article":"... ...",
    "type":"2"
}
```

> å“åº”ç¤ºä¾‹

+ ä¿®æ”¹æˆåŠŸ

``` json
{
    "code":"200",
    "message":"success",
    "data":{}
}
```

+ ä¿®æ”¹å¤±è´¥

```  json
{
    "code":"504",
    "message":"loginExpired",
    "data":{}
}
```

> åç«¯ä»£ç 

+ NewsHeadlineController

``` java 
package com.atguigu.headline.controller;


import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {
    private NewsHeadlineService newsHeadlineService =new NewsHeadlineServiceImpl();
    /**
     * æ›´æ–°æ–°é—»ä¿¡æ¯
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void update(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        NewsHeadline newsHeadline = WebUtil.readJson(req, NewsHeadline.class);
        newsHeadlineService.updateNewsHeadline(newsHeadline);
        WebUtil.writeJson(resp,Result.ok(null));
    }
}
```

+ NewsHeadlineService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;
import java.util.Map;

public interface NewsHeadlineService {
    int updateNewsHeadline(NewsHeadline newsHeadline);
}
```

+ NewsHeadlineServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class NewsHeadlineServiceImpl  implements NewsHeadlineService {
    private NewsHeadLineDao newsHeadLineDao =new NewsHeadlineDaoImpl();
    @Override
    public int updateNewsHeadline(NewsHeadline newsHeadline) {
        return newsHeadLineDao.updateNewsHeadline(newsHeadline);
    }
}
```

+ NewsHeadLineDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;

public interface NewsHeadLineDao {
    int updateNewsHeadline(NewsHeadline newsHeadline);
}
```

+ NewUserDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.LinkedList;
import java.util.List;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao{
    @Override
    public int updateNewsHeadline(NewsHeadline newsHeadline) {
        String sql ="update news_headline set title = ?, article= ? , type =? , update_time = NOW() where hid = ? ";
        return baseUpdate(
                sql,
                newsHeadline.getTitle(),
                newsHeadline.getArticle(),
                newsHeadline.getType(),
                newsHeadline.getHid()
        );
    }
}
```

## 7.5 åˆ é™¤å¤´æ¡

![1683883724768](images/1683883724768.png)

> éœ€æ±‚è¯´æ˜

+ å°†è¦åˆ é™¤çš„æ–°é—»idå‘é€ç»™æœåŠ¡ç«¯
+ æœåŠ¡ç«¯æ ¡éªŒç™»å½•æ˜¯å¦è¿‡æœŸ,æœªè¿‡æœŸåˆ™ç›´æ¥åˆ é™¤,è¿‡æœŸåˆ™å“åº”ç™»å½•è¿‡æœŸä¿¡æ¯

> uri

``` http
headline/removeByHid
```

> è¯·æ±‚æ–¹å¼

``` http
POST
```

> è¯·æ±‚å‚æ•°

```  json
hid=1
```

> å“åº”ç¤ºä¾‹

+ åˆ é™¤æˆåŠŸ

``` json
{
    "code":"200",
    "message":"success",
    "data":{}
}
```

+ åˆ é™¤å¤±è´¥

``` json
{
    "code":"504",
    "message":"loginExpired",
    "data":{}
    
}
```

> åç«¯ä»£ç 

+ NewsHeadlineController

``` java 
package com.atguigu.headline.controller;


import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {
    private NewsHeadlineService newsHeadlineService =new NewsHeadlineServiceImpl();
    /**
     * åˆ é™¤æ–°é—»
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void removeByHid(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        Integer hid = Integer.parseInt(req.getParameter("hid"));
        newsHeadlineService.removeByHid(hid);
        WebUtil.writeJson(resp,Result.ok(null));
    }
}
```

+ NewsHeadlineService

``` java 
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;
import java.util.Map;

public interface NewsHeadlineService {
    int removeByHid(Integer hid);
}
```

+ NewsHeadlineServiceImpl

``` java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class NewsHeadlineServiceImpl  implements NewsHeadlineService {
    private NewsHeadLineDao newsHeadLineDao =new NewsHeadlineDaoImpl();
    @Override
    public int removeByHid(Integer hid) {
        return newsHeadLineDao.removeByHid(hid);
    }
}
```

+ NewsHeadLineDao

``` java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.List;

public interface NewsHeadLineDao {
    int removeByHid(Integer hid);
}
```

+ NewsHeadlineDaoImpl

``` java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

import java.util.LinkedList;
import java.util.List;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao{
    @Override
    public int removeByHid(Integer hid) {
        String sql ="update news_headline set is_deleted =1 ,  update_time =NOW() where hid = ? ";
        return baseUpdate(sql,hid);
    }
```





---


----

Â© ç‰ˆæƒå£°æ˜

<escape>

<div>
    <h3 align="center"  style="color: brown;" >ç‰ˆæƒå£°æ˜</h3>
    <table>
   		<tr>
    		<ol>
				<li>æœ¬ç½‘ç«™åç§°ï¼šğš²ğš³ğš²</li>
				<li>ğš²ğš³ğš²æä¾›çš„èµ„æºä»…ä¾›æ‚¨ä¸ªäººç”¨äºéå•†ä¸šæ€§ç›®çš„ã€‚</li>
				<li>æœ¬ç«™æ–‡ç« éƒ¨åˆ†å†…å®¹å¯èƒ½æ¥æºäºç½‘ç»œï¼Œä»…ä¾›å¤§å®¶å­¦ä¹ ä¸å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æˆ‘è¿›è¡Œåˆ é™¤å¤„ç†ã€‚</li>
				<li>æœ¬ç«™ä¸€åˆ‡èµ„æºä¸ä»£è¡¨æœ¬ç«™ç«‹åœºï¼Œå¹¶ä¸ä»£è¡¨æœ¬ç«™èµåŒå…¶è§‚ç‚¹å’Œå¯¹å…¶çœŸå®æ€§è´Ÿè´£ã€‚</li>
        		<li>æœ¬ç«™ä¸€å¾‹ç¦æ­¢ä»¥ä»»ä½•æ–¹å¼å‘å¸ƒæˆ–è½¬è½½ä»»ä½•è¿æ³•çš„ç›¸å…³ä¿¡æ¯ï¼Œè®¿å®¢å‘ç°è¯·ä¸¾æŠ¥</li> 
        		<li>æœ¬ç«™èµ„æºå¤§å¤šå­˜å‚¨åœ¨äº‘ç›˜ï¼Œå¦‚å‘ç°é“¾æ¥å¤±æ•ˆï¼Œè¯·è”ç³»æˆ‘ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´æ›´æ–°ã€‚</li>
        		<li>æœ¬ç«™å¼ºçƒˆæ‰“å‡»ç›—ç‰ˆ/ç ´è§£ç­‰æœ‰æŸä»–äººæƒç›Šå’Œè¿æ³•ä½œä¸ºï¼Œè¯·æ”¯æŒæ­£ç‰ˆï¼</li>  
			</ol>
		</tr>
	</table>
</div>








</escape>

----




























