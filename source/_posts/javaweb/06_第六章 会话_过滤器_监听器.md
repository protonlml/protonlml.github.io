---
title: ç¬¬å…­ç«  ä¼šè¯\_è¿‡æ»¤å™¨\_ç›‘å¬å™¨
date: 2019-10-08 14:00:00
author: ğš²ğš³ğš²
tags:   # æ·»åŠ åšæ–‡æ ‡ç­¾
	- javaweb
categories:   # æ·»åŠ åšæ–‡åˆ†ç±»
	- javaweb
---

## ç¬¬å…­ç«  ä¼šè¯\_è¿‡æ»¤å™¨\_ç›‘å¬å™¨



# ä¸€  ä¼šè¯

## 1.1 ä¼šè¯ç®¡ç†æ¦‚è¿°

### 1.1.1 ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯ç®¡ç†

> HTTPæ˜¯æ— çŠ¶æ€åè®®

+ æ— çŠ¶æ€å°±æ˜¯ä¸ä¿å­˜çŠ¶æ€,å³æ— çŠ¶æ€åè®®(stateless),HTTPåè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜,ä¹Ÿå°±æ˜¯è¯´,åœ¨HTTPåè®®è¿™ä¸ªçº§åˆ«,åè®®å¯¹äºå‘é€è¿‡çš„è¯·æ±‚æˆ–è€…å“åº”éƒ½ä¸åšæŒä¹…åŒ–å¤„ç†
+ ç®€å•ç†è§£:æµè§ˆå™¨å‘é€è¯·æ±‚,æœåŠ¡å™¨æ¥æ”¶å¹¶å“åº”,ä½†æ˜¯æœåŠ¡å™¨ä¸è®°å½•è¯·æ±‚æ˜¯å¦æ¥è‡ªå“ªä¸ªæµè§ˆå™¨,æœåŠ¡å™¨æ²¡è®°å½•æµè§ˆå™¨çš„ç‰¹å¾,å°±æ˜¯å®¢æˆ·ç«¯çš„çŠ¶æ€

> ä¸¾ä¾‹: å¼ ä¸‰å»ä¸€å®¶é¥­é¦†ç‚¹äº†å‡ é“èœ,è§‰å¾—å‘³é“ä¸é”™,ç¬¬äºŒå¤©åˆå»äº†,å¯¹è€æ¿è¯´,è¿˜ç‚¹ä¸Šæ¬¡çš„é‚£å‡ é“èœ

+ æ— çŠ¶æ€: è€æ¿æ²¡æœ‰è®°å½•å¼ ä¸‰æ˜¯å¦æ¥è¿‡,æ›´æ²¡æœ‰è®°å½•ä¸Šæ¬¡ä»–ç‚¹äº†é‚£äº›èœ,å¼ ä¸‰åªèƒ½é‡æ–°å†ç‚¹ä¸€é
+ æœ‰çŠ¶æ€: è€æ¿æŠŠæ¯æ¬¡æ¥åƒé¥­çš„ç”¨æˆ·éƒ½åšå¥½è®°å½•,æŸ¥é˜…ä¸€ä¸‹ä¹‹å‰çš„è®°å½•,æŸ¥åˆ°äº†å¼ ä¸‰ä¹‹å‰çš„èœå•,ç›´æ¥ä¸‹å•

### 1.1.2 ä¼šè¯ç®¡ç†å®ç°çš„æ‰‹æ®µ

> Cookieå’ŒSessioné…åˆè§£å†³

+ cookieæ˜¯åœ¨å®¢æˆ·ç«¯ä¿ç•™å°‘é‡æ•°æ®çš„æŠ€æœ¯,ä¸»è¦é€šè¿‡å“åº”å¤´å‘å®¢æˆ·ç«¯å“åº”ä¸€äº›å®¢æˆ·ç«¯è¦ä¿ç•™çš„ä¿¡æ¯
+ sessionæ˜¯åœ¨æœåŠ¡ç«¯ä¿ç•™æ›´å¤šæ•°æ®çš„æŠ€æœ¯,ä¸»è¦é€šè¿‡HttpSessionå¯¹è±¡ä¿å­˜ä¸€äº›å’Œå®¢æˆ·ç«¯ç›¸å…³çš„ä¿¡æ¯
+ cookieå’Œsessioné…åˆè®°å½•è¯·æ±‚çŠ¶æ€

> ä¸¾ä¾‹: å¼ ä¸‰å»é“¶è¡ŒåŠä¸šåŠ¡

+ å¼ ä¸‰ç¬¬ä¸€æ¬¡å»æŸä¸ªé“¶è¡ŒåŠä¸šåŠ¡,é“¶è¡Œä¼šä¸ºå¼ ä¸‰å¼€æˆ·(Session),å¹¶å‘å¼ ä¸‰å‘æ”¾ä¸€å¼ é“¶è¡Œå¡(cookie)
+ å¼ ä¸‰åé¢æ¯æ¬¡å»é“¶è¡Œ,å°±å¯ä»¥æºå¸¦ä¹‹é—´çš„é“¶è¡Œå¡(cookie),é“¶è¡Œæ ¹æ®é“¶è¡Œå¡æ‰¾åˆ°ä¹‹å‰å¼ ä¸‰çš„è´¦æˆ·(session)

## 1.2 Cookie

### 1.2.1 Cookieæ¦‚è¿°

> cookieæ˜¯ä¸€ç§å®¢æˆ·ç«¯ä¼šè¯æŠ€æœ¯,cookieç”±æœåŠ¡ç«¯äº§ç”Ÿ,å®ƒæ˜¯æœåŠ¡å™¨å­˜æ”¾åœ¨æµè§ˆå™¨çš„ä¸€å°ä»½æ•°æ®,æµè§ˆå™¨ä»¥åæ¯æ¬¡è®¿é—®è¯¥æœåŠ¡å™¨çš„æ—¶å€™éƒ½ä¼šå°†è¿™å°ä»½æ•°æ®æºå¸¦åˆ°æœåŠ¡å™¨å»ã€‚

+ æœåŠ¡ç«¯åˆ›å»ºcookie,å°†cookieæ”¾å…¥å“åº”å¯¹è±¡ä¸­,Tomcatå®¹å™¨å°†cookieè½¬åŒ–ä¸ºset-cookieå“åº”å¤´,å“åº”ç»™å®¢æˆ·ç«¯
+ å®¢æˆ·ç«¯åœ¨æ”¶åˆ°cookieçš„å“åº”å¤´æ—¶,åœ¨ä¸‹æ¬¡è¯·æ±‚è¯¥æœåŠ¡çš„èµ„æºæ—¶,ä¼šä»¥cookieè¯·æ±‚å¤´çš„å½¢å¼æºå¸¦ä¹‹å‰æ”¶åˆ°çš„Cookie
+ cookieæ˜¯ä¸€ç§é”®å€¼å¯¹æ ¼å¼çš„æ•°æ®,ä»tomcat8.5å¼€å§‹å¯ä»¥ä¿å­˜ä¸­æ–‡,ä½†æ˜¯ä¸æ¨è
+ ç”±äºcookieæ˜¯å­˜å‚¨äºå®¢æˆ·ç«¯çš„æ•°æ®,æ¯”è¾ƒå®¹æ˜“æš´éœ²,ä¸€èˆ¬ä¸å­˜å‚¨ä¸€äº›æ•æ„Ÿæˆ–è€…å½±å“å®‰å…¨çš„æ•°æ®

> åŸç†å›¾

![1682411089082](images/1682411089082.png)

> åº”ç”¨åœºæ™¯ä¸¾ä¾‹

1. è®°å½•ç”¨æˆ·å

    å½“æˆ‘ä»¬åœ¨ç”¨æˆ·åçš„è¾“å…¥æ¡†ä¸­è¾“å…¥å®Œç”¨æˆ·åå,æµè§ˆå™¨è®°å½•ç”¨æˆ·å,ä¸‹ä¸€æ¬¡å†è®¿é—®ç™»å½•é¡µé¢æ—¶,ç”¨æˆ·åè‡ªåŠ¨å¡«å……åˆ°ç”¨æˆ·åçš„è¾“å…¥æ¡†.

2. ä¿å­˜ç”µå½±æ’­æ”¾è¿›åº¦

    åœ¨ç½‘é¡µä¸Šæ’­æ”¾ç”µå½±çš„æ—¶å€™,å¦‚æœä¸­é€”é€€å‡ºæµè§ˆå™¨äº†,ä¸‹è½½å†æ‰“å¼€æµè§ˆå™¨æ’­æ”¾åŒä¸€éƒ¨ç”µå½±çš„æ—¶å€™,ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸Šæ¬¡é€€å‡ºæ—¶å€™çš„è¿›åº¦,å› ä¸ºåœ¨æ’­æ”¾çš„æ—¶å€™ä¼šå°†æ’­æ”¾è¿›åº¦ä¿å­˜åˆ°cookieä¸­



### 1.2.2 Cookieçš„ä½¿ç”¨

> servletAå‘å“åº”ä¸­å¢åŠ Cookie

``` java
@WebServlet("/servletA")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // åˆ›å»ºCookie
        Cookie cookie1 =new Cookie("c1","c1_message");
        Cookie cookie2 =new Cookie("c2","c2_message");
        // å°†cookieæ”¾å…¥å“åº”å¯¹è±¡
        resp.addCookie(cookie1);
        resp.addCookie(cookie2);
    }
}
```

<img src="images/1682411522695.png" alt="1682411522695" style="zoom:80%;" />







> servletBä»è¯·æ±‚ä¸­è¯»å–Cookie

``` java
@WebServlet("/servletB")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è·å–è¯·æ±‚ä¸­çš„cookie
        Cookie[] cookies = req.getCookies();
        //è¿­ä»£cookiesæ•°ç»„
        if (null != cookies && cookies.length!= 0) {
            for (Cookie cookie : cookies) {
                System.out.println(cookie.getName()+":"+cookie.getValue());
            }
        }
    }
}
```

<img src="images/1682411757748.png" alt="1682411757748" style="zoom:67%;" />

### 1.2.2  Cookieçš„æ—¶æ•ˆæ€§

> é»˜è®¤æƒ…å†µä¸‹Cookieçš„æœ‰æ•ˆæœŸæ˜¯ä¸€æ¬¡ä¼šè¯èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡cookieçš„setMaxAge()æ–¹æ³•è®©CookieæŒä¹…åŒ–ä¿å­˜åˆ°æµè§ˆå™¨ä¸Š

-   ä¼šè¯çº§Cookie
    -   æœåŠ¡å™¨ç«¯å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šCookieçš„å­˜åœ¨æ—¶é—´
    -   åœ¨æµè§ˆå™¨ç«¯ï¼ŒCookieæ•°æ®å­˜åœ¨äºå†…å­˜ä¸­
    -   åªè¦æµè§ˆå™¨è¿˜å¼€ç€ï¼ŒCookieæ•°æ®å°±ä¸€ç›´éƒ½åœ¨
    -   æµè§ˆå™¨å…³é—­ï¼Œå†…å­˜ä¸­çš„Cookieæ•°æ®å°±ä¼šè¢«é‡Šæ”¾
-   æŒä¹…åŒ–Cookie
    -   æœåŠ¡å™¨ç«¯æ˜ç¡®è®¾ç½®äº†Cookieçš„å­˜åœ¨æ—¶é—´
    -   åœ¨æµè§ˆå™¨ç«¯ï¼ŒCookieæ•°æ®ä¼šè¢«ä¿å­˜åˆ°ç¡¬ç›˜ä¸Š
    -   Cookieåœ¨ç¡¬ç›˜ä¸Šå­˜åœ¨çš„æ—¶é—´æ ¹æ®æœåŠ¡å™¨ç«¯é™å®šçš„æ—¶é—´æ¥ç®¡æ§ï¼Œä¸å—æµè§ˆå™¨å…³é—­çš„å½±å“
    -   æŒä¹…åŒ–Cookieåˆ°è¾¾äº†é¢„è®¾çš„æ—¶é—´ä¼šè¢«é‡Šæ”¾

> cookie.setMaxAge(int expiry)å‚æ•°å•ä½æ˜¯ç§’ï¼Œè¡¨ç¤ºcookieçš„æŒä¹…åŒ–æ—¶é—´ï¼Œå¦‚æœè®¾ç½®å‚æ•°ä¸º0ï¼Œè¡¨ç¤ºå°†æµè§ˆå™¨ä¸­ä¿å­˜çš„è¯¥cookieåˆ é™¤

+ servletAè®¾ç½®ä¸€ä¸ªCookieä¸ºæŒä¹…åŒ–cookie

``` java
@WebServlet("/servletA")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // åˆ›å»ºCookie
        Cookie cookie1 =new Cookie("c1","c1_message");
        cookie1.setMaxAge(60);
        Cookie cookie2 =new Cookie("c2","c2_message");
        // å°†cookieæ”¾å…¥å“åº”å¯¹è±¡
        resp.addCookie(cookie1);
        resp.addCookie(cookie2);
    }
}
```

<img src="images/1682470547651.png" alt="1682470547651" style="zoom: 67%;" />

+ servletBæ¥æ”¶Cookie,æµè§ˆå™¨ä¸­é—´å‘ç”Ÿä¸€æ¬¡é‡å¯å†è¯·æ±‚servletBæµ‹è¯•

``` java
@WebServlet("/servletB")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è·å–è¯·æ±‚ä¸­çš„cookie
        Cookie[] cookies = req.getCookies();
        //è¿­ä»£cookiesæ•°ç»„
        if (null != cookies && cookies.length!= 0) {
            for (Cookie cookie : cookies) {
                System.out.println(cookie.getName()+":"+cookie.getValue());
            }
        }
    }
}
```

<img src="images/1682470652577.png" alt="1682470652577" style="zoom: 70%;" />





### 1.2.3 Cookieçš„æäº¤è·¯å¾„

> è®¿é—®äº’è”ç½‘èµ„æºæ—¶ä¸èƒ½æ¯æ¬¡éƒ½éœ€è¦æŠŠæ‰€æœ‰Cookieå¸¦ä¸Šã€‚è®¿é—®ä¸åŒçš„èµ„æºæ—¶,å¯ä»¥æºå¸¦ä¸åŒçš„cookie,æˆ‘ä»¬å¯ä»¥é€šè¿‡cookieçš„setPath(String path) å¯¹cookieçš„è·¯å¾„è¿›è¡Œè®¾ç½®

+ ä»ServletAä¸­è·å–cookie

``` java
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // åˆ›å»ºCookie
        Cookie cookie1 =new Cookie("c1","c1_message");
        // è®¾ç½®cookieçš„æäº¤è·¯å¾„
        cookie1.setPath("/web03_war_exploded/servletB");
        Cookie cookie2 =new Cookie("c2","c2_message");
        // å°†cookieæ”¾å…¥å“åº”å¯¹è±¡
        resp.addCookie(cookie1);
        resp.addCookie(cookie2);
    }
}

```

<img src="images/1682471183183.png" alt="1682471183183" style="zoom:80%;" />

+ å‘ServletBè¯·æ±‚æ—¶æºå¸¦æºå¸¦äº† c1

<img src="images/1682471232199.png" alt="1682471232199" style="zoom:95%;" />

+ å‘å…¶ä»–èµ„æºè¯·æ±‚æ—¶å°±ä¸æºå¸¦c1äº†

<img src="images/1682471342313.png" alt="1682471342313" style="zoom:80%;" />



## 1.3 Session

### 1.3.1 HttpSessionæ¦‚è¿°

>  HttpSessionæ˜¯ä¸€ç§ä¿ç•™æ›´å¤šä¿¡æ¯åœ¨æœåŠ¡ç«¯çš„ä¸€ç§æŠ€æœ¯,æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯å¼€è¾Ÿä¸€å—å†…å­˜ç©ºé—´,å³sessionå¯¹è±¡. å®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚æ—¶,éƒ½å¯ä»¥ä½¿ç”¨è‡ªå·±çš„session. è¿™æ ·æœåŠ¡ç«¯å°±å¯ä»¥é€šè¿‡sessionæ¥è®°å½•æŸä¸ªå®¢æˆ·ç«¯çš„çŠ¶æ€äº†

+ æœåŠ¡ç«¯åœ¨ä¸ºå®¢æˆ·ç«¯åˆ›å»ºsessionæ—¶,ä¼šåŒæ—¶å°†sessionå¯¹è±¡çš„id,å³JSESSIONIDä»¥cookieçš„å½¢å¼æ”¾å…¥å“åº”å¯¹è±¡
+ åç«¯åˆ›å»ºå®Œsessionå,å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªç‰¹æ®Šçš„cookie,å«åšJSESSIONID
+ å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶æºå¸¦JSESSIONID,åç«¯æ”¶åˆ°å,æ ¹æ®JSESSIONIDæ‰¾åˆ°å¯¹åº”çš„sessionå¯¹è±¡
+ é€šè¿‡è¯¥æœºåˆ¶,æœåŠ¡ç«¯é€šè¿‡sessionå°±å¯ä»¥å­˜å‚¨ä¸€äº›ä¸“é—¨é’ˆå¯¹æŸä¸ªå®¢æˆ·ç«¯çš„ä¿¡æ¯äº†
+ sessionä¹Ÿæ˜¯åŸŸå¯¹è±¡(åç»­è¯¦ç»†è®²è§£)

> åŸç†å›¾å¦‚ä¸‹

![1682413051408](images/1682413051408.png)

> åº”ç”¨åœºæ™¯

1. è®°å½•ç”¨æˆ·çš„ç™»å½•çŠ¶æ€

    ç”¨æˆ·ç™»å½•å,å°†ç”¨æˆ·çš„è´¦å·ç­‰æ•æ„Ÿä¿¡æ¯å­˜å…¥session

2. è®°å½•ç”¨æˆ·æ“ä½œçš„å†å²

    ä¾‹å¦‚è®°å½•ç”¨æˆ·çš„è®¿é—®ç—•è¿¹,ç”¨æˆ·çš„è´­ç‰©è½¦ä¿¡æ¯ç­‰ä¸´æ—¶æ€§çš„ä¿¡æ¯

### 1.3.2 HttpSessionçš„ä½¿ç”¨

> ç”¨æˆ·æäº¤formè¡¨å•åˆ°ServletA,æºå¸¦ç”¨æˆ·å,ServletAè·å–session å°†ç”¨æˆ·åå­˜åˆ°Session,ç”¨æˆ·å†è¯·æ±‚å…¶ä»–ä»»æ„Servlet,è·å–ä¹‹é—´å­˜å‚¨çš„ç”¨æˆ·

+ å®šä¹‰è¡¨å•é¡µ,æäº¤ç”¨æˆ·å,æäº¤å

``` html
    <form action="servletA" method="post">
        ç”¨æˆ·å:
        <input type="text" name="username">
        <input type="submit" value="æäº¤">
    </form>
```

+ å®šä¹‰ServletA,å°†ç”¨æˆ·åå­˜å…¥session

``` java
@WebServlet("/servletA")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // è·å–è¯·æ±‚ä¸­çš„å‚æ•°
        String username = req.getParameter("username");
        // è·å–sessionå¯¹è±¡
        HttpSession session = req.getSession();
         // è·å–Sessionçš„ID
        String jSessionId = session.getId();
        System.out.println(jSessionId);
        // åˆ¤æ–­sessionæ˜¯ä¸æ˜¯æ–°åˆ›å»ºçš„session
        boolean isNew = session.isNew();
        System.out.println(isNew);
        // å‘sessionå¯¹è±¡ä¸­å­˜å…¥æ•°æ®
        session.setAttribute("username",username);

    }
}
```

+ å“åº”ä¸­æ”¶åˆ°äº†ä¸€ä¸ªJSESSIONIDçš„cookie

<img src="images/1682476311432.png" alt="1682476311432" style="zoom:80%;" />

+ å®šä¹‰å…¶ä»–Servlet,ä»sessionä¸­è¯»å–ç”¨æˆ·å

``` java
@WebServlet("/servletB")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // è·å–sessionå¯¹è±¡
        HttpSession session = req.getSession();
         // è·å–Sessionçš„ID
        String jSessionId = session.getId();
        System.out.println(jSessionId);
        // åˆ¤æ–­sessionæ˜¯ä¸æ˜¯æ–°åˆ›å»ºçš„session
        boolean isNew = session.isNew();
        System.out.println(isNew);
        // ä»sessionä¸­å–å‡ºæ•°æ®
        String username = (String)session.getAttribute("username");
        System.out.println(username);
    }
}
```

+ è¯·æ±‚ä¸­æºå¸¦äº†ä¸€ä¸ªJSESSIONIDçš„cookie

<img src="images/1682476350602.png" alt="1682476350602" style="zoom:80%;" />

> getSessionæ–¹æ³•çš„å¤„ç†é€»è¾‘

<img src="images/1682477914654.png" alt="1682477914654" style="zoom: 80%;" />



### 1.3.3 HttpSessionæ—¶æ•ˆæ€§

> ä¸ºä»€ä¹ˆè¦è®¾ç½®sessionçš„æ—¶æ•ˆ

+ ç”¨æˆ·é‡å¾ˆå¤§ä¹‹åï¼ŒSessionå¯¹è±¡ç›¸åº”çš„ä¹Ÿè¦åˆ›å»ºå¾ˆå¤šã€‚å¦‚æœä¸€å‘³åˆ›å»ºä¸é‡Šæ”¾ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯çš„å†…å­˜è¿Ÿæ—©è¦è¢«è€—å°½ã€‚
+ å®¢æˆ·ç«¯å…³é—­è¡Œä¸ºæ— æ³•è¢«æœåŠ¡ç«¯ç›´æ¥ä¾¦æµ‹,æˆ–è€…å®¢æˆ·ç«¯è¾ƒé•¿æ—¶é—´ä¸æ“ä½œä¹Ÿç»å¸¸å‡ºç°,ç±»ä¼¼è¿™äº›çš„æƒ…å†µ,å°±éœ€è¦å¯¹sessionçš„æ—¶é™è¿›è¡Œè®¾ç½®äº†

> é»˜è®¤çš„sessionæœ€å¤§é—²ç½®æ—¶é—´(ä¸¤æ¬¡ä½¿ç”¨åŒä¸€ä¸ªsessionä¸­çš„é—´éš”æ—¶é—´) åœ¨tomcat/conf/web.xmlé…ç½®ä¸º30åˆ†é’Ÿ

![1682478412527](images/1682478412527.png)

> æˆ‘ä»¬å¯ä»¥è‡ªå·±åœ¨å½“å‰é¡¹ç›®çš„web.xmlå¯¹æœ€å¤§é—²ç½®æ—¶é—´è¿›è¡Œé‡æ–°è®¾å®š

![1682478633650](images/1682478633650.png)

> ä¹Ÿå¯ä»¥é€šè¿‡HttpSessionçš„API å¯¹æœ€å¤§é—²ç½®æ—¶é—´è¿›è¡Œè®¾å®š

``` java
// è®¾ç½®æœ€å¤§é—²ç½®æ—¶é—´
session.setMaxInactiveInterval(60);
```

> ä¹Ÿå¯ä»¥ç›´æ¥è®©sessionå¤±æ•ˆ

``` java
// ç›´æ¥è®©sessionå¤±æ•ˆ
session.invalidate();
```

## 1.4 ä¸‰å¤§åŸŸå¯¹è±¡

### 1.4.1 åŸŸå¯¹è±¡æ¦‚è¿°

> åŸŸå¯¹è±¡: ä¸€äº›ç”¨äºå­˜å‚¨æ•°æ®å’Œä¼ é€’æ•°æ®çš„å¯¹è±¡,ä¼ é€’æ•°æ®ä¸åŒçš„èŒƒå›´,æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸åŒçš„åŸŸ,ä¸åŒçš„åŸŸå¯¹è±¡ä»£è¡¨ä¸åŒçš„åŸŸ,å…±äº«æ•°æ®çš„èŒƒå›´ä¹Ÿä¸åŒ

+ webé¡¹ç›®ä¸­,æˆ‘ä»¬ä¸€å®šè¦ç†Ÿç»ƒä½¿ç”¨çš„åŸŸå¯¹è±¡åˆ†åˆ«æ˜¯ è¯·æ±‚åŸŸ,ä¼šè¯åŸŸ,åº”ç”¨åŸŸ
+ è¯·æ±‚åŸŸå¯¹è±¡æ˜¯HttpServletRequest ,ä¼ é€’æ•°æ®çš„èŒƒå›´æ˜¯ä¸€æ¬¡è¯·æ±‚ä¹‹å†…åŠè¯·æ±‚è½¬å‘
+ ä¼šè¯åŸŸå¯¹è±¡æ˜¯HttpSession,ä¼ é€’æ•°æ®çš„èŒƒå›´æ˜¯ä¸€æ¬¡ä¼šè¯ä¹‹å†…,å¯ä»¥è·¨å¤šä¸ªè¯·æ±‚
+ åº”ç”¨åŸŸå¯¹è±¡æ˜¯ServletContext,ä¼ é€’æ•°æ®çš„èŒƒå›´æ˜¯æœ¬åº”ç”¨ä¹‹å†…,å¯ä»¥è·¨å¤šä¸ªä¼šè¯

> ç”Ÿæ´»ä¸¾ä¾‹: çƒ­æ°´å™¨æ‘†æ”¾ä½ç½®ä¸åŒ,ä½¿ç”¨çš„èŒƒå›´å°±ä¸åŒ

1. æ‘†åœ¨å¼ ä¸‰å·¥ä½ä¸‹,å°±åªæœ‰å¼ ä¸‰ä¸€ä¸ªäººèƒ½ç”¨
2. æ‘†åœ¨åŠå…¬å®¤çš„å…¬å…±åŒº,åŠå…¬å®¤å†…çš„æ‰€æœ‰äººéƒ½å¯ä»¥ç”¨
3. æ‘†åœ¨æ¥¼å±‚çš„èµ°å»ŠåŒº,è¯¥æ¥¼å±‚çš„æ‰€æœ‰äººéƒ½å¯ä»¥ç”¨

> ä¸‰å¤§åŸŸå¯¹è±¡çš„æ•°æ®ä½œç”¨èŒƒå›´å›¾è§£

+ è¯·æ±‚åŸŸ

<img src="images/1682480592506.png" alt="1682480592506" style="zoom: 60%;" />

+ ä¼šè¯åŸŸ

<img src="images/1682480716152.png" alt="1682480716152" style="zoom:60%;" />

+ åº”ç”¨åŸŸ

<img src="images/1682480913847.png" alt="1682480913847" style="zoom:60%;" />

+ æ‰€æœ‰åŸŸåœ¨ä¸€èµ·

<img src="images/1682488186891.png" alt="1682488186891" style="zoom:60%;" />

### 1.4.2 åŸŸå¯¹è±¡çš„ä½¿ç”¨

> åŸŸå¯¹è±¡çš„API

| API                                         | åŠŸèƒ½                    |
| ------------------------------------------- | ----------------------- |
| void setAttribute(String name,String value) | å‘åŸŸå¯¹è±¡ä¸­æ·»åŠ /ä¿®æ”¹æ•°æ® |
| Object getAttribute(String name);           | ä»åŸŸå¯¹è±¡ä¸­è·å–æ•°æ®      |
| removeAttribute(String name);               | ç§»é™¤åŸŸå¯¹è±¡ä¸­çš„æ•°æ®      |

> APIæµ‹è¯•

+ ServletAå‘ä¸‰å¤§åŸŸä¸­æ”¾å…¥æ•°æ®

``` java
@WebServlet("/servletA")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å‘è¯·æ±‚åŸŸä¸­æ”¾å…¥æ•°æ®
        req.setAttribute("request","request-message");
        //req.getRequestDispatcher("servletB").forward(req,resp);
        // å‘ä¼šè¯åŸŸä¸­æ”¾å…¥æ•°æ®
        HttpSession session = req.getSession();
        session.setAttribute("session","session-message");
        // å‘åº”ç”¨åŸŸä¸­æ”¾å…¥æ•°æ®
        ServletContext application = getServletContext();
        application.setAttribute("application","application-message");

    }
}

```

+ ServletBä»ä¸‰å¤§äºä¸­å–å‡ºæ•°æ®

``` java
@WebServlet("/servletB")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // ä»è¯·æ±‚åŸŸä¸­è·å–æ•°æ®
        String reqMessage =(String)req.getAttribute("request");
        System.out.println(reqMessage);
        
        // ä»ä¼šè¯åŸŸä¸­è·å–æ•°æ®
        HttpSession session = req.getSession();
        String sessionMessage =(String)session.getAttribute("session");
        System.out.println(sessionMessage);
        // ä»åº”ç”¨åŸŸä¸­è·å–æ•°æ®
        ServletContext application = getServletContext();
        String applicationMessage =(String)application.getAttribute("application");
        System.out.println(applicationMessage);
    }
}
```



+ è¯·æ±‚è½¬å‘æ—¶,è¯·æ±‚åŸŸå¯ä»¥ä¼ é€’æ•°æ®`è¯·æ±‚åŸŸå†…ä¸€èˆ¬æ”¾æœ¬æ¬¡è¯·æ±‚ä¸šåŠ¡æœ‰å…³çš„æ•°æ®,å¦‚:æŸ¥è¯¢åˆ°çš„æ‰€æœ‰çš„éƒ¨é—¨ä¿¡æ¯`
+ åŒä¸€ä¸ªä¼šè¯å†…,ä¸ç”¨è¯·æ±‚è½¬å‘,ä¼šè¯åŸŸå¯ä»¥ä¼ é€’æ•°æ®`ä¼šè¯åŸŸå†…ä¸€èˆ¬æ”¾æœ¬æ¬¡ä¼šè¯çš„å®¢æˆ·ç«¯æœ‰å…³çš„æ•°æ®,å¦‚:å½“å‰å®¢æˆ·ç«¯ç™»å½•çš„ç”¨æˆ·` 
+ åŒä¸€ä¸ªAPPå†…,ä¸åŒçš„å®¢æˆ·ç«¯,åº”ç”¨åŸŸå¯ä»¥ä¼ é€’æ•°æ®`åº”ç”¨åŸŸå†…ä¸€èˆ¬æ”¾æœ¬ç¨‹åºåº”ç”¨æœ‰å…³çš„æ•°æ® å¦‚:Springæ¡†æ¶çš„IOCå®¹å™¨`



# äºŒ è¿‡æ»¤å™¨

## 2.1 è¿‡æ»¤å™¨æ¦‚è¿°

> Filter,å³è¿‡æ»¤å™¨,æ˜¯JAVAEEæŠ€æœ¯è§„èŒƒä¹‹ä¸€,ä½œç”¨ç›®æ ‡èµ„æºçš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤çš„ä¸€å¥—æŠ€æœ¯è§„èŒƒ,æ˜¯Java Webé¡¹ç›®ä¸­`æœ€ä¸ºå®ç”¨çš„æŠ€æœ¯ä¹‹ä¸€`

+ Filteræ¥å£å®šä¹‰äº†è¿‡æ»¤å™¨çš„å¼€å‘è§„èŒƒ,æ‰€æœ‰çš„è¿‡æ»¤å™¨éƒ½è¦å®ç°è¯¥æ¥å£
+ Filterçš„å·¥ä½œä½ç½®æ˜¯é¡¹ç›®ä¸­æ‰€æœ‰ç›®æ ‡èµ„æºä¹‹å‰,å®¹å™¨åœ¨åˆ›å»ºHttpServletRequestå’ŒHttpServletResponseå¯¹è±¡å,ä¼šå…ˆè°ƒç”¨Filterçš„doFilteræ–¹æ³•
+ Filterçš„doFilteræ–¹æ³•å¯ä»¥æ§åˆ¶è¯·æ±‚æ˜¯å¦ç»§ç»­,å¦‚æœæ”¾è¡Œ,åˆ™è¯·æ±‚ç»§ç»­,å¦‚æœæ‹’ç»,åˆ™è¯·æ±‚åˆ°æ­¤ä¸ºæ­¢,ç”±è¿‡æ»¤å™¨æœ¬èº«åšå‡ºå“åº”
+ Filterä¸ä»…å¯ä»¥å¯¹è¯·æ±‚åšå‡ºè¿‡æ»¤,ä¹Ÿå¯ä»¥åœ¨ç›®æ ‡èµ„æºåšå‡ºå“åº”å‰,å¯¹å“åº”å†æ¬¡è¿›è¡Œå¤„ç†
+ Filteræ˜¯GOFä¸­è´£ä»»é“¾æ¨¡å¼çš„å…¸å‹æ¡ˆä¾‹
+ Filterçš„å¸¸ç”¨åº”ç”¨åŒ…æ‹¬ä½†ä¸é™äº: ç™»å½•æƒé™æ£€æŸ¥,è§£å†³ç½‘ç«™ä¹±ç ,è¿‡æ»¤æ•æ„Ÿå­—ç¬¦,æ—¥å¿—è®°å½•,æ€§èƒ½åˆ†æ... ...

> ç”Ÿæ´»ä¸¾ä¾‹: å…¬å¸å‰å°,åœè½¦åœºå®‰ä¿,åœ°é“éªŒç¥¨é—¸æœº

+ å…¬å¸å‰å°å¯¹æ¥è®¿äººå‘˜è¿›è¡Œå®¡æ ¸,å¦‚æœæ˜¯æ¸¸å®¢åˆ™æ‹’ç»è¿›å…¥å…¬å¸,å¦‚æœæ˜¯å®¢æˆ·åˆ™æ”¾è¡Œ . å®¢æˆ·ç¦»å¼€æ—¶æé†’å®¢æˆ·ä¸è¦é—å¿˜ç‰©å“
+ åœè½¦åœºä¿å®‰å¯¹æ¥è®¿è½¦è¾†è¿›è¡Œæ§åˆ¶,å¦‚æœæ²¡æœ‰è½¦ä½æ‹’ç»è¿›å…¥,å¦‚æœæœ‰è½¦ä½,å‘æ”¾åœè½¦å¡å¹¶æ”¾è¡Œ,è½¦è¾†ç¦»å¼€æ—¶æ”¶å–è¯·è½¦è´¹
+ åœ°é“éªŒç¥¨é—¸æœºåœ¨äººå‘˜è¿›å…¥ä¹‹å‰æ£€æŸ¥ç¥¨,æ²¡ç¥¨æ‹’ç»è¿›å…¥,æœ‰ç¥¨éªŒç¥¨åæ”¾è¡Œ,äººå‘˜ç¦»å¼€æ—¶åŒæ ·éªŒç¥¨

> è¿‡æ»¤å™¨å¼€å‘ä¸­åº”ç”¨çš„åœºæ™¯

+ æ—¥å¿—çš„è®°å½•
+ æ€§èƒ½çš„åˆ†æ
+ ä¹±ç çš„å¤„ç†
+ äº‹åŠ¡çš„æ§åˆ¶
+ ç™»å½•çš„æ§åˆ¶
+ è·¨åŸŸçš„å¤„ç†
+ ... ...

> è¿‡æ»¤å™¨å·¥ä½œä½ç½®å›¾è§£

![1682494494396](images/1682494494396.png)

> Filteræ¥å£API

+ æºç 

``` java
package jakarta.servlet;
import java.io.IOException;

public interface Filter {
    default public void init(FilterConfig filterConfig) throws ServletException {
    }
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException;
    default public void destroy() {
    }
}

```

+ APIç›®æ ‡

| API                                                          | ç›®æ ‡                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| default public void init(FilterConfig filterConfig)          | åˆå§‹åŒ–æ–¹æ³•,ç”±å®¹å™¨è°ƒç”¨å¹¶ä¼ å…¥åˆå§‹é…ç½®ä¿¡æ¯filterConfigå¯¹è±¡      |
| public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) | è¿‡æ»¤æ–¹æ³•,æ ¸å¿ƒæ–¹æ³•,è¿‡æ»¤è¯·æ±‚,å†³å®šæ˜¯å¦æ”¾è¡Œ,å“åº”ä¹‹å‰çš„å…¶ä»–å¤„ç†ç­‰éƒ½åœ¨è¯¥æ–¹æ³•ä¸­ |
| default public void destroy()                                | é”€æ¯æ–¹æ³•,å®¹å™¨åœ¨å›æ”¶è¿‡æ»¤å™¨å¯¹è±¡ä¹‹å‰è°ƒç”¨çš„æ–¹æ³•                  |

## 2.2 è¿‡æ»¤å™¨ä½¿ç”¨

> ç›®æ ‡:å¼€å‘ä¸€ä¸ªæ—¥å¿—è®°å½•è¿‡æ»¤å™¨

+ ç”¨æˆ·è¯·æ±‚åˆ°è¾¾ç›®æ ‡èµ„æºä¹‹å‰,è®°å½•ç”¨æˆ·çš„è¯·æ±‚èµ„æºè·¯å¾„
+ å“åº”ä¹‹å‰è®°å½•æœ¬æ¬¡è¯·æ±‚ç›®æ ‡èµ„æºè¿ç®—çš„è€—æ—¶
+ å¯ä»¥é€‰æ‹©å°†æ—¥å¿—è®°å½•è¿›å…¥æ–‡ä»¶,ä¸ºäº†æ–¹ä¾¿æµ‹è¯•,è¿™é‡Œå°†æ—¥å¿—ç›´æ¥åœ¨æ§åˆ¶å°æ‰“å°

>  å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ç±»,ç¼–å†™åŠŸèƒ½ä»£ç 

``` java
package com.atguigu.filters;


import jakarta.servlet.*;
import jakarta.servlet.annotation.WebFilter;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;
public class LoggingFilter  implements Filter {

    private SimpleDateFormat dateFormat =new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        // å‚æ•°çˆ¶è½¬å­
        HttpServletRequest request =(HttpServletRequest)  servletRequest;
        HttpServletResponse  response =(HttpServletResponse)  servletResponse;
        // æ‹¼æ¥æ—¥å¿—æ–‡æœ¬
        String requestURI = request.getRequestURI();
        String time = dateFormat.format(new Date());
        String beforeLogging =requestURI+"åœ¨"+time+"è¢«è¯·æ±‚äº†";
        // æ‰“å°æ—¥å¿—
        System.out.println(beforeLogging);
        // è·å–ç³»ç»Ÿæ—¶é—´
        long t1 = System.currentTimeMillis();
        // æ”¾è¡Œè¯·æ±‚
        filterChain.doFilter(request,response);
        // è·å–ç³»ç»Ÿæ—¶é—´
        long t2 = System.currentTimeMillis();
        //  æ‹¼æ¥æ—¥å¿—æ–‡æœ¬
        String afterLogging =requestURI+"åœ¨"+time+"çš„è¯·æ±‚è€—æ—¶:"+(t2-t1)+"æ¯«ç§’";
        // æ‰“å°æ—¥å¿—
        System.out.println(afterLogging);

    }
}

```

+ è¯´æ˜
    + doFilteræ–¹æ³•ä¸­çš„è¯·æ±‚å’Œå“åº”å¯¹è±¡æ˜¯ä»¥çˆ¶æ¥å£çš„å½¢å¼å£°æ˜çš„,å®é™…ä¼ å…¥çš„å®å‚å°±æ˜¯HttpServletRequestå’ŒHttpServletResponseå­æ¥å£çº§åˆ«çš„,å¯ä»¥å®‰å…¨å¼ºè½¬
    + filterChain.doFilter(request,response); è¿™è¡Œä»£ç çš„åŠŸèƒ½æ˜¯æ”¾è¡Œè¯·æ±‚,å¦‚æœæ²¡æœ‰è¿™ä¸€è¡Œä»£ç ,åˆ™è¯·æ±‚åˆ°æ­¤ä¸ºæ­¢
    + filterChain.doFilter(request,response);åœ¨æ”¾è¡Œæ—¶éœ€è¦ä¼ å…¥requestå’Œresponse,æ„å‘³ç€è¯·æ±‚å’Œå“åº”å¯¹è±¡è¦ç»§ç»­ä¼ é€’ç»™åç»­çš„èµ„æº,è¿™é‡Œæ²¡æœ‰äº§ç”Ÿæ–°çš„requestå’Œresponseå¯¹è±¡

> å®šä¹‰ä¸¤ä¸ªServletä½œä¸ºç›®æ ‡èµ„æº

+ ServletA

``` java 
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å¤„ç†å™¨è¯·æ±‚
        System.out.println("servletAå¤„ç†è¯·æ±‚çš„æ–¹æ³•,è€—æ—¶10æ¯«ç§’");
        // æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚è€—æ—¶
        try {
            Thread.sleep(10);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }

    }
}
```

+ ServletB

``` java 
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å¤„ç†å™¨è¯·æ±‚
        System.out.println("servletBå¤„ç†è¯·æ±‚çš„æ–¹æ³•,è€—æ—¶15æ¯«ç§’");
        // æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚è€—æ—¶
        try {
            Thread.sleep(15);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    }
}

```

> é…ç½®è¿‡æ»¤å™¨ä»¥åŠè¿‡æ»¤å™¨çš„è¿‡æ»¤èŒƒå›´

+ web.xml

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"
         version="5.0">

    <!--é…ç½®filter,å¹¶ä¸ºfilterèµ·åˆ«å-->
   <filter>
       <filter-name>loggingFilter</filter-name>
       <filter-class>com.atguigu.filters.LoggingFilter</filter-class>
   </filter>
    <!--ä¸ºåˆ«åå¯¹åº”çš„filteré…ç½®è¦è¿‡æ»¤çš„ç›®æ ‡èµ„æº-->
    <filter-mapping>
        <filter-name>loggingFilter</filter-name>
        <!--é€šè¿‡æ˜ å°„è·¯å¾„ç¡®å®šè¿‡æ»¤èµ„æº-->
        <url-pattern>/servletA</url-pattern>
        <!--é€šè¿‡åç¼€åç¡®å®šè¿‡æ»¤èµ„æº-->
        <url-pattern>*.html</url-pattern>
        <!--é€šè¿‡servletåˆ«åç¡®å®šè¿‡æ»¤èµ„æº-->
        <servlet-name>servletBName</servlet-name>

    </filter-mapping>
</web-app>
```

+ è¯´æ˜

    + filter-mappingæ ‡ç­¾ä¸­å®šä¹‰äº†è¿‡æ»¤å™¨å¯¹é‚£äº›èµ„æºè¿›è¡Œè¿‡æ»¤
    + å­æ ‡ç­¾url-patterné€šè¿‡æ˜ å°„è·¯å¾„ç¡®å®šè¿‡æ»¤èŒƒå›´
        + /servletA  ç²¾ç¡®åŒ¹é…,è¡¨ç¤ºå¯¹servletAèµ„æºçš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤
        + *.html è¡¨ç¤ºå¯¹ä»¥.actionç»“å°¾çš„è·¯å¾„è¿›è¡Œè¿‡æ»¤
        + /* è¡¨ç¤ºå¯¹æ‰€æœ‰èµ„æºè¿›è¡Œè¿‡æ»¤
        + ä¸€ä¸ªfilter-mappingä¸‹å¯ä»¥é…ç½®å¤šä¸ªurl-pattern
    + å­æ ‡ç­¾servlet-nameé€šè¿‡servletåˆ«åç¡®å®šå¯¹é‚£äº›servletè¿›è¡Œè¿‡æ»¤
        + ä½¿ç”¨è¯¥æ ‡ç­¾ç¡®å®šç›®æ ‡èµ„æºçš„å‰ææ˜¯servletå·²ç»èµ·äº†åˆ«å
        + ä¸€ä¸ªfilter-mappingä¸‹å¯ä»¥å®šä¹‰å¤šä¸ªservlet-name
        + ä¸€ä¸ªfilter-mappingä¸‹,servlet-nameå’Œurl-patternå­æ ‡ç­¾å¯ä»¥åŒæ—¶å­˜åœ¨

    

> è¿‡æ»¤è¿‡ç¨‹å›¾è§£

![1682496991032](images/1682496991032.png)

## 2.3 è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ

> è¿‡æ»¤å™¨ä½œä¸ºwebé¡¹ç›®çš„ç»„ä»¶ä¹‹ä¸€,å’ŒServletçš„ç”Ÿå‘½å‘¨æœŸç±»ä¼¼,ç•¥æœ‰ä¸åŒ,æ²¡æœ‰servletçš„load-on-startupçš„é…ç½®,é»˜è®¤å°±æ˜¯ç³»ç»Ÿå¯åŠ¨ç«‹åˆ»æ„é€ 

| é˜¶æ®µ       | å¯¹åº”æ–¹æ³•                                                     | æ‰§è¡Œæ—¶æœº      | æ‰§è¡Œæ¬¡æ•° |
| ---------- | ------------------------------------------------------------ | ------------- | -------- |
| åˆ›å»ºå¯¹è±¡   | æ„é€ å™¨                                                       | webåº”ç”¨å¯åŠ¨æ—¶ | 1        |
| åˆå§‹åŒ–æ–¹æ³• | void init(FilterConfig filterConfig)                         | æ„é€ å®Œæ¯•      | 1        |
| è¿‡æ»¤è¯·æ±‚   | void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) | æ¯æ¬¡è¯·æ±‚      | å¤šæ¬¡     |
| é”€æ¯       | default void destroy()                                       | webåº”ç”¨å…³é—­æ—¶ | 1æ¬¡      |

> æµ‹è¯•ä»£ç 

``` java
package com.atguigu.filters;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebServlet;

import java.io.IOException;


@WebServlet("/*")
public class LifeCycleFilter implements Filter {
    public LifeCycleFilter(){
        System.out.println("LifeCycleFilter constructor method invoked");
    }
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        System.out.println("LifeCycleFilter init method invoked");
        
    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        System.out.println("LifeCycleFilter doFilter method invoked");
        filterChain.doFilter(servletRequest,servletResponse);
    }

    @Override
    public void destroy() {
        System.out.println("LifeCycleFilter destory method invoked");
    }
}

```



## 2.4 è¿‡æ»¤å™¨é“¾çš„ä½¿ç”¨

> ä¸€ä¸ªwebé¡¹ç›®ä¸­,å¯ä»¥åŒæ—¶å®šä¹‰å¤šä¸ªè¿‡æ»¤å™¨,å¤šä¸ªè¿‡æ»¤å™¨å¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œè¿‡æ»¤æ—¶,å·¥ä½œä½ç½®æœ‰å…ˆå,æ•´ä½“å½¢æˆä¸€ä¸ªå·¥ä½œé“¾,ç§°ä¹‹ä¸ºè¿‡æ»¤å™¨é“¾

+ è¿‡æ»¤å™¨é“¾ä¸­çš„è¿‡æ»¤å™¨çš„é¡ºåºç”±filter-mappingé¡ºåºå†³å®š
+ æ¯ä¸ªè¿‡æ»¤å™¨è¿‡æ»¤çš„èŒƒå›´ä¸åŒ,é’ˆå¯¹åŒä¸€ä¸ªèµ„æºæ¥è¯´,è¿‡æ»¤å™¨é“¾ä¸­çš„è¿‡æ»¤å™¨ä¸ªæ•°å¯èƒ½æ˜¯ä¸åŒçš„
+ å¦‚æœæŸä¸ªFilteræ˜¯ä½¿ç”¨ServletNameè¿›è¡ŒåŒ¹é…è§„åˆ™çš„é…ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªFilteræ‰§è¡Œçš„ä¼˜å…ˆçº§è¦æ›´ä½

> å›¾è§£è¿‡æ»¤å™¨é“¾

![1682556566084](images/1682556566084.png)

> è¿‡æ»¤å™¨é“¾åŠŸèƒ½æµ‹è¯•

+ å®šä¹‰ä¸‰ä¸ªè¿‡æ»¤å™¨,å¯¹ç›®æ ‡èµ„æºServletçš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤

+ ç›®æ ‡Servletèµ„æºä»£ç 

``` java
package com.atguigu.servlet;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

@WebServlet("/servletC")
public class ServletC extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("servletC service method  invoked");
    }
}

```



+ ä¸‰ä¸ªè¿‡æ»¤å™¨ä»£ç 

``` java
public class Filter1  implements Filter {
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        System.out.println("filter1 before chain.doFilter code invoked");

        filterChain.doFilter(servletRequest,servletResponse);

        System.out.println("filter1 after  chain.doFilter code invoked");

    }
}


public class Filter2 implements Filter {
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        System.out.println("filter2 before chain.doFilter code invoked");

        filterChain.doFilter(servletRequest,servletResponse);

        System.out.println("filter2 after  chain.doFilter code invoked");

    }
}


public class Filter3 implements Filter {
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        System.out.println("filter3 before chain.doFilter code invoked");

        filterChain.doFilter(servletRequest,servletResponse);

        System.out.println("filter3 after  chain.doFilter code invoked");

    }
}
```

+ è¿‡æ»¤å™¨é…ç½®ä»£ç 

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"
         version="5.0">
    <filter>
        <filter-name>filter1</filter-name>
        <filter-class>com.atguigu.filters.Filter1</filter-class>
    </filter>

    <filter>
        <filter-name>filter2</filter-name>
        <filter-class>com.atguigu.filters.Filter2</filter-class>
    </filter>

    <filter>
        <filter-name>filter3</filter-name>
        <filter-class>com.atguigu.filters.Filter3</filter-class>
    </filter>

    <!--filter-mappingçš„é¡ºåºå†³å®šäº†è¿‡æ»¤å™¨çš„å·¥ä½œé¡ºåº-->
    <filter-mapping>
        <filter-name>filter1</filter-name>
        <url-pattern>/servletC</url-pattern>
    </filter-mapping>

    <filter-mapping>
        <filter-name>filter2</filter-name>
        <url-pattern>/servletC</url-pattern>
    </filter-mapping>

    <filter-mapping>
        <filter-name>filter3</filter-name>
        <url-pattern>/servletC</url-pattern>
    </filter-mapping>

</web-app>
```



> å·¥ä½œæµç¨‹å›¾è§£

![1682497251883](images/1682497251883.png)



## 2.5 æ³¨è§£æ–¹å¼é…ç½®è¿‡æ»¤å™¨

> @WebFilteræ³¨è§£çš„ä½¿ç”¨

+ æºç 

``` java
package jakarta.servlet.annotation;

import jakarta.servlet.DispatcherType;
import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface WebFilter {
    String description() default "";

    String displayName() default "";

    WebInitParam[] initParams() default {};

    String filterName() default "";

    String smallIcon() default "";

    String largeIcon() default "";

    String[] servletNames() default {};

    String[] value() default {};

    String[] urlPatterns() default {};

    DispatcherType[] dispatcherTypes() default {DispatcherType.REQUEST};

    boolean asyncSupported() default false;
}

```

+ ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„Filterçš„XMLé…ç½®

``` xml
<!--é…ç½®filter,å¹¶ä¸ºfilterèµ·åˆ«å-->
<filter>
    <filter-name>loggingFilter</filter-name>
    <filter-class>com.atguigu.filters.LoggingFilter</filter-class>
    <!--é…ç½®filterçš„åˆå§‹å‚æ•°-->
    <init-param>
        <param-name>dateTimePattern</param-name>
        <param-value>yyyy-MM-dd HH:mm:ss</param-value>
    </init-param>
</filter>
<!--ä¸ºåˆ«åå¯¹åº”çš„filteré…ç½®è¦è¿‡æ»¤çš„ç›®æ ‡èµ„æº-->
<filter-mapping>
    <filter-name>loggingFilter</filter-name>
    <!--é€šè¿‡æ˜ å°„è·¯å¾„ç¡®å®šè¿‡æ»¤èµ„æº-->
    <url-pattern>/servletA</url-pattern>
    <!--é€šè¿‡åç¼€åç¡®å®šè¿‡æ»¤èµ„æº-->
    <url-pattern>*.html</url-pattern>
    <!--é€šè¿‡servletåˆ«åç¡®å®šè¿‡æ»¤èµ„æº-->
    <servlet-name>servletBName</servlet-name>
</filter-mapping>
```

+ å°†xmlé…ç½®è½¬æ¢æˆæ³¨è§£æ–¹å¼å®ç°

``` java
package com.atguigu.filters;


import jakarta.servlet.*;
import jakarta.servlet.annotation.WebFilter;
import jakarta.servlet.annotation.WebInitParam;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;



@WebFilter(
        filterName = "loggingFilter",
        initParams = {@WebInitParam(name="dateTimePattern",value="yyyy-MM-dd HH:mm:ss")},
        urlPatterns = {"/servletA","*.html"},
        servletNames = {"servletBName"}
)
public class LoggingFilter  implements Filter {
    private SimpleDateFormat dateFormat ;

    /*initåˆå§‹åŒ–æ–¹æ³•,é€šè¿‡filterConfigè·å–åˆå§‹åŒ–å‚æ•°
    * initæ–¹æ³•ä¸­,å¯ä»¥ç”¨äºå®šä¹‰ä¸€äº›å…¶ä»–åˆå§‹åŒ–åŠŸèƒ½ä»£ç 
    * */
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // è·å–åˆå§‹å‚æ•°
        String dateTimePattern = filterConfig.getInitParameter("dateTimePattern");
        // åˆå§‹åŒ–æˆå‘˜å˜é‡
        dateFormat=new SimpleDateFormat(dateTimePattern);
    }
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        // å‚æ•°çˆ¶è½¬å­
        HttpServletRequest request =(HttpServletRequest)  servletRequest;
        HttpServletResponse  response =(HttpServletResponse)  servletResponse;
        // æ‹¼æ¥æ—¥å¿—æ–‡æœ¬
        String requestURI = request.getRequestURI();
        String time = dateFormat.format(new Date());
        String beforeLogging =requestURI+"åœ¨"+time+"è¢«è¯·æ±‚äº†";
        // æ‰“å°æ—¥å¿—
        System.out.println(beforeLogging);
        // è·å–ç³»ç»Ÿæ—¶é—´
        long t1 = System.currentTimeMillis();
        // æ”¾è¡Œè¯·æ±‚
        filterChain.doFilter(request,response);
        // è·å–ç³»ç»Ÿæ—¶é—´
        long t2 = System.currentTimeMillis();
        String afterLogging =requestURI+"åœ¨"+time+"çš„è¯·æ±‚è€—æ—¶:"+(t2-t1)+"æ¯«ç§’";
        // æ‰“å°æ—¥å¿—
        System.out.println(afterLogging);

    }
}
```



# ä¸‰ ç›‘å¬å™¨

## 3.1 ç›‘å¬å™¨æ¦‚è¿°

> ç›‘å¬å™¨ï¼šä¸“é—¨ç”¨äºå¯¹åŸŸå¯¹è±¡å¯¹è±¡èº«ä¸Šå‘ç”Ÿçš„äº‹ä»¶æˆ–çŠ¶æ€æ”¹å˜è¿›è¡Œç›‘å¬å’Œç›¸åº”å¤„ç†çš„å¯¹è±¡

+ ç›‘å¬å™¨æ˜¯GOFè®¾è®¡æ¨¡å¼ä¸­,è§‚å¯Ÿè€…æ¨¡å¼çš„å…¸å‹æ¡ˆä¾‹
+ è§‚å¯Ÿè€…æ¨¡å¼: å½“è¢«è§‚å¯Ÿçš„å¯¹è±¡å‘ç”ŸæŸäº›æ”¹å˜æ—¶, è§‚å¯Ÿè€…è‡ªåŠ¨é‡‡å–å¯¹åº”çš„è¡ŒåŠ¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼

+ ç›‘å¬å™¨ä½¿ç”¨çš„æ„Ÿå—ç±»ä¼¼JSä¸­çš„äº‹ä»¶,è¢«è§‚å¯Ÿçš„å¯¹è±¡å‘ç”ŸæŸäº›æƒ…å†µæ—¶,è‡ªåŠ¨è§¦å‘ä»£ç çš„æ‰§è¡Œ
+ ç›‘å¬å™¨å¹¶ä¸ç›‘å¬webé¡¹ç›®ä¸­çš„æ‰€æœ‰ç»„ä»¶,ä»…ä»…æ˜¯å¯¹ä¸‰å¤§åŸŸå¯¹è±¡åšç›¸å…³çš„äº‹ä»¶ç›‘å¬

> ç›‘å¬å™¨çš„åˆ†ç±»

+ webä¸­å®šä¹‰å…«ä¸ªç›‘å¬å™¨æ¥å£ä½œä¸ºç›‘å¬å™¨çš„è§„èŒƒ,è¿™å…«ä¸ªæ¥å£æŒ‰ç…§ä¸åŒçš„æ ‡å‡†å¯ä»¥å½¢æˆä¸åŒçš„åˆ†ç±»

+ æŒ‰ç›‘å¬çš„å¯¹è±¡åˆ’åˆ†
    + applicationåŸŸç›‘å¬å™¨ ServletContextListener  ServletContextAttributeListener 
    + sessionåŸŸç›‘å¬å™¨ HttpSessionListener  HttpSessionAttributeListener  HttpSessionBindingListener  HttpSessionActivationListener  
    + requeståŸŸç›‘å¬å™¨ ServletRequestListener  ServletRequestAttributeListener 
+ æŒ‰ç›‘å¬çš„äº‹ä»¶åˆ†
    + åŸŸå¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ç›‘å¬å™¨ ServletContextListener   HttpSessionListener   ServletRequestListener  
    + åŸŸå¯¹è±¡æ•°æ®å¢åˆ æ”¹äº‹ä»¶ç›‘å¬å™¨ ServletContextAttributeListener  HttpSessionAttributeListener   ServletRequestAttributeListener 
    + å…¶ä»–ç›‘å¬å™¨  HttpSessionBindingListener  HttpSessionActivationListener  

## 3.2 ç›‘å¬å™¨çš„å…­ä¸ªä¸»è¦æ¥å£

### 3.2.1 applicationåŸŸç›‘å¬å™¨

> ServletContextListener  ç›‘å¬ServletContextå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯

| æ–¹æ³•å                                      | ä½œç”¨                     |
| ------------------------------------------- | ------------------------ |
| contextInitialized(ServletContextEvent sce) | ServletContextåˆ›å»ºæ—¶è°ƒç”¨ |
| contextDestroyed(ServletContextEvent sce)   | ServletContexté”€æ¯æ—¶è°ƒç”¨ |

+ ServletContextEventå¯¹è±¡ä»£è¡¨ä»ServletContextå¯¹è±¡èº«ä¸Šæ•è·åˆ°çš„äº‹ä»¶ï¼Œé€šè¿‡è¿™ä¸ªäº‹ä»¶å¯¹è±¡æˆ‘ä»¬å¯ä»¥è·å–åˆ°ServletContextå¯¹è±¡ã€‚

> ServletContextAttributeListener ç›‘å¬ServletContextä¸­å±æ€§çš„æ·»åŠ ã€ç§»é™¤å’Œä¿®æ”¹

| æ–¹æ³•å                                               | ä½œç”¨                                 |
| ---------------------------------------------------- | ------------------------------------ |
| attributeAdded(ServletContextAttributeEvent scab)    | å‘ServletContextä¸­æ·»åŠ å±æ€§æ—¶è°ƒç”¨     |
| attributeRemoved(ServletContextAttributeEvent scab)  | ä»ServletContextä¸­ç§»é™¤å±æ€§æ—¶è°ƒç”¨     |
| attributeReplaced(ServletContextAttributeEvent scab) | å½“ServletContextä¸­çš„å±æ€§è¢«ä¿®æ”¹æ—¶è°ƒç”¨ |

+ ServletContextAttributeEventå¯¹è±¡ä»£è¡¨å±æ€§å˜åŒ–äº‹ä»¶ï¼Œå®ƒåŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•å              | ä½œç”¨                     |
| ------------------- | ------------------------ |
| getName()           | è·å–ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å   |
| getValue()          | è·å–è¢«ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å€¼ |
| getServletContext() | è·å–ServletContextå¯¹è±¡   |

> æµ‹è¯•ä»£ç 

+ å®šä¹‰ç›‘å¬å™¨

``` java
package com.atguigu.listeners;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebListener;


@WebListener
public class ApplicationListener implements ServletContextListener , ServletContextAttributeListener {
    // ç›‘å¬åˆå§‹åŒ–
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext application = sce.getServletContext();
        System.out.println("application"+application.hashCode()+" initialized");
    }
    // ç›‘å¬é”€æ¯
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        ServletContext application = sce.getServletContext();
        System.out.println("application"+application.hashCode()+" destroyed");
    }

    // ç›‘å¬æ•°æ®å¢åŠ 
    @Override
    public void attributeAdded(ServletContextAttributeEvent scae) {
        String name = scae.getName();
        Object value = scae.getValue();
        ServletContext application = scae.getServletContext();
        System.out.println("application"+application.hashCode()+" add:"+name+"="+value);
    }

    // ç›‘å¬æ•°æ®ç§»é™¤
    @Override
    public void attributeRemoved(ServletContextAttributeEvent scae) {
        String name = scae.getName();
        Object value = scae.getValue();
        ServletContext application = scae.getServletContext();
        System.out.println("application"+application.hashCode()+" remove:"+name+"="+value);
    }
    // ç›‘å¬æ•°æ®ä¿®æ”¹
    @Override
    public void attributeReplaced(ServletContextAttributeEvent scae) {
        String name = scae.getName();
        Object value = scae.getValue();
        ServletContext application = scae.getServletContext();
        Object newValue = application.getAttribute(name);
        System.out.println("application"+application.hashCode()+" change:"+name+"="+value+" to "+newValue);
    }


}

```

+ å®šä¹‰è§¦å‘ç›‘å¬å™¨çš„ä»£ç 

``` java
// ServletAç”¨äºå‘applicationåŸŸä¸­æ”¾å…¥æ•°æ®
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å‘applicationåŸŸä¸­æ”¾å…¥æ•°æ®
        ServletContext application = this.getServletContext();
        application.setAttribute("k1","v1");
        application.setAttribute("k2","v2");
    }
}


// ServletBç”¨äºå‘applicationåŸŸä¸­ä¿®æ”¹å’Œç§»é™¤æ•°æ®
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext appliation  = getServletContext();
        //  ä¿®æ”¹applicationåŸŸä¸­çš„æ•°æ®
        appliation.setAttribute("k1","value1");
        //  åˆ é™¤applicationåŸŸä¸­çš„æ•°æ®
        appliation.removeAttribute("k2");
    }
}
```

### 3.2.2 sessionåŸŸç›‘å¬å™¨

> HttpSessionListener  ç›‘å¬HttpSessionå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯

| æ–¹æ³•å                                 | ä½œç”¨                      |
| -------------------------------------- | ------------------------- |
| sessionCreated(HttpSessionEvent hse)   | HttpSessionå¯¹è±¡åˆ›å»ºæ—¶è°ƒç”¨ |
| sessionDestroyed(HttpSessionEvent hse) | HttpSessionå¯¹è±¡é”€æ¯æ—¶è°ƒç”¨ |

+ HttpSessionEventå¯¹è±¡ä»£è¡¨ä»HttpSessionå¯¹è±¡èº«ä¸Šæ•è·åˆ°çš„äº‹ä»¶ï¼Œé€šè¿‡è¿™ä¸ªäº‹ä»¶å¯¹è±¡æˆ‘ä»¬å¯ä»¥è·å–åˆ°è§¦å‘äº‹ä»¶çš„HttpSessionå¯¹è±¡ã€‚

> HttpSessionAttributeListener ç›‘å¬HttpSessionä¸­å±æ€§çš„æ·»åŠ ã€ç§»é™¤å’Œä¿®æ”¹

| æ–¹æ³•å                                        | ä½œç”¨                              |
| --------------------------------------------- | --------------------------------- |
| attributeAdded(HttpSessionBindingEvent se)    | å‘HttpSessionä¸­æ·»åŠ å±æ€§æ—¶è°ƒç”¨     |
| attributeRemoved(HttpSessionBindingEvent se)  | ä»HttpSessionä¸­ç§»é™¤å±æ€§æ—¶è°ƒç”¨     |
| attributeReplaced(HttpSessionBindingEvent se) | å½“HttpSessionä¸­çš„å±æ€§è¢«ä¿®æ”¹æ—¶è°ƒç”¨ |

+ HttpSessionBindingEventå¯¹è±¡ä»£è¡¨å±æ€§å˜åŒ–äº‹ä»¶ï¼Œå®ƒåŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•å       | ä½œç”¨                          |
| ------------ | ----------------------------- |
| getName()    | è·å–ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å        |
| getValue()   | è·å–è¢«ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å€¼      |
| getSession() | è·å–è§¦å‘äº‹ä»¶çš„HttpSessionå¯¹è±¡ |

> æµ‹è¯•ä»£ç 

+ å®šä¹‰ç›‘å¬å™¨

``` java
package com.atguigu.listeners;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebListener;
import jakarta.servlet.http.*;


@WebListener
public class SessionListener implements HttpSessionListener, HttpSessionAttributeListener {
    // ç›‘å¬sessionåˆ›å»º
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("session"+session.hashCode()+" created");
    }

    // ç›‘å¬sessioné”€æ¯
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("session"+session.hashCode()+" destroyed");
    }
    // ç›‘å¬æ•°æ®å¢åŠ 
    @Override
    public void attributeAdded(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object value = se.getValue();
        HttpSession session = se.getSession();
        System.out.println("session"+session.hashCode()+" add:"+name+"="+value);
    }
    // ç›‘å¬æ•°æ®ç§»é™¤
    @Override
    public void attributeRemoved(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object value = se.getValue();
        HttpSession session = se.getSession();
        System.out.println("session"+session.hashCode()+" remove:"+name+"="+value);
    }
    // ç›‘å¬æ•°æ®ä¿®æ”¹
    @Override
    public void attributeReplaced(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object value = se.getValue();
        HttpSession session = se.getSession();
        Object newValue = session.getAttribute(name);
        System.out.println("session"+session.hashCode()+" change:"+name+"="+value+" to "+newValue);
    }

}
```

+ å®šä¹‰è§¦å‘ç›‘å¬å™¨çš„ä»£ç 

``` java
// servletAç”¨äºåˆ›å»ºsessionå¹¶å‘sessionä¸­æ”¾æ•°æ®
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // åˆ›å»ºsession,å¹¶å‘sessionä¸­æ”¾å…¥æ•°æ®
        HttpSession session = req.getSession();

        session.setAttribute("k1","v1");
        session.setAttribute("k2","v2");
    }
}


// servletBç”¨äºä¿®æ”¹åˆ é™¤sessionä¸­çš„æ•°æ®å¹¶æ‰‹åŠ¨è®©sessionä¸å¯ç”¨
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        //  ä¿®æ”¹sessionåŸŸä¸­çš„æ•°æ®
        session.setAttribute("k1","value1");
        //  åˆ é™¤sessionåŸŸä¸­çš„æ•°æ®
        session.removeAttribute("k2");
        // æ‰‹åŠ¨è®©sessionä¸å¯ç”¨
        session.invalidate();
    }
}
```

### 3.2.3 requeståŸŸç›‘å¬å™¨

> ServletRequestListener ç›‘å¬ServletRequestå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯

| æ–¹æ³•å                                      | ä½œç”¨                         |
| ------------------------------------------- | ---------------------------- |
| requestInitialized(ServletRequestEvent sre) | ServletRequestå¯¹è±¡åˆ›å»ºæ—¶è°ƒç”¨ |
| requestDestroyed(ServletRequestEvent sre)   | ServletRequestå¯¹è±¡é”€æ¯æ—¶è°ƒç”¨ |

+ ServletRequestEventå¯¹è±¡ä»£è¡¨ä»HttpServletRequestå¯¹è±¡èº«ä¸Šæ•è·åˆ°çš„äº‹ä»¶ï¼Œé€šè¿‡è¿™ä¸ªäº‹ä»¶å¯¹è±¡æˆ‘ä»¬å¯ä»¥è·å–åˆ°è§¦å‘äº‹ä»¶çš„HttpServletRequestå¯¹è±¡ã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°å½“å‰Webåº”ç”¨çš„ServletContextå¯¹è±¡ã€‚

> ServletRequestAttributeListener ç›‘å¬ServletRequestä¸­å±æ€§çš„æ·»åŠ ã€ç§»é™¤å’Œä¿®æ”¹

| æ–¹æ³•å                                               | ä½œç”¨                                 |
| ---------------------------------------------------- | ------------------------------------ |
| attributeAdded(ServletRequestAttributeEvent srae)    | å‘ServletRequestä¸­æ·»åŠ å±æ€§æ—¶è°ƒç”¨     |
| attributeRemoved(ServletRequestAttributeEvent srae)  | ä»ServletRequestä¸­ç§»é™¤å±æ€§æ—¶è°ƒç”¨     |
| attributeReplaced(ServletRequestAttributeEvent srae) | å½“ServletRequestä¸­çš„å±æ€§è¢«ä¿®æ”¹æ—¶è°ƒç”¨ |

+ ServletRequestAttributeEventå¯¹è±¡ä»£è¡¨å±æ€§å˜åŒ–äº‹ä»¶ï¼Œå®ƒåŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•å               | ä½œç”¨                             |
| -------------------- | -------------------------------- |
| getName()            | è·å–ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å           |
| getValue()           | è·å–è¢«ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å€¼         |
| getServletRequest () | è·å–è§¦å‘äº‹ä»¶çš„ServletRequestå¯¹è±¡ |

+ å®šä¹‰ç›‘å¬å™¨

``` java
package com.atguigu.listeners;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebListener;


@WebListener
public class RequestListener implements ServletRequestListener , ServletRequestAttributeListener {
    // ç›‘å¬åˆå§‹åŒ–
    @Override
    public void requestInitialized(ServletRequestEvent sre) {
        ServletRequest request = sre.getServletRequest();
        System.out.println("request"+request.hashCode()+" initialized");
    }

    // ç›‘å¬é”€æ¯
    @Override
    public void requestDestroyed(ServletRequestEvent sre) {
        ServletRequest request = sre.getServletRequest();
        System.out.println("request"+request.hashCode()+" destoryed");
    }


    // ç›‘å¬æ•°æ®å¢åŠ 
    @Override
    public void attributeAdded(ServletRequestAttributeEvent srae) {
        String name = srae.getName();
        Object value = srae.getValue();
        ServletRequest request = srae.getServletRequest();
        System.out.println("request"+request.hashCode()+" add:"+name+"="+value);
    }

    //  ç›‘å¬æ•°æ®ç§»é™¤
    @Override
    public void attributeRemoved(ServletRequestAttributeEvent srae) {
        String name = srae.getName();
        Object value = srae.getValue();
        ServletRequest request = srae.getServletRequest();
        System.out.println("request"+request.hashCode()+" remove:"+name+"="+value);
    }
    // ç›‘å¬æ•°æ®ä¿®æ”¹
    @Override
    public void attributeReplaced(ServletRequestAttributeEvent srae) {
        String name = srae.getName();
        Object value = srae.getValue();
        ServletRequest request = srae.getServletRequest();
        Object newValue = request.getAttribute(name);
        System.out.println("request"+request.hashCode()+" change:"+name+"="+value+" to "+newValue);
    }
}
```

+ å®šä¹‰è§¦å‘ç›‘å¬å™¨çš„ä»£ç 

``` java
//  servletAå‘è¯·æ±‚åŸŸä¸­æ”¾æ•°æ®
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å‘requestä¸­å¢åŠ æ•°æ®
        req.setAttribute("k1","v1");
        req.setAttribute("k2","v2");
        // è¯·æ±‚è½¬å‘
        req.getRequestDispatcher("servletB").forward(req,resp);
    }
}

// servletBä¿®æ”¹åˆ é™¤åŸŸä¸­çš„æ•°æ®
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //  ä¿®æ”¹requeståŸŸä¸­çš„æ•°æ®
        req.setAttribute("k1","value1");
        //  åˆ é™¤sessionåŸŸä¸­çš„æ•°æ®
        req.removeAttribute("k2");

    }
}
```

## 3.3 sessionåŸŸçš„ä¸¤ä¸ªç‰¹æ®Šç›‘å¬å™¨

### 3.3.3  sessionç»‘å®šç›‘å¬å™¨

> HttpSessionBindingListener ç›‘å¬å½“å‰ç›‘å¬å™¨å¯¹è±¡åœ¨SessionåŸŸä¸­çš„å¢åŠ ä¸ç§»é™¤

| æ–¹æ³•å                                      | ä½œç”¨                              |
| ------------------------------------------- | --------------------------------- |
| valueBound(HttpSessionBindingEvent event)   | è¯¥ç±»çš„å®ä¾‹è¢«æ”¾åˆ°SessionåŸŸä¸­æ—¶è°ƒç”¨ |
| valueUnbound(HttpSessionBindingEvent event) | è¯¥ç±»çš„å®ä¾‹ä»Sessionä¸­ç§»é™¤æ—¶è°ƒç”¨   |

+ HttpSessionBindingEventå¯¹è±¡ä»£è¡¨å±æ€§å˜åŒ–äº‹ä»¶ï¼Œå®ƒåŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•å       | ä½œç”¨                          |
| ------------ | ----------------------------- |
| getName()    | è·å–å½“å‰äº‹ä»¶æ¶‰åŠçš„å±æ€§å      |
| getValue()   | è·å–å½“å‰äº‹ä»¶æ¶‰åŠçš„å±æ€§å€¼      |
| getSession() | è·å–è§¦å‘äº‹ä»¶çš„HttpSessionå¯¹è±¡ |

> æµ‹è¯•ä»£ç 

+ å®šä¹‰ç›‘å¬å™¨

``` java
package com.atguigu.listeners;

import jakarta.servlet.http.HttpSession;
import jakarta.servlet.http.HttpSessionBindingEvent;
import jakarta.servlet.http.HttpSessionBindingListener;

public class MySessionBindingListener  implements HttpSessionBindingListener {
    //  ç›‘å¬ç»‘å®š
    @Override
    public void valueBound(HttpSessionBindingEvent event) {
        HttpSession session = event.getSession();
        String name = event.getName();
        System.out.println("MySessionBindingListener"+this.hashCode()+" binding into session"+session.hashCode()+" with name "+name);
    }

    // ç›‘å¬è§£é™¤ç»‘å®š
    @Override
    public void valueUnbound(HttpSessionBindingEvent event) {
        HttpSession session = event.getSession();
        String name = event.getName();
        System.out.println("MySessionBindingListener"+this.hashCode()+" unbond outof session"+session.hashCode()+" with name "+name);
    }
}
```

+ å®šä¹‰è§¦å‘ç›‘å¬å™¨çš„ä»£ç 

``` java

@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        // ç»‘å®šç›‘å¬å™¨
        session.setAttribute("bindingListener",new MySessionBindingListener());
        // è§£é™¤ç»‘å®šç›‘å¬å™¨
        session.removeAttribute("bindingListener");
    }
}
```

### 3.3.4 é’åŒ–æ´»åŒ–ç›‘å¬å™¨

> HttpSessionActivationListener  ç›‘å¬æŸä¸ªå¯¹è±¡åœ¨Sessionä¸­çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚

| æ–¹æ³•å                                    | ä½œç”¨                                  |
| ----------------------------------------- | ------------------------------------- |
| sessionWillPassivate(HttpSessionEvent se) | è¯¥ç±»å®ä¾‹å’ŒSessionä¸€èµ·é’åŒ–åˆ°ç¡¬ç›˜æ—¶è°ƒç”¨ |
| sessionDidActivate(HttpSessionEvent se)   | è¯¥ç±»å®ä¾‹å’ŒSessionä¸€èµ·æ´»åŒ–åˆ°å†…å­˜æ—¶è°ƒç”¨ |

+ HttpSessionEventå¯¹è±¡ä»£è¡¨äº‹ä»¶å¯¹è±¡ï¼Œé€šè¿‡getSession()æ–¹æ³•è·å–äº‹ä»¶æ¶‰åŠçš„HttpSessionå¯¹è±¡ã€‚

> ä»€ä¹ˆæ˜¯é’åŒ–æ´»åŒ–

+ sessionå¯¹è±¡åœ¨æœåŠ¡ç«¯æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼å­˜å‚¨äºå†…å­˜çš„,sessionè¿‡å¤š,æœåŠ¡å™¨çš„å†…å­˜ä¹Ÿæ˜¯åƒä¸æ¶ˆçš„
+ è€Œä¸”ä¸€æ—¦æœåŠ¡å™¨å‘ç”Ÿé‡å¯,æ‰€æœ‰çš„sessionå¯¹è±¡éƒ½å°†è¢«æ¸…é™¤,ä¹Ÿå°±æ„å‘³ç€sessionä¸­å­˜å‚¨çš„ä¸åŒå®¢æˆ·ç«¯çš„ç™»å½•çŠ¶æ€ä¸¢å¤±
+ ä¸ºäº†åˆ†æ‘Šå†…å­˜ å‹åŠ›å¹¶ä¸”ä¸ºäº†ä¿è¯sessioné‡å¯ä¸ä¸¢å¤±,æˆ‘ä»¬å¯ä»¥è®¾ç½®å°†sessionè¿›è¡Œé’åŒ–å¤„ç†
+ åœ¨å…³é—­æœåŠ¡å™¨å‰æˆ–è€…åˆ°è¾¾äº†è®¾å®šæ—¶é—´æ—¶,å¯¹sessionè¿›è¡Œåºåˆ—åŒ–åˆ°ç£ç›˜,è¿™ç§æƒ…å†µå«åšsessionçš„é’åŒ–
+ åœ¨æœåŠ¡å™¨å¯åŠ¨åæˆ–è€…å†æ¬¡è·å–æŸä¸ªsessionæ—¶,å°†ç£ç›˜ä¸Šçš„sessionè¿›è¡Œååºåˆ—åŒ–åˆ°å†…å­˜,è¿™ç§æƒ…å†µå«åšsessionçš„æ´»åŒ–


> å¦‚ä½•é…ç½®é’åŒ–æ´»åŒ–

+ åœ¨webç›®å½•ä¸‹,æ·»åŠ  META-INFä¸‹åˆ›å»ºContext.xml

![1682565824241](images/1682565824241.png)

+ æ–‡ä»¶ä¸­é…ç½®é’åŒ–

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<Context>
    <Manager className="org.apache.catalina.session.PersistentManager" maxIdleSwap="1">
        <Store className="org.apache.catalina.session.FileStore" directory="d:\mysession"></Store>
    </Manager>
</Context>
```

+  è¯·æ±‚servletA,è·å¾—session,å¹¶å­˜å…¥æ•°æ®,ç„¶åé‡å¯æœåŠ¡å™¨

``` java
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        // æ·»åŠ æ•°æ®
        session.setAttribute("k1","v1");
    }
}
```

+ è¯·æ±‚servletBè·å–session,è·å–é‡å¯å‰å­˜å…¥çš„æ•°æ®

``` java
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        Object v1 = session.getAttribute("k1");
        System.out.println(v1);

    }
}
```

> å¦‚ä½•ç›‘å¬é’åŒ–æ´»åŒ–

+ å®šä¹‰ç›‘å¬å™¨

``` java
package com.atguigu.listeners;

import jakarta.servlet.http.HttpSession;
import jakarta.servlet.http.HttpSessionActivationListener;
import jakarta.servlet.http.HttpSessionEvent;

import java.io.Serializable;

public class ActivationListener  implements HttpSessionActivationListener, Serializable {
    //  ç›‘å¬é’åŒ–
    @Override
    public void sessionWillPassivate(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("session with JSESSIONID "+ session.getId()+" will passivate");
    }

    //  ç›‘å¬æ´»åŒ–
    @Override
    public void sessionDidActivate(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("session with JSESSIONID "+ session.getId()+" did activate");
    }
}

```

+ å®šä¹‰è§¦å‘ç›‘å¬å™¨çš„ä»£ç 

``` java
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        // æ·»åŠ æ•°æ®
        session.setAttribute("k1","v1");
        // æ·»åŠ é’åŒ–æ´»åŒ–ç›‘å¬å™¨
        session.setAttribute("activationListener",new ActivationListener());
    }
}
```



# å›› æ¡ˆä¾‹å¼€å‘-æ—¥ç¨‹ç®¡ç†-ç¬¬ä¸‰æœŸ

##  4.1 è¿‡æ»¤å™¨æ§åˆ¶ç™»å½•æ ¡éªŒ

> éœ€æ±‚è¯´æ˜:æœªç™»å½•çŠ¶æ€ä¸‹ä¸å…è®¸è®¿é—®showShedule.htmlå’ŒSysScheduleControllerç›¸å…³å¢åˆ æ”¹å¤„ç†,é‡å®šå‘åˆ°login.html,ç™»å½•æˆåŠŸåå¯ä»¥è‡ªç”±è®¿é—®

+ å¼€å‘ç™»å½•è¿‡æ»¤å™¨,å¯¹æŒ‡å®šèµ„æºçš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤

``` java
package com.atguigu.schedule.filters;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebFilter;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;

import java.io.IOException;

@WebFilter(urlPatterns = {"/showSchedule.html","/schedule/*"})
public class LoginFilter  implements Filter {
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest request =(HttpServletRequest) servletRequest;
        HttpServletResponse response =(HttpServletResponse) servletResponse;
        HttpSession session = request.getSession();
        Object sysUser = session.getAttribute("sysUser");
        if(null != sysUser){
            // sessionä¸­å¦‚æœå­˜åœ¨ç™»å½•çš„ç”¨æˆ· ä»£è¡¨ç”¨æˆ·ç™»å½•è¿‡,åˆ™æ”¾è¡Œ
            filterChain.doFilter(servletRequest,servletResponse);

        }else{
            //ç”¨æˆ·æœªç™»å½•,é‡å®šå‘åˆ°ç™»å½•é¡µ
            response.sendRedirect("/login.html");
        }
    }
}

```

+ ä¿®æ”¹ç”¨æˆ·ç™»å½•è¯·æ±‚çš„loginæ–¹æ³•,ç™»å½•æˆåŠŸæ—¶,å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥session

``` java
 /**
     * ç”¨æˆ·ç™»å½•çš„ä¸šåŠ¡æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void login(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // æ¥æ”¶ç”¨æˆ·è¯·æ±‚å‚æ•°
        // è·å–è¦æ³¨å†Œçš„ç”¨æˆ·åå¯†ç 
        String username = req.getParameter("username");
        String userPwd = req.getParameter("userPwd");
        // è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªç”¨æˆ·
        SysUser loginUser =userService.findByUsername(username);
        if(null == loginUser){
            // æ²¡æœ‰æ ¹æ®ç”¨æˆ·åæ‰¾åˆ°ç”¨æˆ·,è¯´æ˜ç”¨æˆ·åæœ‰è¯¯
            resp.sendRedirect("/loginUsernameError.html");
        }else if(! loginUser.getUserPwd().equals(MD5Util.encrypt(userPwd))){
            // ç”¨æˆ·å¯†ç æœ‰è¯¯,
            resp.sendRedirect("/loginUserPwdError.html");
        }else{
            // ç™»å½•æˆåŠŸ,å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥session
            req.getSession().setAttribute("sysUser",loginUser);
            // ç™»å½•æˆåŠŸ,é‡å®šå‘åˆ°æ—¥ç¨‹å±•ç¤ºé¡µ
            resp.sendRedirect("/showSchedule.html");
        }
    }
```





# äº” Ajax

## 4.1 ä»€ä¹ˆæ˜¯ajax

+ AJAX = Asynchronous JavaScript and XMLï¼ˆå¼‚æ­¥çš„ JavaScript å’Œ XMLï¼‰ã€‚

+ AJAX ä¸æ˜¯æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§ä½¿ç”¨ç°æœ‰æ ‡å‡†çš„æ–°æ–¹æ³•ã€‚

+ AJAX æœ€å¤§çš„ä¼˜ç‚¹æ˜¯åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®å¹¶æ›´æ–°éƒ¨åˆ†ç½‘é¡µå†…å®¹ã€‚

+ AJAX ä¸éœ€è¦ä»»ä½•æµè§ˆå™¨æ’ä»¶ï¼Œä½†éœ€è¦ç”¨æˆ·å…è®¸ JavaScript åœ¨æµè§ˆå™¨ä¸Šæ‰§è¡Œã€‚

+ XMLHttpRequest åªæ˜¯å®ç° Ajax çš„ä¸€ç§æ–¹å¼ã€‚

**ajaxå·¥ä½œåŸç†ï¼š**

![](images/image_bjXPJoLb6a-1690508517199.png)

+ ç®€å•æ¥è¯´,æˆ‘ä»¬ä¹‹å‰å‘çš„è¯·æ±‚é€šè¿‡ç±»ä¼¼  formè¡¨å•æ ‡ç­¾,aæ ‡ç­¾ è¿™ç§æ–¹å¼,ç°åœ¨é€šè¿‡ è¿è¡Œjsä»£ç åŠ¨æ€å†³å®šä»€ä¹ˆæ—¶å€™å‘é€ä»€ä¹ˆæ ·çš„è¯·æ±‚
+ é€šè¿‡è¿è¡ŒJSä»£ç å‘é€çš„è¯·æ±‚æµè§ˆå™¨å¯ä»¥ä¸ç”¨è·³è½¬é¡µé¢ ,æˆ‘ä»¬å¯ä»¥åœ¨JSä»£ç ä¸­å†³å®šæ˜¯å¦è¦è·³è½¬é¡µé¢
+ é€šè¿‡è¿è¡ŒJSä»£ç å‘é€çš„è¯·æ±‚,æ¥æ”¶åˆ°è¿”å›ç»“æœå,æˆ‘ä»¬å¯ä»¥å°†ç»“æœé€šè¿‡domç¼–ç¨‹æ¸²æŸ“åˆ°é¡µé¢çš„æŸäº›å…ƒç´ ä¸Š,å®ç°å±€éƒ¨æ›´æ–°

## 4.2 å¦‚ä½•å®ç°ajaxè¯·æ±‚

> åŸç”Ÿ**javascriptæ–¹å¼è¿›è¡Œajax(äº†è§£):**

``` html
<script>
  function loadXMLDoc(){
    var xmlhttp=new XMLHttpRequest();
      // è®¾ç½®å›è°ƒå‡½æ•°å¤„ç†å“åº”ç»“æœ
    xmlhttp.onreadystatechange=function(){
      if (xmlhttp.readyState==4 && xmlhttp.status==200)
      {
        document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
      }
    }
      // è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚çš„èµ„æºè·¯å¾„
    xmlhttp.open("GET","/try/ajax/ajax_info.txt",true);
      // å‘é€è¯·æ±‚
    xmlhttp.send();
  }
</script> 
```



# å…­ æ¡ˆä¾‹å¼€å‘-æ—¥ç¨‹ç®¡ç†-ç¬¬å››æœŸ

## 6.1 æ³¨å†Œæäº¤å‰æ ¡éªŒç”¨æˆ·åæ˜¯å¦å ç”¨åŠŸèƒ½

>  å®¢æˆ·ç«¯ä»£ç ç¼–å†™å¤„ç†

+ regist.htmlé¡µé¢ä»£ç 

``` html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        .ht{
            text-align: center;
            color: cadetblue;
            font-family: å¹¼åœ†;
        }
        .tab{
            width: 500px;
            border: 5px solid cadetblue;
            margin: 0px auto;
            border-radius: 5px;
            font-family: å¹¼åœ†;
        }
        .ltr td{
            border: 1px solid  powderblue;

        }
        .ipt{
            border: 0px;
            width: 50%;

        }
        .btn1{
            border: 2px solid powderblue;
            border-radius: 4px;
            width:60px;
            background-color: antiquewhite;

        }

        .msg {
            color: gold;
        }

        .buttonContainer{
            text-align: center;
        }
    </style>

    <script>

        // æ ¡éªŒç”¨æˆ·åçš„æ–¹æ³•
        function checkUsername(){
            // å®šä¹‰æ­£åˆ™
            var usernameReg=/^[a-zA-Z0-9]{5,10}$/
            var username =document.getElementById("usernameInput").value
            var usernameMsgSpan =document.getElementById("usernameMsg")
            if(!usernameReg.test(username)){
                usernameMsgSpan.innerText="ä¸åˆæ³•"
                return false
            }
            // å‘é€ajaxè¯·æ±‚æ ¡éªŒç”¨æˆ·åæ˜¯å¦è¢«å ç”¨
            var request;
            if(window.XMLHttpRequest){
                request= new XMLHttpRequest();
            }else{
                request= new ActiveXObject("Microsoft.XMLHTTP");
            }
            request.onreadystatechange= function (){
                // request.readyState == 4 ä»£è¡¨è¯·æ±‚ç»“æŸ,å·²ç»æ¥æ”¶åˆ°å“åº”ç»“æœ
                // request.status== 200  è¡¨ç¤ºåç«¯å“åº”çŠ¶æ€ç æ˜¯200
                if(request.readyState == 4  && request.status== 200){
                    // åç«¯çš„å“åº”çš„JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºå‰ç«¯çš„å¯¹è±¡
                    var response =JSON.parse(request.responseText)
                    console.log(response)
                    //  åˆ¤æ–­ä¸šåŠ¡ç æ˜¯å¦æ˜¯200
                    if (response.code != 200){
                        usernameMsgSpan.innerText="å·²å ç”¨"
                        return false
                    }
                }
            }
            // è®¾ç½®è¯·æ±‚æ–¹å¼,è¯·æ±‚èµ„æºè·¯å¾„,æ˜¯å¦ä¸ºå¼‚æ­¥è¯·æ±‚
            request.open("GET",'/user/checkUsernameUsed?username='+username,true)
            // å‘é€è¯·æ±‚
            request.send();
            // å‰é¢æ ¡éªŒéƒ½é€šè¿‡
            // usernameMsgSpan.innerText="OK"
            // return true

        }


        // æ ¡éªŒå¯†ç çš„æ–¹æ³•
        function checkUserPwd(){
            // å®šä¹‰æ­£åˆ™
            var passwordReg=/^[0-9]{6}$/
            var userPwd =document.getElementById("userPwdInput").value
            var userPwdMsgSpan =document.getElementById("userPwdMsg")
            if(!passwordReg.test(userPwd)){
                userPwdMsgSpan.innerText="ä¸åˆæ³•"
                return false
            }
            userPwdMsgSpan.innerText="OK"
            return true
        }

        // æ ¡éªŒå¯†ç çš„æ–¹æ³•
        function checkReUserPwd(){
            // å®šä¹‰æ­£åˆ™
            var passwordReg=/^[0-9]{6}$/
            var userPwd =document.getElementById("userPwdInput").value
            var reUserPwd =document.getElementById("reUserPwdInput").value
            var reUserPwdMsgSpan =document.getElementById("reUserPwdMsg")
            if(!passwordReg.test(userPwd)){
                reUserPwdMsgSpan.innerText="ä¸åˆæ³•"
                return false
            }
            if(userPwd != reUserPwd){
                reUserPwdMsgSpan.innerText="ä¸ä¸€è‡´"
                return false

            }
            reUserPwdMsgSpan.innerText="OK"
            return true
        }

        //è¡¨å•æäº¤æ—¶ç»Ÿä¸€æ ¡éªŒ
        function checkForm(){
            return checkUsername() && checkUserPwd() && checkReUserPwd()
        }



    </script>
</head>
<body>
<h1 class="ht">æ¬¢è¿ä½¿ç”¨æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ</h1>
<h3 class="ht">è¯·æ³¨å†Œ</h3>
<form method="post" action="/user/regist" onsubmit="return checkForm()">
    <table class="tab" cellspacing="0px">
        <tr class="ltr">
            <td>è¯·è¾“å…¥è´¦å·</td>
            <td>
                <input class="ipt" id="usernameInput" type="text" name="username" onblur="checkUsername()">
                <span id="usernameMsg" class="msg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td>è¯·è¾“å…¥å¯†ç </td>
            <td>
                <input class="ipt" id="userPwdInput" type="password" name="userPwd" onblur="checkUserPwd()">
                <span id="userPwdMsg" class="msg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td>ç¡®è®¤å¯†ç </td>
            <td>
                <input class="ipt" id="reUserPwdInput" type="password" onblur="checkReUserPwd()">
                <span id="reUserPwdMsg" class="msg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td colspan="2" class="buttonContainer">
                <input class="btn1" type="submit" value="æ³¨å†Œ">
                <input class="btn1" type="reset" value="é‡ç½®">
                <button class="btn1"><a  href="/login.html">å»ç™»å½•</a></button>
            </td>
        </tr>
    </table>
</form>
</body>
</html>
```



>  æœåŠ¡ç«¯ä»£ç å¤„ç†

+ æ·»åŠ å…¬å…±çš„JSONæ•°æ®å“åº”æ ¼å¼ç±»

``` java
package com.atguigu.schedule.common;

/**
 * ä¸šåŠ¡å«ä¹‰å’ŒçŠ¶æ€ç å¯¹åº”å…³ç³»çš„æšä¸¾
 *
 */
public enum ResultCodeEnum {

    SUCCESS(200,"success"),
    USERNAME_ERROR(501,"usernameError"),
    PASSWORD_ERROR(503,"passwordError"),
    NOTLOGIN(504,"notLogin"),
    USERNAME_USED(505,"userNameUsed")
    ;

    private Integer code;
    private String message;
    private ResultCodeEnum(Integer code, String message) {
        this.code = code;
        this.message = message;
    }
    public Integer getCode() {
        return code;
    }
    public String getMessage() {
        return message;
    }
}

```

``` java
package com.atguigu.schedule.common;


/**
 * å…¨å±€ç»Ÿä¸€å“åº”çš„JSONæ ¼å¼å¤„ç†ç±»
 *
 */
public class Result<T> {
    // è¿”å›ç 
    private Integer code;
    // è¿”å›æ¶ˆæ¯
    private String message;
    // è¿”å›æ•°æ®
    private T data;
    public Result(){}
    // è¿”å›æ•°æ®
    protected static <T> Result<T> build(T data) {
        Result<T> result = new Result<T>();
        if (data != null)
            result.setData(data);
        return result;
    }
    public static <T> Result<T> build(T body, Integer code, String message) {
        Result<T> result = build(body);
        result.setCode(code);
        result.setMessage(message);
        return result;
    }
    public static <T> Result<T> build(T body, ResultCodeEnum resultCodeEnum) {
        Result<T> result = build(body);
        result.setCode(resultCodeEnum.getCode());
        result.setMessage(resultCodeEnum.getMessage());
        return result;
    }
    /**
     * æ“ä½œæˆåŠŸ
     * @param data  baseCategory1List
     * @param <T>
     * @return
     */
    public static<T> Result<T> ok(T data){
        Result<T> result = build(data);
        return build(data, ResultCodeEnum.SUCCESS);
    }
    public Result<T> message(String msg){
        this.setMessage(msg);
        return this;
    }
    public Result<T> code(Integer code){
        this.setCode(code);
        return this;
    }
    public Integer getCode() {
        return code;
    }
    public void setCode(Integer code) {
        this.code = code;
    }
    public String getMessage() {
        return message;
    }
    public void setMessage(String message) {
        this.message = message;
    }
    public T getData() {
        return data;
    }
    public void setData(T data) {
        this.data = data;
    }
}

```

+ å¢åŠ Jacksonä¾èµ–

![1690511433594](images/1690511433594.png)

+ æ·»åŠ WEBUtilå·¥å…·ç±»

``` java
package com.atguigu.schedule.util;


import com.atguigu.schedule.common.Result;
import com.fasterxml.jackson.databind.ObjectMapper;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.BufferedReader;
import java.io.IOException;
import java.text.SimpleDateFormat;

public class WebUtil {
    private static ObjectMapper objectMapper;
    // åˆå§‹åŒ–objectMapper
    static{
        objectMapper=new ObjectMapper();
        // è®¾ç½®JSONå’ŒObjectè½¬æ¢æ—¶çš„æ—¶é—´æ—¥æœŸæ ¼å¼
        objectMapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));
    }
    // ä»è¯·æ±‚ä¸­è·å–JSONä¸²å¹¶è½¬æ¢ä¸ºObject
    public static <T> T readJson(HttpServletRequest request,Class<T> clazz){
        T t =null;
        BufferedReader reader = null;
        try {
            reader = request.getReader();
            StringBuffer buffer =new StringBuffer();
            String line =null;
            while((line = reader.readLine())!= null){
                buffer.append(line);
            }

            t= objectMapper.readValue(buffer.toString(),clazz);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        return t;
    }
    // å°†Resultå¯¹è±¡è½¬æ¢æˆJSONä¸²å¹¶æ”¾å…¥å“åº”å¯¹è±¡
    public static void writeJson(HttpServletResponse response, Result result){
        response.setContentType("application/json;charset=UTF-8");
        try {
            String json = objectMapper.writeValueAsString(result);
            response.getWriter().write(json);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}

```



+ ç”¨æˆ·åæ ¡éªŒä¸šåŠ¡æ¥å£ä»£ç 

``` java
  /** 
     * SysUserControllerä¸‹,æ³¨å†Œæ—¶æ ¡éªŒç”¨æˆ·åæ˜¯å¦è¢«å ç”¨çš„ä¸šåŠ¡æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void checkUsernameUsed(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String username = req.getParameter("username");
        SysUser registUser = userService.findByUsername(username);

        //å°è£…ç»“æœå¯¹è±¡
        Result result=null;
        if(null ==registUser){
            // æœªå ç”¨,åˆ›å»ºä¸€ä¸ªcodeä¸º200çš„å¯¹è±¡
            result= Result.ok(null);
        }else{
            // å ç”¨, åˆ›å»ºä¸€ä¸ªç»“æœä¸º505çš„å¯¹è±¡
            result= Result.build(null, ResultCodeEnum.USERNAME_USED);

        }
        // å°†resultå¯¹è±¡è½¬æ¢æˆJSONå¹¶å“åº”ç»™å®¢æˆ·ç«¯
        WebUtil.writeJson(resp,result);

    }
```






---


----

Â© ç‰ˆæƒå£°æ˜

<escape>

<div>
    <h3 align="center"  style="color: brown;" >ç‰ˆæƒå£°æ˜</h3>
    <table>
   		<tr>
    		<ol>
				<li>æœ¬ç½‘ç«™åç§°ï¼šğš²ğš³ğš²</li>
				<li>ğš²ğš³ğš²æä¾›çš„èµ„æºä»…ä¾›æ‚¨ä¸ªäººç”¨äºéå•†ä¸šæ€§ç›®çš„ã€‚</li>
				<li>æœ¬ç«™æ–‡ç« éƒ¨åˆ†å†…å®¹å¯èƒ½æ¥æºäºç½‘ç»œï¼Œä»…ä¾›å¤§å®¶å­¦ä¹ ä¸å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æˆ‘è¿›è¡Œåˆ é™¤å¤„ç†ã€‚</li>
				<li>æœ¬ç«™ä¸€åˆ‡èµ„æºä¸ä»£è¡¨æœ¬ç«™ç«‹åœºï¼Œå¹¶ä¸ä»£è¡¨æœ¬ç«™èµåŒå…¶è§‚ç‚¹å’Œå¯¹å…¶çœŸå®æ€§è´Ÿè´£ã€‚</li>
        		<li>æœ¬ç«™ä¸€å¾‹ç¦æ­¢ä»¥ä»»ä½•æ–¹å¼å‘å¸ƒæˆ–è½¬è½½ä»»ä½•è¿æ³•çš„ç›¸å…³ä¿¡æ¯ï¼Œè®¿å®¢å‘ç°è¯·ä¸¾æŠ¥</li> 
        		<li>æœ¬ç«™èµ„æºå¤§å¤šå­˜å‚¨åœ¨äº‘ç›˜ï¼Œå¦‚å‘ç°é“¾æ¥å¤±æ•ˆï¼Œè¯·è”ç³»æˆ‘ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´æ›´æ–°ã€‚</li>
        		<li>æœ¬ç«™å¼ºçƒˆæ‰“å‡»ç›—ç‰ˆ/ç ´è§£ç­‰æœ‰æŸä»–äººæƒç›Šå’Œè¿æ³•ä½œä¸ºï¼Œè¯·æ”¯æŒæ­£ç‰ˆï¼</li>  
			</ol>
		</tr>
	</table>
</div>








</escape>

----


























