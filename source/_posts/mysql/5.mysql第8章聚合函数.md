---
title: 5.mysqlç¬¬8ç« èšåˆå‡½æ•°
date: 2019-10-03 13:00:00
author: ğš²ğš³ğš²
tags:   # æ·»åŠ åšæ–‡æ ‡ç­¾
	- mysql8.0.22
categories:   # æ·»åŠ åšæ–‡åˆ†ç±»
	- mysql8.0.22

---

<h1><center>èšåˆå‡½æ•°</center></h1>



### 1.èšåˆå‡½æ•°ç±»å‹ï¼ˆè®°ä½èšåˆå‡½æ•°å°±è¿™5ç§ï¼‰

>AVG(å­—æ®µ) æ±‚å¹³å‡å€¼
>  SUM(å­—æ®µ) æ±‚å’Œ
>  MAX(å­—æ®µ) æ±‚æœ€å¤§å€¼
>  MIN(å­—æ®µ) æ±‚æœ€å°å€¼
>  COUNT(æŸå­—æ®µ) æ±‚å­—æ®µæœ‰å¤šå°‘ä¸ª
>  æ³¨æ„1ï¼šèšåˆå‡½æ•°ä¸€èˆ¬æ˜¯é…åˆ group by åˆ†ç»„ æ¥ä½¿ç”¨çš„
>    select  MAX(salary) from employees;
>  æ³¨æ„2ï¼šwhere åé¢ä¸èƒ½è·Ÿ èšåˆå‡½æ•°
>  æ³¨æ„3ï¼šèšåˆå‡½æ•°ä¸èƒ½åµŒå¥—ä½¿ç”¨

```mysql
/**
  äº”ã€èšåˆå‡½æ•°ç±»å‹ï¼ˆè®°ä½èšåˆå‡½æ•°å°±è¿™5ç§ï¼‰
  AVG(å­—æ®µ) æ±‚å¹³å‡å€¼
  SUM(å­—æ®µ) æ±‚å’Œ
  MAX(å­—æ®µ) æ±‚æœ€å¤§å€¼
  MIN(å­—æ®µ) æ±‚æœ€å°å€¼
  COUNT(æŸå­—æ®µ) æ±‚å­—æ®µæœ‰å¤šå°‘ä¸ª
  æ³¨æ„1ï¼šèšåˆå‡½æ•°ä¸€èˆ¬æ˜¯é…åˆ group by åˆ†ç»„ æ¥ä½¿ç”¨çš„
    select  MAX(salary) from employees;
  æ³¨æ„2ï¼šwhere åé¢ä¸èƒ½è·Ÿ èšåˆå‡½æ•°
  æ³¨æ„3ï¼šèšåˆå‡½æ•°ä¸èƒ½åµŒå¥—ä½¿ç”¨

# ç»ƒä¹ ï¼š æ±‚ æ‰€æœ‰äººä¸­ï¼Œæœ€é«˜å·¥èµ„çš„é‚£ä¸ªäºº
  é”™è¯¯çš„å†™æ³•ï¼š
 æœ‰çŸ›ç›¾ä¹‹å¤„ï¼ŒæŸ¥è¿™å¼ å‘˜å·¥è¡¨ï¼Œæ±‚å‡º æœ€å¤§å·¥èµ„çš„é‚£ä¸ªï¼Œåº”è¯¥æ˜¯1ä¸ªç»“æœï¼Œè€Œå­—æ®µä¸­è¿˜æœ‰last_nameå­—æ®µæ˜¯è¡¨ç¤ºæ˜¾ç¤ºè¡¨employeesä¸­æ‰€æœ‰äººçš„å§“åï¼Œæœ‰å†²çª
 select last_name, MAX(salary) from employees;
 # æ­£ç¡®å†™æ³•ï¼šæ±‚ æ‰€æœ‰äººä¸­ï¼Œæœ€é«˜å·¥èµ„çš„é‚£ä¸ªäºº( ç”¨åˆ°å­æŸ¥è¯¢)
  select employee_id, last_name, salary from employees
    where salary=(select max(salary)from employees);

 */
select * from employees;
select  MAX(salary) from employees;

# æ±‚ æ‰€æœ‰äººä¸­ï¼Œæœ€é«˜å·¥èµ„çš„é‚£ä¸ªäºº( ç”¨åˆ°å­æŸ¥è¯¢)
select employee_id, last_name, salary from employees
where salary=(select max(salary)from employees);

#èšåˆå‡½æ•°ï¼Œé…åˆgroup by ä½¿ç”¨ï¼šæŒ‰ç…§éƒ¨é—¨åˆ†ç»„ï¼Œæ±‚å‡ºæ¯ä¸ªéƒ¨é—¨ä¸­æœ€é«˜å·¥èµ„
select department_id,MAX(salary) from employees
group by department_id;

/**
  ç»Ÿè®¡ä¸ªæ•°çš„å­—æ®µ
  COUNT()
  # å­—æ®µcommission_pctæœ‰35è¡Œæœ‰å€¼ï¼Œnullä¸ç»Ÿè®¡
 */
select COUNT(commission_pct) from employees;

```



### 2.group---by

#### å¯ä»¥ä½¿ç”¨GROUP BYå­å¥å°†è¡¨ä¸­çš„æ•°æ®åˆ†æˆè‹¥å¹²ç»„

```mysql
SELECT column, group_function(column)
FROM table
[WHERE
 condition]
[GROUP BY
 group_by_expression]
[ORDER BY
 column];
```

>æ˜ç¡®:WHEREä¸€å®šæ”¾åœ¨FROMåé¢

## â˜†â˜†â˜†group....by... çš„sqlè¯­å¥ç†è§£â˜†â˜†â˜†

### è¿™é‡Œä¹Ÿè¦æ€è€ƒè¡¨ä¸è¡¨ä¹‹é—´çš„å¯¹åº”å…³ç³» 

```mysql
select department_id ,avg(salary)  # select è¯»ä½œ è¿™ä¸€ä¸ªéƒ¨é—¨ä¸­ å·¥èµ„çš„å¹³å‡å€¼
from employees
group by department_id; 
# é€šè¿‡select åé¢çš„ è¯­å¥ï¼Œå°±å¯ä»¥çœ‹å‡ºåˆ†ç»„åçš„ è¡¨å¼ ä»€ä¹ˆæ ·å­äº†
# è¿™é‡Œ è‚¯å®šæ˜¯ æ¯ä¸€ä¸ªéƒ¨é—¨ åœ¨ç¬¬ä¸€åˆ—ï¼Œ ç¬¬äºŒåˆ—æ˜¯ æ¯ä¸ªéƒ¨é—¨çš„ å¹³å‡å·¥èµ„
#å¦‚ä¸‹å›¾
```

![image-20241014005523571](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202410140055769.png)

```mysql
select department_id,job_id ,avg(salary)  
from employees
group by department_id,job_id;

# æ¯ä¸ªéƒ¨é—¨åˆ†ç»„åï¼Œ éƒ¨é—¨é‡Œé¢å†æŒ‰ç…§ å·¥ç§id(job_id) è¿›è¡Œåˆ†ç»„.
# å¯ä»¥é¢„è§æŸ¥å‡ºæ¥çš„è¡¨ ,ä¸€ä¸ªéƒ¨é—¨ï¼Œè¦åˆ†å¤šè¡Œäº†ï¼Œå› ä¸ºä¸€ä¸ªéƒ¨é—¨é‡Œé¢æœ‰å¤šä¸ªå·¥ç§ï¼Œæ¯ä¸ªå·¥ç§åœ¨è¿›è¡Œç®—å·¥èµ„å¹³å‡å€¼
# å¦‚ä¸‹å›¾
```

![image-20241014005425668](https://raw.githubusercontent.com/protonlml/blogimages/master/imgs/202410140054911.png)





```mysql

/**
  --------------------------------------group---by----å­—æ®µåˆ†ç»„çš„ä½¿ç”¨-------------------------------------------------
 */

/**
  åˆ†ç»„ï¼š
å¯¹äº group by åˆ†ç»„çš„ç†è§£

# ç»“è®º1ï¼šåœ¨select åé¢å£°æ˜çš„ å­—æ®µï¼Œé™¤äº†ç»„å‡½æ•°ä¹‹å¤–çš„å­—æ®µï¼Œä¸€å®šè¦å‡ºç°åœ¨ group by åé¢;
# åä¹‹group by åé¢å£°æ˜çš„ å­—æ®µï¼Œä¸ä¸€å®šè¦å‡ºç°åœ¨ select  åé¢
# åæ­£å°±æ˜¯ï¼Œåªè¦å‡ºç°äº†åˆ†ç»„ï¼Œ åœ¨select åé¢å£°æ˜çš„å­—æ®µ ï¼Œåœ¨ group by åé¢è¦å…¨éƒ¨éƒ½ç»™å†™ä¸Šï¼Œå¹¶ä¸”select åé¢ä¸€å®šè¦æœ‰ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œæ¥è®¡ç®—ç»„æ„å›¾ç»“æœã€‚

# ç»“è®º2ï¼šgroup by å£°æ˜åœ¨fromåé¢ã€whereåé¢,      order by æ’åºå‰é¢ã€limit åˆ†é¡µå‰é¢ã€‚ ï¼ˆå¯ä»¥ç†è§£ï¼Œç»“æœé›†ç¾¤éƒ½éƒ½å¤„ç†å®Œæ¯•ï¼Œåœ¨è¿›è¡Œæ’åºï¼Œå’Œåˆ†é¡µï¼‰
--------------------------------------------------
select department_id,avg(salary)
from employees
group by department_id,job_id;
--------------------------------------------------
select department_id,job_id ,avg(salary)
from employees
group by department_id,job_id;

 */
select * from employees;
# æ±‚æ‰€æœ‰å‘˜å·¥çš„ å·¥èµ„å¹³å‡å€¼  AVG = SUM / COUNT(1)
select SUM(salary) / count(1) from employees;
# æ±‚æ‰€æœ‰å‘˜å·¥çš„ å·¥èµ„å¹³å‡å€¼
select avg(salary)
from employees;

#

# æŸ¥è¯¢   æ¯ä¸ªéƒ¨é—¨ æœ‰å¤šå°‘äºº
# å…ˆæ‰¾åˆ°employeesè¡¨
# ç„¶ågroup by æŒ‰ç…§department_id éƒ¨é—¨åˆ†ç»„ï¼Œæœ‰null,10ï¼Œ20ï¼Œ30ï¼Œ40ï¼Œ50ï¼Œ60ï¼Œ70ï¼Œ80ï¼Œ90ï¼Œ100è¿™12ä¸ªéƒ¨é—¨,æ­¤æ—¶ç»“æœé›†å·²ç»å½¢æˆ12æ¡æ•°æ®ï¼Œ12ä¸ªéƒ¨é—¨
# éšå count(1)  å†æ¬¡é™å®šç»“æœé›†ï¼Œå°†æ¯ä¸ªéƒ¨é—¨å¤šå°‘äººæ±‚å‡ºæ¥
select department_id ,count(1)
from employees
group by department_id;

# æ¯ä¸ªéƒ¨é—¨ä¸­ çš„ å¹³å‡å·¥èµ„æ˜¯å¤šå°‘
# æ±‚æ¯ä¸ªéƒ¨é—¨çš„ å¹³å‡å·¥èµ„
select department_id ,avg(salary)
from employees
group by department_id;

# å…ˆæ‰¾åˆ°employeesè¡¨
#  ç„¶ågroup by æŒ‰ç…§department_id éƒ¨é—¨åˆ†ç»„ï¼Œåœ¨æŒ‰ç…§ å·¥ç§job_id è¿›è¡Œ åˆ†ç»„ã€‚
# æ¯”å¦‚90å·éƒ¨é—¨çš„AD_PRES åœ¨ä¸€è¡Œï¼Œ90å·éƒ¨é—¨çš„AD_VPå·¥ç§ åœ¨ä¸€è¡Œï¼Œæ±‚å¹³å‡å·¥èµ„å€¼ã€‚
select department_id,job_id ,avg(salary)
from employees
group by department_id,job_id;

#é”™è¯¯å†™æ³• è¿™ç§é”™è¯¯å°±æ˜¯ æŒ‰ç…§ department_idåˆ†ç»„åçš„ç»“æœé›†ï¼Œ
# åœ¨select åé¢çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œæ“ä½œï¼Œåªè¦æ˜¾ç¤ºlast_name
# è¿™é‡Œ æŒ‰ç…§ department_idåˆ†ç»„åï¼Œå±•ç¤ºå­—æ®µlast_name ï¼Œä¸å¯èƒ½çš„äº‹æƒ…ï¼Œæ˜¯é”™è¯¯çš„å†™æ³•
select department_id ,last_name
from employees
group by department_id;


# é”™è¯¯å†™æ³•
# åªæŒ‰ç…§ department_id è¿›è¡Œåˆ†ç»„ï¼Œä¸èƒ½æŸ¥åˆ°job_id å­—æ®µ
select department_id,job_id,avg(salary)
from employees
group by department_id;

# ç»“è®ºï¼šåœ¨select åé¢å£°æ˜çš„ å­—æ®µï¼Œé™¤äº†ç»„å‡½æ•°ä¹‹å¤–çš„å­—æ®µï¼Œä¸€å®šè¦å‡ºç°åœ¨ group by åé¢;
# åä¹‹group by åé¢å£°æ˜çš„ å­—æ®µï¼Œä¸ä¸€å®šè¦å‡ºç°åœ¨ select  åé¢

/**
  # ç»“è®º3.

åªè¦çœ‹è§sqlè¯­å¥ä¸­æœ‰group by å°±è¦æƒ³ï¼Œç»“æœé›†æ˜¯ è¿›è¡Œåˆ†ç»„çš„ç»“æœï¼Œ select åé¢çš„å­—æ®µï¼Œå°±æ˜¯åˆ†ç»„çš„å­—æ®µï¼Œèšåˆå‡½æ•°å°±æ˜¯å¯¹è¿™åˆ†ç»„åçš„æ“ä½œã€‚
        å¦‚æœåˆ†ç»„åçš„ç»“æœç»§ç»­ç­›é€‰ï¼Œå°±è¦ä½¿ç”¨having è¿›è¡Œç­›é€‰ï¼Œ åé¢è·Ÿçš„æ˜¯èšåˆå‡½æ•°ã€‚
         è¿™é‡Œä¸èƒ½ä½¿ç”¨where ,where  å¯ä»¥ç›´æ¥ä½¿ç”¨è¡¨ä¸­çš„å­—æ®µä½œä¸ºç­›é€‰æ¡ä»¶,ä½†ä¸èƒ½ä½¿ç”¨åˆ†ç»„ä¸­çš„ èšåˆå‡½æ•° ä½œä¸ºç­›é€‰æ¡ä»¶;
  HAVING å¿…é¡»è¦ä¸ GROUP BY é…åˆä½¿ç”¨,å¯ä»¥æŠŠåˆ†ç»„è®¡ç®—çš„èšåˆå‡½æ•°å’Œåˆ†ç»„å­—æ®µä½œä¸ºç­›é€‰æ¡ä»¶ã€‚
 */


#æŒ‰ç…§éƒ¨é—¨åˆ†ç»„ï¼Œéƒ¨é—¨æœ‰ null,10,20,30,40,50,60,70,80,90,100,110
select department_id  from employees
group by department_id;
#æŒ‰ç…§ éƒ¨é—¨å’Œå·¥èµ„åˆ†ç»„
# ä¸€ä¸ªéƒ¨é—¨ä¸­æœ‰å¾ˆå¤šäººå·¥èµ„ä¸ä¸€æ ·ï¼Œä¸€æ ·çš„åˆ†ä¸ºä¸€ç»„ å¦‚ï¼š90å·éƒ¨é—¨å·¥èµ„æœ‰ä¸¤ç§24000ï¼Œ17000
select department_id ,salary from employees
group by department_id,salary;
#æ±‚ æ¯ä¸ªéƒ¨é—¨ä¸­ å·¥èµ„æœ€é«˜æ˜¯å¤šå°‘
select department_id , max(salary) from employees
group by department_id;

# éœ€æ±‚ï¼š æŸ¥è¯¢å‡º æ¯ä¸ªéƒ¨é—¨ä¸­æœ€é«˜å·¥èµ„ ï¼Œä¸”æœ€é«˜å·¥èµ„è¶…è¿‡10000çš„éƒ¨é—¨ã€‚
select  department_id, MAX(salary)
from employees
GROUP BY department_id
having MAX(salary)>10000 ; # å¯¹åˆ†ç»„å†è¿›è¡Œç­›é€‰

# éœ€æ±‚ï¼š æŸ¥è¯¢å‡º 50ï¼Œ90ï¼Œ110 éƒ¨é—¨ä¸­ï¼Œæœ€é«˜å·¥èµ„è¶…è¿‡10000çš„éƒ¨é—¨æ˜¯é‚£å‡ ä¸ªã€‚
# è¿™é‡Œ where åé¢çš„æ¡ä»¶ æ˜¯å…ˆç­›é€‰ ç¬¦åˆæ¡ä»¶çš„éƒ¨é—¨ï¼Œæé«˜äº†æŸ¥è¯¢é€Ÿåº¦
#     having åé¢çš„ç­›é€‰æ¡ä»¶ï¼Œè®°ä½å°±è·Ÿèšåˆå‡½æ•°
select  department_id, MAX(salary)
from employees
where department_id in(50,90,110)
GROUP BY department_id
having MAX(salary)>10000 ; # å¯¹åˆ†ç»„å†è¿›è¡Œç­›é€‰

# ----------------ç‰¢è®°sqlè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹----------------------
```



## ç»ƒä¹ 

```mysql

# ç¬¬å…«ç« ï¼Œèšåˆå‡½æ•°çš„ç»ƒä¹ 
#ç»„å‡½æ•°ï¼Œåˆå«èšåˆå‡½æ•°

#1.whereå­å¥å¯å¦ä½¿ç”¨ç»„å‡½æ•°ï¼ˆèšåˆå‡½æ•°ï¼‰è¿›è¡Œè¿‡æ»¤?
# ç­”ï¼šä¸èƒ½ï¼Œwhere åé¢è¿‡æ»¤æ¡ä»¶ä¸èƒ½è·Ÿèšåˆå‡½æ•°ï¼Œ è€Œhaving åé¢å¯ä»¥è·Ÿèšåˆå‡½æ•°

#2.æŸ¥è¯¢å…¬å¸å‘˜å·¥ å·¥èµ„çš„ æœ€å¤§å€¼,æœ€å°å€¼,å¹³å‡å€¼,æ€»å’Œ
select max(salary),min(salary),avg(salary),sum(salary)
from employees;

#3.æŸ¥è¯¢å„job_idçš„å‘˜å·¥ å·¥èµ„çš„ æœ€å¤§å€¼,æœ€å°å€¼,å¹³å‡å€¼,æ€»å’Œ

select job_id,max(salary),min(salary),avg(salary),sum(salary)
from employees
group by job_id;

#4.é€‰æ‹©å…·æœ‰å„ä¸ªjob_idçš„å‘˜å·¥äººæ•°
select job_id , count(1)
from employees
group by job_id;

# 5.æŸ¥è¯¢å‘˜å·¥æœ€é«˜å·¥èµ„å’Œæœ€ä½å·¥èµ„çš„å·®è·(DIFFERENCE)
   select max(salary)-min(salary) as 'å·®è·'
   from employees;

# 6.æŸ¥è¯¢å„ä¸ªç®¡ç†è€…æ‰‹ä¸‹ å‘˜å·¥çš„ æœ€ä½å·¥èµ„,å…¶ä¸­æœ€ä½å·¥èµ„ä¸èƒ½ä½äº6000, æ²¡æœ‰ç®¡ç†è€…çš„å‘˜å·¥ä¸è®¡ç®—åœ¨å†…
/*
select  distinct e1.employee_id from employees e1
join employees e2 on e1.manager_id=e2.department_id;

select * from
(select  distinct e1.employee_id ma_id from employees e1 join employees e2 on e1.manager_id=e2.department_id) a
group by a.ma_id;


select manager_id, employee_id from employees
where manager_id is not null
group by manager_id ,employee_id;
*/

select manager_id , min(salary)
from employees
where manager_id is not null
group by manager_id
having min(salary)>6000;


# 7.æŸ¥è¯¢ æ‰€æœ‰éƒ¨é—¨ çš„åå­—,location_id,å‘˜å·¥æ•°é‡ å’Œ å¹³å‡å·¥èµ„, å¹¶æŒ‰å¹³å‡å·¥èµ„é™åº
select * from departments;

select  e.department_id,d.department_name,d.location_id,count(e.employee_id),avg(e.salary) avg_salary
from departments d
left join employees e
on d.department_id=e.department_id
group by d.department_id
order by avg_salary desc ;


# 8.æŸ¥è¯¢ æ¯ä¸ªå·¥ç§ã€æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨åã€å·¥ç§å å’Œ æœ€ä½å·¥èµ„
select d.department_name ,e.job_id,min(salary)
from departments d
  join employees e  on e.department_id = d.department_id
group by d.department_name ,e.job_id;






```







---


----

Â© ç‰ˆæƒå£°æ˜

<escape>

<div>
    <h3 align="center"  style="color: brown;" >ç‰ˆæƒå£°æ˜</h3>
    <table>
   		<tr>
    		<ol>
				<li>æœ¬ç½‘ç«™åç§°ï¼šğš²ğš³ğš²</li>
				<li>ğš²ğš³ğš²æä¾›çš„èµ„æºä»…ä¾›æ‚¨ä¸ªäººç”¨äºéå•†ä¸šæ€§ç›®çš„ã€‚</li>
				<li>æœ¬ç«™æ–‡ç« éƒ¨åˆ†å†…å®¹å¯èƒ½æ¥æºäºç½‘ç»œï¼Œä»…ä¾›å¤§å®¶å­¦ä¹ ä¸å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æˆ‘è¿›è¡Œåˆ é™¤å¤„ç†ã€‚</li>
				<li>æœ¬ç«™ä¸€åˆ‡èµ„æºä¸ä»£è¡¨æœ¬ç«™ç«‹åœºï¼Œå¹¶ä¸ä»£è¡¨æœ¬ç«™èµåŒå…¶è§‚ç‚¹å’Œå¯¹å…¶çœŸå®æ€§è´Ÿè´£ã€‚</li>
        		<li>æœ¬ç«™ä¸€å¾‹ç¦æ­¢ä»¥ä»»ä½•æ–¹å¼å‘å¸ƒæˆ–è½¬è½½ä»»ä½•è¿æ³•çš„ç›¸å…³ä¿¡æ¯ï¼Œè®¿å®¢å‘ç°è¯·ä¸¾æŠ¥</li> 
        		<li>æœ¬ç«™èµ„æºå¤§å¤šå­˜å‚¨åœ¨äº‘ç›˜ï¼Œå¦‚å‘ç°é“¾æ¥å¤±æ•ˆï¼Œè¯·è”ç³»æˆ‘ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´æ›´æ–°ã€‚</li>
        		<li>æœ¬ç«™å¼ºçƒˆæ‰“å‡»ç›—ç‰ˆ/ç ´è§£ç­‰æœ‰æŸä»–äººæƒç›Šå’Œè¿æ³•ä½œä¸ºï¼Œè¯·æ”¯æŒæ­£ç‰ˆï¼</li>  
			</ol>
		</tr>
	</table>
</div>





</escape>

----



