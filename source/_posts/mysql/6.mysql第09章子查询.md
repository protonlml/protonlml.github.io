---
title: 6.mysqlç¬¬09ç« å­æŸ¥è¯¢
date: 2019-10-03 14:00:00
author: ğš²ğš³ğš²
tags:   # æ·»åŠ åšæ–‡æ ‡ç­¾
	- mysql8.0.22
categories:   # æ·»åŠ åšæ–‡åˆ†ç±»
	- mysql8.0.22


---

<h1><center>å­æŸ¥è¯¢</center></h1>



### ä¸€ã€å­æŸ¥è¯¢



```mysql
/**
  å­æŸ¥è¯¢:
 */
# éœ€æ±‚ï¼šå‘˜å·¥è¡¨ä¸­ï¼Œæ¯”Abelçš„å·¥èµ„é«˜çš„éƒ½æœ‰é‚£äº›

select last_name,salary
from employees
where salary>(select salary
              from employees
              where last_name='Abel');

/**
  å­æŸ¥è¯¢çš„åˆ†ç±»
  æˆ‘ä»¬æŒ‰å†…æŸ¥è¯¢çš„ç»“æœè¿”å›ä¸€æ¡è¿˜æ˜¯å¤šæ¡è®°å½•,å°†å­æŸ¥è¯¢åˆ†ä¸º å•è¡Œå­æŸ¥è¯¢ ã€ å¤šè¡Œå­æŸ¥è¯¢ ã€‚
 */

/**
    å•è¡Œå­æŸ¥è¯¢ï¼š
  å› ä¸ºï¼Œå•è¡Œå­æŸ¥è¯¢çš„è¿”å›ç»“æœï¼Œåªæœ‰ä¸€è¡Œï¼Œå°±ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥å¯ä½¿ç”¨ = > >= < <= <> è¿›è¡Œæ¯”è¾ƒæ“ä½œ
  ä¾‹å¦‚ï¼š
  é¢˜ç›®:æŸ¥è¯¢å·¥èµ„å¤§äº149å·å‘˜å·¥å·¥èµ„çš„å‘˜å·¥çš„ä¿¡æ¯
 */
select last_name,salary
from employees
where salary>(
    select salary from employees where employee_id='149' #10500
    );

# é¢˜ç›®:è¿”å›job_idä¸141å·å‘˜å·¥ç›¸åŒ,salaryæ¯”143å·å‘˜å·¥å¤šçš„å‘˜å·¥å§“å,job_idå’Œå·¥èµ„

select  last_name,job_id,salary
from employees
where job_id=(select job_id from employees where employee_id='141')
and salary>(select salary from employees where employee_id='141');

# é¢˜ç›®:è¿”å›å…¬å¸å·¥èµ„æœ€å°‘çš„å‘˜å·¥çš„last_name,job_idå’Œsalary
select last_name,job_id,salary
from employees
where salary=(
    select min(salary) from employees
    );

# é¢˜ç›®:æŸ¥è¯¢ä¸141å·æˆ–174å·å‘˜å·¥çš„manager_idå’Œdepartment_idç›¸åŒçš„å…¶ä»–å‘˜å·¥çš„employee_id, manager_id,department_id
select employee_id,manager_id,department_id
from employees
where manager_id in (select  manager_id from employees where employee_id in(141,174))
and department_id in (select  department_id from employees where employee_id in(141,174))
and employee_id not in (141,174);

/**
   HAVING ä¸­çš„å­æŸ¥è¯¢
    é¦–å…ˆæ‰§è¡Œå­æŸ¥è¯¢ã€‚
    å‘ä¸»æŸ¥è¯¢ä¸­çš„HAVING å­å¥è¿”å›ç»“æœã€‚
 */
# é¢˜ç›®:æŸ¥è¯¢æœ€ä½å·¥èµ„
# å¤§äº 50å·éƒ¨é—¨æœ€ä½å·¥èµ„
# çš„éƒ¨é—¨ idå’Œå…¶æœ€ä½å·¥èµ„
select  department_id,min(salary)
from employees e
group by department_id
having min(salary) > (
                select min(salary)
                from employees
                where department_id=50
                group by department_id
    );


/**
   CASEä¸­çš„å­æŸ¥è¯¢
    åœ¨CASEè¡¨è¾¾å¼ä¸­ä½¿ç”¨å•åˆ—å­æŸ¥è¯¢:
 */
#
# é¢˜ç›®:æ˜¾å¼å‘˜å·¥çš„ employee_id,last_nameå’Œlocationã€‚
# å…¶ä¸­,è‹¥å‘˜å·¥department_id
# ä¸   location_idä¸º1800 çš„department_idç›¸åŒ,20
# åˆ™locationä¸ºâ€™Canadaâ€™,å…¶ä½™åˆ™ä¸ºâ€™USAâ€™ã€‚

select employee_id,last_name, (case department_id
                                when (
                                    select department_id from departments
                                    where location_id=1800
                                    ) then 'Canada'
                                else 'USA' end ) location

from employees;



/*-------------------------------------------------------------------------------------------------------*/
/**
  å¤šè¡Œå­æŸ¥è¯¢
   å­æŸ¥è¯¢çš„ç»“æœï¼Œæ˜¯å¤šè¡Œçš„ï¼Œæ‰€ä»¥ä½¿ç”¨å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦
å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦
    in ç­‰äºåˆ—è¡¨ä¸­çš„ä»»æ„ä¸€ä¸ª
    ANY éœ€è¦å’Œå•è¡Œæ¯”è¾ƒæ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨,å’Œå­æŸ¥è¯¢è¿”å›çš„æŸä¸€ä¸ªå€¼æ¯”è¾ƒ
    ALL éœ€è¦å’Œå•è¡Œæ¯”è¾ƒæ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨,å’Œå­æŸ¥è¯¢è¿”å›çš„æ‰€æœ‰å€¼æ¯”è¾ƒ
    SOME å®é™…ä¸Šæ˜¯ANYçš„åˆ«å,ä½œç”¨ç›¸åŒ,ä¸€èˆ¬å¸¸ä½¿ç”¨ANY
 */
# é¢˜ç›®:è¿”å›
# å…¶å®ƒjob_idä¸­æ¯”   job_idä¸ºâ€˜IT_PROGâ€™éƒ¨é—¨ ä»»ä¸€å·¥èµ„ä½
# çš„ å‘˜å·¥çš„å‘˜å·¥å·ã€å§“åã€job_id ä»¥åŠsalary

#
# select d.department_id,e.salary
# from employees e join departments d
#     on e.department_id=d.department_id
# where e.job_id='IT_PROG';


select employee_id,last_name,job_id,salary
from employees
where salary< any(
    select salary from employees where job_id='IT_PROG'
    )
and job_id <> 'IT_PROG';

select * from departments;


# é¢˜ç›®:æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€ä½çš„éƒ¨é—¨id
# å°† è™šæ‹Ÿè¡¨ã€‚ä½œä¸º fromåé¢çš„è¡¨è¿›è¡ŒæŸ¥è¯¢
# æŸ¥è¯¢äº†å‘˜å·¥æ‰€åœ¨çš„æ‰€æœ‰éƒ¨é—¨çš„ å¹³å‡å·¥èµ„
select department_id,avg(salary) t_dep_gr_avgsalary
from employees
group by department_id;


# å¹³å‡å·¥èµ„æœ€ä½æ˜¯å¤šå°‘
select  min(t_dep_gr_avgsalary)
from (select avg(salary) t_dep_gr_avgsalary
from employees
group by department_id) dept_avg_sal ;


select department_id,avg(salary) t_dep_gr_avgsalary
from employees
group by department_id
having avg(salary) = (select  min(t_dep_gr_avgsalary)
from (select avg(salary) t_dep_gr_avgsalary
from employees
group by department_id) dept_avg_sal);


/**
  ç›¸å…³å­æŸ¥è¯¢ï¼šå¤–éƒ¨çš„è¡¨ï¼Œå­˜åœ¨äºå†…éƒ¨å­æŸ¥è¯¢å½“ä¸­

    å¦‚æœå­æŸ¥è¯¢çš„æ‰§è¡Œä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢,é€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å› ä¸ºå­æŸ¥è¯¢ä¸­çš„è¡¨ç”¨åˆ°äº†å¤–éƒ¨çš„è¡¨,å¹¶è¿›è¡Œäº†æ¡ä»¶
    å…³è”,å› æ­¤æ¯æ‰§è¡Œä¸€æ¬¡å¤–éƒ¨æŸ¥è¯¢,å­æŸ¥è¯¢éƒ½è¦é‡æ–°è®¡ç®—ä¸€æ¬¡,è¿™æ ·çš„å­æŸ¥è¯¢å°±ç§°ä¹‹ä¸º å…³è”å­æŸ¥è¯¢ ã€‚

        æ­¥éª¤æ˜¯ï¼š 1.å¤–æŸ¥è¯¢ï¼Œå…ˆæŸ¥è¯¢åˆ°äº†107æ¡è®°å½•ã€‚
                2.å°†ç¬¬ä¸€æ¡è®°å½•å–å‡ºæ¥ï¼Œé€è¿›å­æŸ¥è¯¢ä¸­ï¼Œé€è¿›æ¥çš„è¿™æ¡è®°å½•ï¼Œä½¿ç”¨å¤–è¡¨çš„è¿™æ¡è®°å½•ï¼Œè·å–åˆ°employee_idã€‚æŸ¥å‡ºå­æŸ¥è¯¢çš„ç»“æœ
                3.å°†å­æŸ¥è¯¢çš„ç»“æœï¼Œè¿”å›åˆ°å¤–æŸ¥è¯¢ï¼Œç»§ç»­å¤–æŸ¥è¯¢è¯­å¥çš„è¿‡æ»¤æ¡ä»¶ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœ

  é¢˜ç›®:æŸ¥è¯¢å‘˜å·¥ä¸­å·¥èµ„ å¤§äº æœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥çš„last_name,salaryå’Œå…¶department_id
   :è¿™é‡Œçš„ç›¸å…³å­æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»æŸ¥è¯¢ä¸­çš„åˆ—
 */

select last_name, e.employee_id ,salary
from employees e
where salary > (select avg(salary)
                from employees em
                where em.department_id=e.employee_id
);


/**
  ç›¸å…³å­æŸ¥è¯¢ï¼Œ å­æŸ¥è¯¢åœ¨ from åé¢
  fromå‹çš„å­æŸ¥è¯¢:å­æŸ¥è¯¢æ˜¯ä½œä¸ºfromçš„ä¸€éƒ¨åˆ†,å­æŸ¥è¯¢è¦ç”¨()å¼•èµ·æ¥,å¹¶ä¸”è¦ç»™è¿™ä¸ªå­æŸ¥è¯¢å–åˆ«
    å, æŠŠå®ƒå½“æˆä¸€å¼ â€œä¸´æ—¶çš„è™šæ‹Ÿçš„è¡¨â€æ¥ä½¿ç”¨ã€‚
 */
 #:æŸ¥è¯¢å‘˜å·¥ä¸­å·¥èµ„å¤§äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥çš„last_name,salaryå’Œå…¶department_id
SELECT last_name,salary,e1.department_id
FROM employees e1,(
                    SELECT department_id,AVG(salary) dept_avg_sal
                    FROM employees
                    GROUP BY department_id) e2
WHERE e1.`department_id` = e2.department_id
AND e2.dept_avg_sal < e1.`salary`;

/**
  åœ¨ORDER BY ä¸­ä½¿ç”¨ ç›¸å…³å­æŸ¥è¯¢:
  é¢˜ç›®:æŸ¥è¯¢å‘˜å·¥çš„id,salary,æŒ‰ç…§department_name æ’åº
 */
select  distinct department_name
from employees e2  left join departments d
on e2.department_id = d.department_id;

# select e1.last_name, e1.employee_id,e1.salary
# from employees e1
# order by (select  distinct department_name
# from employees e2  left join departments d
# on e2.department_id = d.department_id
#     where e1.employee_id=e2.employee_id) asc;

SELECT employee_id, salary
FROM employees e
ORDER BY (
             SELECT department_name
             FROM departments d
             WHERE e.`department_id` = d.`department_id`
         );


/**
  EXISTS ä¸ NOT EXISTSå…³é”®å­—
  å…³è”å­æŸ¥è¯¢é€šå¸¸ä¹Ÿä¼šå’Œ EXISTSæ“ä½œç¬¦ä¸€èµ·æ¥ä½¿ç”¨,ç”¨æ¥æ£€æŸ¥åœ¨å­æŸ¥è¯¢ä¸­æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œã€‚
        å¦‚æœåœ¨å­æŸ¥è¯¢ä¸­ä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œ:
        æ¡ä»¶è¿”å› FALSE
        ç»§ç»­åœ¨å­æŸ¥è¯¢ä¸­æŸ¥æ‰¾
        å¦‚æœåœ¨å­æŸ¥è¯¢ä¸­å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œ:
        ä¸åœ¨å­æŸ¥è¯¢ä¸­ç»§ç»­æŸ¥æ‰¾
        æ¡ä»¶è¿”å› TRUE
        NOT EXISTSå…³é”®å­—è¡¨ç¤ºå¦‚æœä¸å­˜åœ¨æŸç§æ¡ä»¶,åˆ™è¿”å›TRUE,å¦åˆ™è¿”å›FALSEã€‚
 */

#  é¢˜ç›®:æŸ¥è¯¢å…¬å¸ ç®¡ç†è€…çš„ employee_id, last_name, job_id,department_id ä¿¡æ¯
# æ–¹æ³•ä¸€ï¼šè¡¨è‡ªè¿æ¥
SELECT DISTINCT e1.employee_id, e1.last_name, e1.job_id, e1.department_id
FROM
 employees e1 JOIN employees e2
WHERE e1.employee_id = e2.manager_id;
# æ–¹æ³•äºŒã€
SELECT employee_id, last_name, job_id, department_id
FROM employees e1
WHERE EXISTS(SELECT *
             FROM employees e2
             WHERE e2.manager_id =
                   e1.employee_id);


# æŸ¥è¯¢    departmentsè¡¨ ä¸­ ä¸å­˜åœ¨äº employeesè¡¨ä¸­çš„éƒ¨é—¨     çš„department_idå’Œdepartment_name
SELECT department_id, department_name
FROM departments d
WHERE NOT EXISTS (SELECT 'X'
FROM
 employees
WHERE
 department_id = d.department_id);

/**
  ------------------------------------------------------------------------
  å­æŸ¥è¯¢ç»ƒä¹ 
 */
#1.æŸ¥è¯¢å’ŒZlotkeyç›¸åŒéƒ¨é—¨çš„å‘˜å·¥å§“åå’Œå·¥èµ„

select e1.department_id ,e1.last_name,e1.salary from employees e1
where  e1.department_id =(select department_id from employees e2 where e2.last_name='Zlotkey');

#2.æŸ¥è¯¢  å·¥èµ„æ¯”å…¬å¸å¹³å‡å·¥èµ„é«˜çš„  å‘˜å·¥çš„å‘˜å·¥å·,å§“åå’Œå·¥èµ„ã€‚
select employee_id,last_name,salary
from employees
where salary>(select avg(salary) from employees);
#å…¬å¸çš„å¹³å‡å·¥èµ„
select avg(salary) from employees;

#3.é€‰æ‹©å·¥èµ„å¤§äº æ‰€æœ‰JOB_ID = 'SA_MAN'çš„å‘˜å·¥çš„å·¥èµ„ çš„å‘˜å·¥çš„last_name, job_id, salary

select last_name,job_id,salary
from employees
where salary> all(select salary from employees
where job_id='SA_MAN');
#æ‰€æœ‰JOB_ID = 'SA_MAN'çš„å‘˜å·¥çš„å·¥èµ„
select salary from employees
where job_id='SA_MAN'

#4.æŸ¥è¯¢   å’Œå§“åä¸­åŒ…å«å­—æ¯uçš„å‘˜å·¥ åœ¨ ç›¸åŒéƒ¨é—¨ çš„å‘˜å·¥   çš„å‘˜å·¥å·å’Œå§“å
select employee_id,last_name
from employees
where department_id in (select distinct department_id  from employees
where last_name like '%U%');
# æŸ¥è¯¢å’Œ   å§“åä¸­åŒ…å«å­—æ¯uçš„å‘˜å·¥ åœ¨ç›¸åŒéƒ¨é—¨çš„å‘˜å·¥
# æŸ¥è¯¢å§“åä¸­åŒ…å«å­—æ¯uçš„å‘˜å·¥ çš„éƒ¨é—¨id
select distinct department_id  from employees
where last_name like '%U%';


#5.æŸ¥è¯¢åœ¨ éƒ¨é—¨çš„location_idä¸º1700çš„éƒ¨é—¨å·¥ä½œçš„ å‘˜å·¥çš„å‘˜å·¥å·

select employee_id ,last_name
from employees
where department_id in(
                        select department_id
                        from departments
                        where location_id='1700'
                      );

# æŸ¥è¯¢ location_idä¸º1700çš„éƒ¨é—¨idå·
select department_id
from departments
where location_id='1700';

#6.æŸ¥è¯¢ç®¡ç†è€…æ˜¯Kingçš„å‘˜å·¥å§“åå’Œå·¥èµ„

select last_name, salary,manager_id
from employees
where manager_id=(select employee_id
from employees
where last_name='King' and manager_id is null);
# æŸ¥è¯¢King ç®¡ç†è€…çš„ employee_id
select employee_id
from employees
where last_name='King' and manager_id is null ;


#7.æŸ¥è¯¢å·¥èµ„æœ€ä½çš„å‘˜å·¥ä¿¡æ¯: last_name, salary
select last_name,salary
from employees
where salary=(select min(salary) from employees);

#æŸ¥è¯¢å‘˜å·¥è¡¨çš„æœ€ä½å·¥èµ„æ˜¯å¤šå°‘
select min(salary)
from employees;

#8.æŸ¥è¯¢å¹³å‡å·¥èµ„ æœ€ä½çš„éƒ¨é—¨ä¿¡æ¯




#æŸ¥æ‰¾å„ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„
select  avg(salary) avg_salary
from employees
group by department_id;
# æŸ¥æ‰¾éƒ¨é—¨çš„æœ€ä½å·¥èµ„
select min(avg_salary)
from (select  avg(salary) avg_salary
from employees
group by department_id) t_avg_em;
# æŸ¥æ‰¾æœ€ä½å·¥èµ„çš„éƒ¨é—¨
select *
from departments
where department_id=(
        select department_id from employees
        group by department_id
        having avg(salary)=(
                            select min(avg_salary)
                            from (
                            select  avg(salary) avg_salary
                            from employees
                            group by department_id) t_avg_em
                            )
                    );



#9.æŸ¥è¯¢å¹³å‡å·¥èµ„ æœ€ä½çš„éƒ¨é—¨ ä¿¡æ¯  å’Œ  è¯¥éƒ¨é—¨çš„å¹³å‡å·¥èµ„(ç›¸å…³å­æŸ¥è¯¢)
select  department_id,avg(salary)
from employees
group by department_id
having avg(salary)<=ALL (
    #æ±‚å‡ºæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„
                select avg(salary)
                from employees
                group by department_id
);

# è®°ä½ä¸€ç‚¹ï¼šè¿™ç§å­æŸ¥è¯¢ï¼Œå°±æŠ“ä½ï¼Œå­æŸ¥è¯¢åå‡ºæ¥çš„å€¼




#10.æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€é«˜çš„ job ä¿¡æ¯
# æ³¨æ„ï¼šçœ‹é¢˜ç›®ï¼Œé¢˜ç›®è¦æŸ¥jobä¿¡æ¯ï¼Œè‚¯å®šæ˜¯ from jobsè¡¨,ç„¶åå†å»å‡‘æ¡ä»¶
select * from jobs;

# æŸ¥è¯¢æ¯ä¸ªå·¥ç§çš„ å¹³å‡å·¥èµ„
select job_id,avg(salary)
from employees
group by job_id;

# æŸ¥è¯¢  å¹³å‡å·¥èµ„æœ€é«˜çš„ å·¥ç§ job_id
select job_id
from employees
group by job_id
having avg(salary)>=ALL (
        select avg(salary)
        from employees
        group by job_id
);
#æœ€ç»ˆ
select * from jobs
where job_id=(select job_id
from employees
group by job_id
having avg(salary)>=ALL (
        select avg(salary)
        from employees
        group by job_id
));

#11.æŸ¥è¯¢ å¹³å‡å·¥èµ„  é«˜äº å…¬å¸å¹³å‡å·¥èµ„ çš„éƒ¨é—¨æœ‰å“ªäº›?
select * from
departments;

#æŸ¥è¯¢å…¬å¸çš„å¹³å‡å·¥èµ„
select avg(salary)
from employees;

# æŸ¥è¯¢éƒ¨é—¨çš„å¹³å‡å·¥èµ„
select department_id,avg(salary)
from employees
group by department_id;

# æŸ¥è¯¢ å¹³å‡å·¥èµ„  é«˜äº å…¬å¸å¹³å‡å·¥èµ„ çš„éƒ¨é—¨æœ‰å“ªäº›?
select department_id,avg(salary)
from employees
where department_id is not null
group by department_id
having avg(salary) >(
    select avg(salary)
    from employees
    ) ;


#12.æŸ¥è¯¢å‡ºå…¬å¸ä¸­æ‰€æœ‰ manager(ç®¡ç†è€…) çš„è¯¦ç»†ä¿¡æ¯
# managerä¹Ÿæ˜¯å‘˜å·¥
# è¿™é¢˜åªè¦æ˜¯ï¼Œå°†employeesè¡¨ï¼Œæƒ³è±¡æˆä¸¤å¼ è¡¨ï¼Œä¸€å¼ æ˜¯å‘˜å·¥è¡¨ï¼Œä¸€å¼ æ˜¯ ç®¡ç†è€…è¡¨ã€‚
# åªè¦ å‘˜å·¥è¡¨çš„ å‘˜å·¥id=ç®¡ç†è€…è¡¨ä¸­çš„ ç®¡ç†id ,é‚£ä¹ˆè¿™ä¸ªäººè¿™æ¡è®°å½•å°±æ˜¯ç®¡ç†è€…
# è‡ªè¿æ¥æŸ¥è¯¢
select * from employees;

select DISTINCT em.employee_id, em.last_name, em.salary
from employees em join employees ma
on em.employee_id=ma.manager_id;
#æ–¹æ³•2
SELECT employee_id, last_name, salary
FROM employees
WHERE employee_id IN (
    SELECT DISTINCT manager_id
    FROM employees
);
#ç›¸å…³å­æŸ¥è¯¢   æŸ¥è¯¢ç¬¬ä¸€è¡Œæ—¶ï¼Œ å¤–æŸ¥è¯¢çš„æ¡ä»¶ï¼Œè¿›å…¥åˆ°å†…æŸ¥è¯¢ï¼Œå†…æŸ¥è¯¢æ‰§è¡Œä½¿ç”¨å¤–æŸ¥è¯¢æ¡ä»¶ã€‚å®Œæ¯•ã€‚ è·³å‡ºå†…æŸ¥è¯¢ï¼Œåˆ°å¤–æŸ¥è¯¢ç»§ç»­æ‰§è¡Œ
#æ–¹å¼3:  where åé¢åˆ¤æ–­ å­˜åœ¨ EXISTS å­˜åœ¨è¿”å›true
SELECT employee_id, last_name, salary
FROM employees e1
WHERE EXISTS(SELECT *
             FROM employees e2
             WHERE e2.manager_id = e1.employee_id);


#13.å„ä¸ªéƒ¨é—¨ä¸­ æœ€é«˜å·¥èµ„ä¸­ æœ€ä½çš„é‚£ä¸ªéƒ¨é—¨çš„ æœ€ä½å·¥èµ„æ˜¯å¤šå°‘?
# æ±‚å„ä¸ªéƒ¨é—¨çš„æœ€é«˜å·¥èµ„
# å°†å„ä¸ªéƒ¨é—¨çš„æœ€é«˜å·¥èµ„è¿›è¡Œæ¯”è¾ƒï¼Œæœ€ä½çš„é‚£ä¸ªéƒ¨é—¨çš„å·¥èµ„æ˜¯å¤šå°‘

#ä»æœ€é«˜å·¥èµ„ä¸­æ‰¾åˆ°æœ€ä½å·¥èµ„
select min(mx_salary)
from (
    # æ±‚å„ä¸ªéƒ¨é—¨çš„æœ€é«˜å·¥èµ„
    select  max(salary) mx_salary
    from employees
    group by department_id ) a;

# æŠ“ä½æ ¸å¿ƒæ€æƒ³ï¼Œæ±‚ä»€ä¹ˆå°±å…ˆæŠŠå­—æ®µå†™å¥½ï¼Œåé¢å†å¾€ä¸Šé¢å‡‘
select department_id, salary
from employees
where department_id =
(select department_id
from employees
group by department_id
having max(salary) =
       (select max(salary) m_sa
        from employees
        group by department_id
        order by m_sa
        limit 0,1
       ));


#14.æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€é«˜çš„éƒ¨é—¨çš„ manager çš„è¯¦ç»†ä¿¡æ¯: last_name, department_id, email, salary
# æ±‚å¹³å‡å·¥èµ„æœ€é«˜çš„éƒ¨é—¨id
select department_id
from employees
group by department_id
having avg(salary)>=ALL (
    select avg(salary)
    from employees
    group by department_id
);

#æ±‚è¿™ä¸ªå¹³å‡å·¥èµ„æœ€é«˜çš„éƒ¨é—¨ä¸­ï¼Œå¤šä¸ªç®¡ç†è€…çš„ id
select distinct manager_id
from employees
where department_id  =(
    #æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€é«˜çš„éƒ¨é—¨
    select department_id
    from employees
    group by department_id
    having avg(salary) >= ALL (
        #æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„
        select avg(salary)
        from employees
        group by department_id
    )
);
# æŸ¥è¯¢å‘˜å·¥è¡¨
select employee_id, last_name, department_id, email, salary
from employees
where employee_id in (
    select distinct manager_id
    from employees
    where department_id = (
        #æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€é«˜çš„éƒ¨é—¨
        select department_id
        from employees
        group by department_id
        having avg(salary) >= ALL (
            #æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„
            select avg(salary)
            from employees
            group by department_id
        )
    )
);




#15. æŸ¥è¯¢éƒ¨é—¨çš„éƒ¨é—¨å·,å…¶ä¸­ä¸åŒ…æ‹¬job_idæ˜¯"ST_CLERK"çš„éƒ¨é—¨å·

# æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨ï¼Œç„¶åæ’é™¤ Job_idæ˜¯"ST_CLERK"çš„éƒ¨é—¨

# æŸ¥è¯¢ Job_idæ˜¯"ST_CLERK"çš„ æ‰€æœ‰éƒ¨é—¨id
select department_id
from employees
group by department_id,job_id
having job_id='ST_CLERK';


select department_id
from departments
where department_id not in(
        select department_id
        from employees
        group by department_id,job_id
        having job_id='ST_CLERK'
    );
#ç›¸å…³å­æŸ¥è¯¢ï¼Œå°†éƒ¨é—¨è¡¨ä½œä¸ºä¸»ä½“ï¼Œæ¡ä»¶æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸ºçœŸã€‚æ»¡è¶³å°±è¾“å‡ºï¼Œä¸æ»¡è¶³å°±ç»§ç»­ä¸‹ä¸€è¡Œ
SELECT department_id
FROM departments d
WHERE NOT EXISTS(
        SELECT *
        FROM employees e
        WHERE d.`department_id` = e.`department_id`
          AND job_id = 'ST_CLERK'
    );




#16. é€‰æ‹©æ‰€æœ‰ æ²¡æœ‰ç®¡ç†è€…çš„å‘˜å·¥çš„last_name

# æŸ¥è¯¢ ç®¡ç†è€…çš„idä¸ºnullçš„ å‘˜å·¥ä¿¡æ¯

select *
from employees
where manager_id is null ;

# æŸ¥è¯¢æ‰€æœ‰ç®¡ç†è€…çš„id
# å‘˜å·¥çš„ç®¡ç†è€…ï¼Œä¸å…¶åŒ¹é…ï¼Œä¸åœ¨é‡Œé¢çš„ è®°å½•ä¸€è¡Œ

select *
from employees e1 # e1çœ‹ä½œå‘˜å·¥è¡¨
where not exists(
        select * from employees e2 #e2çœ‹ä½œç®¡ç†å‘˜è¡¨
        where e1.manager_id=e2.employee_id
    );

#17.æŸ¥è¯¢å‘˜å·¥å·ã€å§“åã€é›‡ç”¨æ—¶é—´ã€å·¥èµ„, å…¶ä¸­å‘˜å·¥çš„ ç®¡ç†è€…ä¸º 'De Haan'

# æŸ¥è¯¢ last_name='De Haan'çš„å‘˜å·¥å·
select * from employees where last_name='De Haan';# employee_id =102

select employee_id,last_name,hire_date,salary
from employees
where manager_id=(
    select employee_id from employees where last_name='De Haan'
    );


#18.æŸ¥è¯¢   å„éƒ¨é—¨ä¸­å·¥èµ„ æ¯”æœ¬éƒ¨é—¨å¹³å‡å·¥èµ„é«˜    çš„å‘˜å·¥çš„å‘˜å·¥å·, å§“åå’Œå·¥èµ„(ç›¸å…³å­æŸ¥è¯¢)

#æŸ¥è¯¢å„ä¸ªéƒ¨é—¨ä¸­çš„å·¥èµ„(æ‰€æœ‰äººçš„å·¥èµ„)
# å¿…é¡»ä»¥éƒ¨é—¨å’Œäººåˆ†ç»„ï¼Œä¸èƒ½ä»¥éƒ¨é—¨å’Œå·¥èµ„åˆ†ç»„ï¼Œå·¥èµ„æœ‰å¯èƒ½ ä¸¤ä¸ªäººä¸€æ ·çš„ã€‚ä¹Ÿè¢«åˆå¹¶äº†ã€‚é”™è¯¯çš„
select employee_id, last_name, salary
from employees e1
group by department_id, employee_id
having salary>(
    select  AVG(salary)
    from employees e2
    where e1.department_id=e2.department_id
    group by department_id
    );


# é”™è¯¯çš„åˆ†ç»„
select department_id,salary
from employees
group by department_id, salary;


# æŸ¥è¯¢å„ä¸ªéƒ¨é—¨çš„ å¹³å‡å·¥èµ„
select department_id,AVG(salary)
from employees
group by department_id;




#19.æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨ä¸‹çš„éƒ¨é—¨äººæ•°å¤§äº 5 çš„éƒ¨é—¨åç§°(ç›¸å…³å­æŸ¥è¯¢)

# æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨ï¼Œéƒ¨é—¨ä¸‹çš„ äººæ•°
# æ€è€ƒï¼Œéƒ¨é—¨è¡¨ï¼Œå’Œ å‘˜å·¥è¡¨ ç›¸å…³æŸ¥è¯¢

select *
from departments d
where 5<(
    select count(1)
    from employees e
    where d.department_id=e.department_id
    ) ;

# æŸä¸ªéƒ¨é—¨ä¸‹çš„äººæ•°
select count(1)
from employees
where department_id='90';



#20.æŸ¥è¯¢æ¯ä¸ªå›½å®¶ä¸‹çš„éƒ¨é—¨ä¸ªæ•°å¤§äº 2 çš„å›½å®¶ç¼–å·(ç›¸å…³å­æŸ¥è¯¢)

select * from countries;

# æŸ¥çœ‹éƒ¨é—¨åœ¨å“ªå›½å®¶

select *
from departments;
select *
from locations;

# æŸ¥è¯¢å›½å®¶countriesè¡¨

select * from countries  c
where 2<(
        select count(1)
        from departments d  join locations l
        on d.location_id=l.location_id
        where  c.country_id=l.country_id
    );


# æ‰€æœ‰éƒ¨é—¨æ‰€åœ¨çš„åŸå¸‚
select d.department_id,l.country_id
from departments d  join locations l
on d.location_id=l.location_id;


SELECT country_id
FROM locations l
WHERE 2 < (
    SELECT COUNT(*)
    FROM departments d
    WHERE l.`location_id` = d.`location_id`
);


```







---


----

Â© ç‰ˆæƒå£°æ˜

<escape>

<div>
    <h3 align="center"  style="color: brown;" >ç‰ˆæƒå£°æ˜</h3>
    <table>
   		<tr>
    		<ol>
				<li>æœ¬ç½‘ç«™åç§°ï¼šğš²ğš³ğš²</li>
				<li>ğš²ğš³ğš²æä¾›çš„èµ„æºä»…ä¾›æ‚¨ä¸ªäººç”¨äºéå•†ä¸šæ€§ç›®çš„ã€‚</li>
				<li>æœ¬ç«™æ–‡ç« éƒ¨åˆ†å†…å®¹å¯èƒ½æ¥æºäºç½‘ç»œï¼Œä»…ä¾›å¤§å®¶å­¦ä¹ ä¸å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æˆ‘è¿›è¡Œåˆ é™¤å¤„ç†ã€‚</li>
				<li>æœ¬ç«™ä¸€åˆ‡èµ„æºä¸ä»£è¡¨æœ¬ç«™ç«‹åœºï¼Œå¹¶ä¸ä»£è¡¨æœ¬ç«™èµåŒå…¶è§‚ç‚¹å’Œå¯¹å…¶çœŸå®æ€§è´Ÿè´£ã€‚</li>
        		<li>æœ¬ç«™ä¸€å¾‹ç¦æ­¢ä»¥ä»»ä½•æ–¹å¼å‘å¸ƒæˆ–è½¬è½½ä»»ä½•è¿æ³•çš„ç›¸å…³ä¿¡æ¯ï¼Œè®¿å®¢å‘ç°è¯·ä¸¾æŠ¥</li> 
        		<li>æœ¬ç«™èµ„æºå¤§å¤šå­˜å‚¨åœ¨äº‘ç›˜ï¼Œå¦‚å‘ç°é“¾æ¥å¤±æ•ˆï¼Œè¯·è”ç³»æˆ‘ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´æ›´æ–°ã€‚</li>
        		<li>æœ¬ç«™å¼ºçƒˆæ‰“å‡»ç›—ç‰ˆ/ç ´è§£ç­‰æœ‰æŸä»–äººæƒç›Šå’Œè¿æ³•ä½œä¸ºï¼Œè¯·æ”¯æŒæ­£ç‰ˆï¼</li>  
			</ol>
		</tr>
	</table>
</div>






</escape>

----



